version: 1

dn: inum=%(inumOrg)s!031C.4A65,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Sample Id Generator script
displayName: id_generator
gluuStatus: false
inum: %(inumOrg)s!031C.4A65
oxLevel: 100
oxRevision: 1
oxScript:: ZnJvbSBvcmcueGRpLm1vZGVsLmN1c3RvbS5zY3JpcHQudHlwZS5pZCBpbXBvcnQgS
 WRHZW5lcmF0b3JUeXBlCmZyb20gb3JnLnhkaS51dGlsIGltcG9ydCBTdHJpbmdIZWxwZXIsIEFy
 cmF5SGVscGVyCmZyb20gamF2YS51dGlsIGltcG9ydCBBcnJheXMsIEFycmF5TGlzdAoKaW1wb3J
 0IGphdmEKCmNsYXNzIElkR2VuZXJhdG9yKElkR2VuZXJhdG9yVHlwZSk6CiAgICBkZWYgX19pbm
 l0X18oc2VsZiwgY3VycmVudFRpbWVNaWxsaXMpOgogICAgICAgIHNlbGYuY3VycmVudFRpbWVNa
 WxsaXMgPSBjdXJyZW50VGltZU1pbGxpcwoKICAgIGRlZiBpbml0KHNlbGYsIGNvbmZpZ3VyYXRp
 b25BdHRyaWJ1dGVzKToKICAgICAgICBwcmludCAiSWQgZ2VuZXJhdG9yLiBJbml0aWFsaXphdGl
 vbiIKICAgICAgICBwcmludCAiSWQgZ2VuZXJhdG9yLiBJbml0aWFsaXplZCBzdWNjZXNzZnVsbH
 kiCgogICAgICAgIHJldHVybiBUcnVlICAgCgogICAgZGVmIGRlc3Ryb3koc2VsZiwgY29uZmlnd
 XJhdGlvbkF0dHJpYnV0ZXMpOgogICAgICAgIHByaW50ICJJZCBnZW5lcmF0b3IuIERlc3Ryb3ki
 CiAgICAgICAgcHJpbnQgIklkIGdlbmVyYXRvci4gRGVzdHJveWVkIHN1Y2Nlc3NmdWxseSIKICA
 gICAgICByZXR1cm4gVHJ1ZSAgIAoKICAgIGRlZiBnZXRBcGlWZXJzaW9uKHNlbGYpOgogICAgIC
 AgIHJldHVybiAxCgogICAgIyBJZCBnZW5lcmF0b3IgaW5pdCBtZXRob2QKICAgICMgICBhcHBJZ
 CBpcyBhcHBsaWNhdGlvbiBJZAogICAgIyAgIGlkVHlwZSBpcyBJZCBUeXBlCiAgICAjICAgaWRQ
 cmVmaXggaXMgSWQgUHJlZml4CiAgICAjICAgdXNlciBpcyBvcmcuZ2x1dS5veHRydXN0Lm1vZGV
 sLkdsdXVDdXN0b21QZXJzb24KICAgICMgICBjb25maWd1cmF0aW9uQXR0cmlidXRlcyBpcyBqYX
 ZhLnV0aWwuTWFwPFN0cmluZywgU2ltcGxlQ3VzdG9tUHJvcGVydHk+CiAgICBkZWYgZ2VuZXJhd
 GVJZChzZWxmLCBhcHBJZCwgaWRUeXBlLCBpZFByZWZpeCwgY29uZmlndXJhdGlvbkF0dHJpYnV0
 ZXMpOgogICAgICAgIHByaW50ICJJZCBnZW5lcmF0b3IuIEdlbmVyYXRlIElkIgogICAgICAgIHB
 yaW50ICJJZCBnZW5lcmF0b3IuIEdlbmVyYXRlIElkLiBBcHBJZDogJyIsIGFwcElkLCAiJywgSW
 RUeXBlOiAnIiwgaWRUeXBlLCAiJywgSWRQcmVmaXg6ICciLCBpZFByZWZpeCwgIiciCgogICAgI
 CAgICMgUmV0dXJuIE5vbmUgb3IgZW1wdHkgc3RyaW5nIHRvIHRyaWdnZXIgZGVmYXVsdCBJZCBn
 ZW5lcmF0aW9uIG1ldGhvZAogICAgICAgIHJldHVybiBOb25lCg==
oxScriptType: id_generator
programmingLanguage: python

dn: inum=%(inumOrg)s!13D3.E7AD,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Sample Cache Refresh script
displayName: cache_refresh
gluuStatus: false
inum: %(inumOrg)s!13D3.E7AD
oxLevel: 100
oxRevision: 1
oxScript:: ZnJvbSBvcmcueGRpLm1vZGVsLmN1c3RvbS5zY3JpcHQudHlwZS51c2VyIGltcG9yd
 CBDYWNoZVJlZnJlc2hUeXBlDQpmcm9tIG9yZy54ZGkudXRpbCBpbXBvcnQgU3RyaW5nSGVscGVy
 LCBBcnJheUhlbHBlcg0KZnJvbSBqYXZhLnV0aWwgaW1wb3J0IEFycmF5cywgQXJyYXlMaXN0DQp
 mcm9tIG9yZy5nbHV1Lm94dHJ1c3QubW9kZWwgaW1wb3J0IEdsdXVDdXN0b21BdHRyaWJ1dGUNCg
 0KaW1wb3J0IGphdmENCg0KY2xhc3MgQ2FjaGVSZWZyZXNoKENhY2hlUmVmcmVzaFR5cGUpOg0KI
 CAgIGRlZiBfX2luaXRfXyhzZWxmLCBjdXJyZW50VGltZU1pbGxpcyk6DQogICAgICAgIHNlbGYu
 Y3VycmVudFRpbWVNaWxsaXMgPSBjdXJyZW50VGltZU1pbGxpcw0KDQogICAgZGVmIGluaXQoc2V
 sZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICBwcmludCAiQ2FjaGUgcmVmcm
 VzaC4gSW5pdGlhbGl6YXRpb24iDQogICAgICAgIHByaW50ICJDYWNoZSByZWZyZXNoLiBJbml0a
 WFsaXplZCBzdWNjZXNzZnVsbHkiDQoNCiAgICAgICAgcmV0dXJuIFRydWUgICANCg0KICAgIGRl
 ZiBkZXN0cm95KHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcHJpbnQ
 gIkNhY2hlIHJlZnJlc2guIERlc3Ryb3kiDQogICAgICAgIHByaW50ICJDYWNoZSByZWZyZXNoLi
 BEZXN0cm95ZWQgc3VjY2Vzc2Z1bGx5Ig0KICAgICAgICByZXR1cm4gVHJ1ZSAgIA0KDQogICAgI
 yBVcGRhdGUgdXNlciBlbnRyeSBiZWZvcmUgcGVyc2lzdCBpdA0KICAgICMgICB1c2VyIGlzIG9y
 Zy5nbHV1Lm94dHJ1c3QubW9kZWwuR2x1dUN1c3RvbVBlcnNvbg0KICAgICMgICBjb25maWd1cmF
 0aW9uQXR0cmlidXRlcyBpcyBqYXZhLnV0aWwuTWFwPFN0cmluZywgU2ltcGxlQ3VzdG9tUHJvcG
 VydHk+DQogICAgZGVmIHVwZGF0ZVVzZXIoc2VsZiwgdXNlciwgY29uZmlndXJhdGlvbkF0dHJpY
 nV0ZXMpOg0KICAgICAgICBwcmludCAiQ2FjaGUgcmVmcmVzaC4gVXBkYXRlVXNlciBtZXRob2Qi
 DQoNCiAgICAgICAgYXR0cmlidXRlcyA9IHVzZXIuZ2V0Q3VzdG9tQXR0cmlidXRlcygpDQoNCiA
 gICAgICAgIyBBZGQgbmV3IGF0dHJpYnV0ZSBwcmVmZXJyZWRMYW5ndWFnZQ0KICAgICAgICBhdH
 RyUHJlZmZlcmVkTGFuZ3VhZ2UgPSBHbHV1Q3VzdG9tQXR0cmlidXRlKCJwcmVmZXJyZWRMYW5nd
 WFnZSIsICJlbi11cyIpDQogICAgICAgIGF0dHJpYnV0ZXMuYWRkKGF0dHJQcmVmZmVyZWRMYW5n
 dWFnZSkNCg0KICAgICAgICAjIEFkZCBuZXcgYXR0cmlidXRlIHVzZXJQYXNzd29yZA0KICAgICA
 gICBhdHRyVXNlclBhc3N3b3JkID0gR2x1dUN1c3RvbUF0dHJpYnV0ZSgidXNlclBhc3N3b3JkIi
 wgInRlc3QiKQ0KICAgICAgICBhdHRyaWJ1dGVzLmFkZChhdHRyVXNlclBhc3N3b3JkKQ0KDQogI
 CAgICAgICMgVXBkYXRlIGdpdmVuTmFtZSBhdHRyaWJ1dGUNCiAgICAgICAgZm9yIGF0dHJpYnV0
 ZSBpbiBhdHRyaWJ1dGVzOg0KICAgICAgICAgICAgYXR0ck5hbWUgPSBhdHRyaWJ1dGUuZ2V0TmF
 tZSgpDQogICAgICAgICAgICBpZiAoKCJnaXZlbm5hbWUiID09IFN0cmluZ0hlbHBlci50b0xvd2
 VyQ2FzZShhdHRyTmFtZSkpIGFuZCBTdHJpbmdIZWxwZXIuaXNOb3RFbXB0eShhdHRyaWJ1dGUuZ
 2V0VmFsdWUoKSkpOg0KICAgICAgICAgICAgICAgIGF0dHJpYnV0ZS5zZXRWYWx1ZShTdHJpbmdI
 ZWxwZXIucmVtb3ZlTXVsdGlwbGVTcGFjZXMoYXR0cmlidXRlLmdldFZhbHVlKCkpICsgIiAodXB
 kYXRlZCkiKQ0KDQogICAgICAgIHJldHVybiBUcnVlDQoNCiAgICBkZWYgZ2V0QXBpVmVyc2lvbi
 hzZWxmKToNCiAgICAgICAgcmV0dXJuIDENCg==
oxScriptType: cache_refresh
programmingLanguage: python

dn: inum=%(inumOrg)s!2DAF.F995,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Sample UMA Authorization policy
displayName: uma_autorization_policy
gluuStatus: false
inum: %(inumOrg)s!2DAF.F995
oxLevel: 100
oxRevision: 1
oxScript:: ZnJvbSBvcmcueGRpLm1vZGVsLmN1c3RvbS5zY3JpcHQudHlwZS51bWEgaW1wb3J0I
 EF1dGhvcml6YXRpb25Qb2xpY3lUeXBlDQpmcm9tIG9yZy54ZGkudXRpbCBpbXBvcnQgU3RyaW5n
 SGVscGVyLCBBcnJheUhlbHBlcg0KZnJvbSBqYXZhLnV0aWwgaW1wb3J0IEFycmF5cywgQXJyYXl
 MaXN0DQpmcm9tIG9yZy54ZGkub3hhdXRoLnNlcnZpY2UudW1hLmF1dGhvcml6YXRpb24gaW1wb3
 J0IEF1dGhvcml6YXRpb25Db250ZXh0DQoNCmltcG9ydCBqYXZhDQoNCmNsYXNzIEF1dGhvcml6Y
 XRpb25Qb2xpY3koQXV0aG9yaXphdGlvblBvbGljeVR5cGUpOg0KICAgIGRlZiBfX2luaXRfXyhz
 ZWxmLCBjdXJyZW50VGltZU1pbGxpcyk6DQogICAgICAgIHNlbGYuY3VycmVudFRpbWVNaWxsaXM
 gPSBjdXJyZW50VGltZU1pbGxpcw0KDQogICAgZGVmIGluaXQoc2VsZiwgY29uZmlndXJhdGlvbk
 F0dHJpYnV0ZXMpOg0KICAgICAgICBwcmludCAiVU1BIGF1dGhvcml6YXRpb24gcG9saWN5LiBJb
 ml0aWFsaXphdGlvbiINCiAgICAgICAgcHJpbnQgIlVNQSBhdXRob3JpemF0aW9uIHBvbGljeS4g
 SW5pdGlhbGl6ZWQgc3VjY2Vzc2Z1bGx5Ig0KDQogICAgICAgIHJldHVybiBUcnVlICAgDQoNCiA
 gICBkZWYgZGVzdHJveShzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIH
 ByaW50ICJVTUEgYXV0aG9yaXphdGlvbiBwb2xpY3kuIERlc3Ryb3kiDQogICAgICAgIHByaW50I
 CJVTUEgYXV0aG9yaXphdGlvbiBwb2xpY3kuIERlc3Ryb3llZCBzdWNjZXNzZnVsbHkiDQogICAg
 ICAgIHJldHVybiBUcnVlICAgDQoNCiAgICBkZWYgZ2V0QXBpVmVyc2lvbihzZWxmKToNCiAgICA
 gICAgcmV0dXJuIDENCg0KICAgICMgVXBkYXRlIHVzZXIgZW50cnkgYmVmb3JlIHBlcnNpc3Rlbn
 QgaXQNCiAgICAjICAgdXNlciBpcyBvcmcuZ2x1dS5veHRydXN0Lm1vZGVsLkdsdXVDdXN0b21QZ
 XJzb24NCiAgICAjICAgcGVyc2lzdGVkIGlzIGJvb2xlYW4gdmFsdWUgdG8gc3BlY2lmeSBpZiBv
 cGVyYXRpb24gdHlwZTogYWRkL21vZGlmeQ0KICAgICMgICBjb25maWd1cmF0aW9uQXR0cmlidXR
 lcyBpcyBqYXZhLnV0aWwuTWFwPFN0cmluZywgU2ltcGxlQ3VzdG9tUHJvcGVydHk+DQogICAgZG
 VmIGF1dGhvcml6ZShzZWxmLCBhdXRob3JpemF0aW9uQ29udGV4dCwgY29uZmlndXJhdGlvbkF0d
 HJpYnV0ZXMpOg0KICAgICAgICBwcmludCAiVU1BIEF1dGhvcml6YXRpb24gcG9saWN5LiBBdHRl
 bXB0aW5nIHRvIGF1dGhvcml6ZSBjbGllbnQiDQogICAgICAgIGNsaWVudF9pZCA9IGF1dGhvcml
 6YXRpb25Db250ZXh0LmdldEdyYW50KCkuZ2V0Q2xpZW50SWQoKQ0KDQogICAgICAgIHByaW50IC
 JVTUEgQXV0aG9yaXphdGlvbiBwb2xpY3kuIENsaWVudDogIiwgY2xpZW50X2lkDQogICAgICAgI
 GlmIChTdHJpbmdIZWxwZXIuZXF1YWxzSWdub3JlQ2FzZSgiQCExMTExITAwMDghRkRDMC4wRkY1
 IiwgY2xpZW50X2lkKSk6DQogICAgICAgICAgICBwcmludCAiVU1BIEF1dGhvcml6YXRpb24gcG9
 saWN5LiBBdXRob3JpemluZyBjbGllbnQiDQogICAgICAgICAgICByZXR1cm4gVHJ1ZQ0KICAgIC
 AgICBlbHNlOg0KICAgICAgICAgICAgcHJpbnQgIlVNQSBBdXRob3JpemF0aW9uIHBvbGljeS4gQ
 2xpZW50IGlzbid0IGF1dGhvcml6ZWQiDQogICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAg
 ICAgICBwcmludCAiVU1BIEF1dGhvcml6YXRpb24gcG9saWN5LiBBdXRob3JpemluZyBjbGllbnQ
 iDQogICAgICAgIHJldHVybiBUcnVlDQo=
oxScriptType: uma_authorization_policy
programmingLanguage: python

dn: inum=%(inumOrg)s!522F.CDC5,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Sample Update User script
displayName: update_user
gluuStatus: false
inum: %(inumOrg)s!522F.CDC5
oxLevel: 100
oxRevision: 1
oxScript:: ZnJvbSBvcmcueGRpLm1vZGVsLmN1c3RvbS5zY3JpcHQudHlwZS51c2VyIGltcG9yd
 CBVcGRhdGVVc2VyVHlwZQpmcm9tIG9yZy54ZGkudXRpbCBpbXBvcnQgU3RyaW5nSGVscGVyLCBB
 cnJheUhlbHBlcgpmcm9tIGphdmEudXRpbCBpbXBvcnQgQXJyYXlzLCBBcnJheUxpc3QKCmltcG9
 ydCBqYXZhCgpjbGFzcyBVcGRhdGVVc2VyKFVwZGF0ZVVzZXJUeXBlKToKICAgIGRlZiBfX2luaX
 RfXyhzZWxmLCBjdXJyZW50VGltZU1pbGxpcyk6CiAgICAgICAgc2VsZi5jdXJyZW50VGltZU1pb
 GxpcyA9IGN1cnJlbnRUaW1lTWlsbGlzCgogICAgZGVmIGluaXQoc2VsZiwgY29uZmlndXJhdGlv
 bkF0dHJpYnV0ZXMpOgogICAgICAgIHByaW50ICJVcGRhdGUgdXNlci4gSW5pdGlhbGl6YXRpb24
 iCiAgICAgICAgcHJpbnQgIlVwZGF0ZSB1c2VyLiBJbml0aWFsaXplZCBzdWNjZXNzZnVsbHkiCg
 ogICAgICAgIHJldHVybiBUcnVlICAgCgogICAgZGVmIGRlc3Ryb3koc2VsZiwgY29uZmlndXJhd
 GlvbkF0dHJpYnV0ZXMpOgogICAgICAgIHByaW50ICJVcGRhdGUgdXNlci4gRGVzdHJveSIKICAg
 ICAgICBwcmludCAiVXBkYXRlIHVzZXIuIERlc3Ryb3llZCBzdWNjZXNzZnVsbHkiCiAgICAgICA
 gcmV0dXJuIFRydWUgICAKCiAgICAjIFVwZGF0ZSB1c2VyIGVudHJ5IGJlZm9yZSBwZXJzaXN0ZW
 50IGl0CiAgICAjICAgdXNlciBpcyBvcmcuZ2x1dS5veHRydXN0Lm1vZGVsLkdsdXVDdXN0b21QZ
 XJzb24KICAgICMgICBwZXJzaXN0ZWQgaXMgYm9vbGVhbiB2YWx1ZSB0byBzcGVjaWZ5IGlmIG9w
 ZXJhdGlvbiB0eXBlOiBhZGQvbW9kaWZ5CiAgICAjICAgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXM
 gaXMgamF2YS51dGlsLk1hcDxTdHJpbmcsIFNpbXBsZUN1c3RvbVByb3BlcnR5PgogICAgZGVmIH
 VwZGF0ZVVzZXIoc2VsZiwgdXNlciwgcGVyc2lzdGVkLCBjb25maWd1cmF0aW9uQXR0cmlidXRlc
 yk6CiAgICAgICAgcHJpbnQgIlVwZGF0ZSB1c2VyLiBVcGRhdGVVc2VyIG1ldGhvZCIKCiAgICAg
 ICAgdWlkID0gdXNlci5nZXRVaWQoKQogICAgICAgIHByaW50ICJVcGRhdGUgdXNlci4gVXNlciB
 VaWQ6IiwgdWlkCiAgICAgICAgCiAgICAgICAgbWFpbCA9IHVpZCArICJAZXhhbXBsZS5vcmciCi
 AgICAgICAgdXNlci5zZXRNYWlsKG1haWwpCgogICAgICAgIHJldHVybiBUcnVlCgogICAgZGVmI
 GdldEFwaVZlcnNpb24oc2VsZik6CiAgICAgICAgcmV0dXJuIDEK
oxScriptType: update_user
programmingLanguage: python

dn: inum=%(inumOrg)s!6EA0.8F0C,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Sample User Registration script
displayName: user_registration
gluuStatus: false
inum: %(inumOrg)s!6EA0.8F0C
oxLevel: 100
oxRevision: 1
oxScript:: ZnJvbSBvcmcueGRpLm1vZGVsLmN1c3RvbS5zY3JpcHQudHlwZS51c2VyIGltcG9yd
 CBVc2VyUmVnaXN0cmF0aW9uVHlwZQpmcm9tIG9yZy54ZGkudXRpbCBpbXBvcnQgU3RyaW5nSGVs
 cGVyLCBBcnJheUhlbHBlcgpmcm9tIGphdmEudXRpbCBpbXBvcnQgQXJyYXlzLCBBcnJheUxpc3Q
 KCmltcG9ydCBqYXZhCgpjbGFzcyBVc2VyUmVnaXN0cmF0aW9uKFVzZXJSZWdpc3RyYXRpb25UeX
 BlKToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBjdXJyZW50VGltZU1pbGxpcyk6CiAgICAgICAgc
 2VsZi5jdXJyZW50VGltZU1pbGxpcyA9IGN1cnJlbnRUaW1lTWlsbGlzCgogICAgZGVmIGluaXQo
 c2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOgogICAgICAgIHByaW50ICJVc2VyIHJlZ2l
 zdHJhdGlvbi4gSW5pdGlhbGl6YXRpb24iCiAgICAgICAgcHJpbnQgIlVzZXIgcmVnaXN0cmF0aW
 9uLiBJbml0aWFsaXplZCBzdWNjZXNzZnVsbHkiCgogICAgICAgIHJldHVybiBUcnVlICAgCgogI
 CAgZGVmIGRlc3Ryb3koc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOgogICAgICAgIHBy
 aW50ICJVc2VyIHJlZ2lzdHJhdGlvbi4gRGVzdHJveSIKICAgICAgICBwcmludCAiVXNlciByZWd
 pc3RyYXRpb24uIERlc3Ryb3llZCBzdWNjZXNzZnVsbHkiCiAgICAgICAgcmV0dXJuIFRydWUgIC
 AKCiAgICAjIFVzZXIgcmVnaXN0cmF0aW9uIGluaXQgbWV0aG9kCiAgICAjICAgdXNlciBpcyBvc
 mcuZ2x1dS5veHRydXN0Lm1vZGVsLkdsdXVDdXN0b21QZXJzb24KICAgICMgICByZXF1ZXN0UGFy
 YW1ldGVycyBpcyBqYXZhLnV0aWwuTWFwPFN0cmluZywgU3RyaW5nW10+CiAgICAjICAgY29uZml
 ndXJhdGlvbkF0dHJpYnV0ZXMgaXMgamF2YS51dGlsLk1hcDxTdHJpbmcsIFNpbXBsZUN1c3RvbV
 Byb3BlcnR5PgogICAgZGVmIGluaXRSZWdpc3RyYXRpb24oc2VsZiwgdXNlciwgcmVxdWVzdFBhc
 mFtZXRlcnMsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToKICAgICAgICBwcmludCAiVXNlciBy
 ZWdpc3RyYXRpb24uIEluaXQgbWV0aG9kIgoKICAgICAgICByZXR1cm4gVHJ1ZQoKICAgICMgVXN
 lciByZWdpc3RyYXRpb24gcHJlIG1ldGhvZAogICAgIyAgIHVzZXIgaXMgb3JnLmdsdXUub3h0cn
 VzdC5tb2RlbC5HbHV1Q3VzdG9tUGVyc29uCiAgICAjICAgcmVxdWVzdFBhcmFtZXRlcnMgaXMga
 mF2YS51dGlsLk1hcDxTdHJpbmcsIFN0cmluZ1tdPgogICAgIyAgIGNvbmZpZ3VyYXRpb25BdHRy
 aWJ1dGVzIGlzIGphdmEudXRpbC5NYXA8U3RyaW5nLCBTaW1wbGVDdXN0b21Qcm9wZXJ0eT4KICA
 gIGRlZiBwcmVSZWdpc3RyYXRpb24oc2VsZiwgdXNlciwgcmVxdWVzdFBhcmFtZXRlcnMsIGNvbm
 ZpZ3VyYXRpb25BdHRyaWJ1dGVzKToKICAgICAgICBwcmludCAiVXNlciByZWdpc3RyYXRpb24uI
 FByZSBtZXRob2QiCgogICAgICAgIHJldHVybiBUcnVlCgogICAgIyBVc2VyIHJlZ2lzdHJhdGlv
 biBwb3N0IG1ldGhvZAogICAgIyAgIHVzZXIgaXMgb3JnLmdsdXUub3h0cnVzdC5tb2RlbC5HbHV
 1Q3VzdG9tUGVyc29uCiAgICAjICAgcmVxdWVzdFBhcmFtZXRlcnMgaXMgamF2YS51dGlsLk1hcD
 xTdHJpbmcsIFN0cmluZ1tdPgogICAgIyAgIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzIGlzIGphd
 mEudXRpbC5NYXA8U3RyaW5nLCBTaW1wbGVDdXN0b21Qcm9wZXJ0eT4KICAgIGRlZiBwb3N0UmVn
 aXN0cmF0aW9uKHNlbGYsIHVzZXIsIHJlcXVlc3RQYXJhbWV0ZXJzLCBjb25maWd1cmF0aW9uQXR
 0cmlidXRlcyk6CiAgICAgICAgcHJpbnQgIlVzZXIgcmVnaXN0cmF0aW9uLiBQb3N0IG1ldGhvZC
 IKCiAgICAgICAgcmV0dXJuIFRydWUKCiAgICBkZWYgZ2V0QXBpVmVyc2lvbihzZWxmKToKICAgI
 CAgICByZXR1cm4gMQo=
oxScriptType: user_registration
programmingLanguage: python

dn: inum=%(inumOrg)s!A51E.76DA,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Sample Authentication script
displayName: basic
gluuStatus: false
inum: %(inumOrg)s!A51E.76DA
oxLevel: 100
oxModuleProperty: {"value1":"usage_type","value2":"interactive","description
 ":""}
oxRevision: 1
oxScript:: ZnJvbSBvcmcuamJvc3Muc2VhbS5zZWN1cml0eSBpbXBvcnQgSWRlbnRpdHkNCmZyb
 20gb3JnLnhkaS5tb2RlbC5jdXN0b20uc2NyaXB0LnR5cGUuYXV0aCBpbXBvcnQgUGVyc29uQXV0
 aGVudGljYXRpb25UeXBlDQpmcm9tIG9yZy54ZGkub3hhdXRoLnNlcnZpY2UgaW1wb3J0IFVzZXJ
 TZXJ2aWNlDQpmcm9tIG9yZy54ZGkudXRpbCBpbXBvcnQgU3RyaW5nSGVscGVyDQoNCmltcG9ydC
 BqYXZhDQoNCmNsYXNzIFBlcnNvbkF1dGhlbnRpY2F0aW9uKFBlcnNvbkF1dGhlbnRpY2F0aW9uV
 HlwZSk6DQogICAgZGVmIF9faW5pdF9fKHNlbGYsIGN1cnJlbnRUaW1lTWlsbGlzKToNCiAgICAg
 ICAgc2VsZi5jdXJyZW50VGltZU1pbGxpcyA9IGN1cnJlbnRUaW1lTWlsbGlzDQoNCiAgICBkZWY
 gaW5pdChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHByaW50ICJCYX
 NpYy4gSW5pdGlhbGl6YXRpb24iDQogICAgICAgIHByaW50ICJCYXNpYy4gSW5pdGlhbGl6ZWQgc
 3VjY2Vzc2Z1bGx5Ig0KICAgICAgICByZXR1cm4gVHJ1ZSAgIA0KDQogICAgZGVmIGRlc3Ryb3ko
 c2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICBwcmludCAiQmFzaWMuIER
 lc3Ryb3kiDQogICAgICAgIHByaW50ICJCYXNpYy4gRGVzdHJveWVkIHN1Y2Nlc3NmdWxseSINCi
 AgICAgICAgcmV0dXJuIFRydWUNCg0KICAgIGRlZiBnZXRBcGlWZXJzaW9uKHNlbGYpOg0KICAgI
 CAgICByZXR1cm4gMQ0KDQogICAgZGVmIGlzVmFsaWRBdXRoZW50aWNhdGlvbk1ldGhvZChzZWxm
 LCB1c2FnZVR5cGUsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcmV0dXJuIFR
 ydWUNCg0KICAgIGRlZiBnZXRBbHRlcm5hdGl2ZUF1dGhlbnRpY2F0aW9uTWV0aG9kKHNlbGYsIH
 VzYWdlVHlwZSwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICByZXR1cm4gTm9uZ
 Q0KDQogICAgZGVmIGF1dGhlbnRpY2F0ZShzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywg
 cmVxdWVzdFBhcmFtZXRlcnMsIHN0ZXApOg0KICAgICAgICBpZiAoc3RlcCA9PSAxKToNCiAgICA
 gICAgICAgIHByaW50ICJCYXNpYy4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEiDQoNCiAgICAgIC
 AgICAgIGNyZWRlbnRpYWxzID0gSWRlbnRpdHkuaW5zdGFuY2UoKS5nZXRDcmVkZW50aWFscygpD
 QogICAgICAgICAgICB1c2VyX25hbWUgPSBjcmVkZW50aWFscy5nZXRVc2VybmFtZSgpDQogICAg
 ICAgICAgICB1c2VyX3Bhc3N3b3JkID0gY3JlZGVudGlhbHMuZ2V0UGFzc3dvcmQoKQ0KDQogICA
 gICAgICAgICBsb2dnZWRfaW4gPSBGYWxzZQ0KICAgICAgICAgICAgaWYgKFN0cmluZ0hlbHBlci
 5pc05vdEVtcHR5U3RyaW5nKHVzZXJfbmFtZSkgYW5kIFN0cmluZ0hlbHBlci5pc05vdEVtcHR5U
 3RyaW5nKHVzZXJfcGFzc3dvcmQpKToNCiAgICAgICAgICAgICAgICB1c2VyU2VydmljZSA9IFVz
 ZXJTZXJ2aWNlLmluc3RhbmNlKCkNCiAgICAgICAgICAgICAgICBsb2dnZWRfaW4gPSB1c2VyU2V
 ydmljZS5hdXRoZW50aWNhdGUodXNlcl9uYW1lLCB1c2VyX3Bhc3N3b3JkKQ0KDQogICAgICAgIC
 AgICBpZiAobm90IGxvZ2dlZF9pbik6DQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNC
 iAgICAgICAgICAgIHJldHVybiBUcnVlDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1
 cm4gRmFsc2UNCg0KICAgIGRlZiBwcmVwYXJlRm9yU3RlcChzZWxmLCBjb25maWd1cmF0aW9uQXR
 0cmlidXRlcywgcmVxdWVzdFBhcmFtZXRlcnMsIHN0ZXApOg0KICAgICAgICBpZiAoc3RlcCA9PS
 AxKToNCiAgICAgICAgICAgIHByaW50ICJCYXNpYy4gUHJlcGFyZSBmb3IgU3RlcCAxIg0KICAgI
 CAgICAgICAgcmV0dXJuIFRydWUNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBG
 YWxzZQ0KDQogICAgZGVmIGdldEV4dHJhUGFyYW1ldGVyc0ZvclN0ZXAoc2VsZiwgY29uZmlndXJ
 hdGlvbkF0dHJpYnV0ZXMsIHN0ZXApOg0KICAgICAgICByZXR1cm4gTm9uZQ0KDQogICAgZGVmIG
 dldENvdW50QXV0aGVudGljYXRpb25TdGVwcyhzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlc
 yk6DQogICAgICAgIHJldHVybiAxDQoNCiAgICBkZWYgZ2V0UGFnZUZvclN0ZXAoc2VsZiwgY29u
 ZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHN0ZXApOg0KICAgICAgICByZXR1cm4gIiINCg0KICAgIGR
 lZiBsb2dvdXQoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJlcXVlc3RQYXJhbWV0ZX
 JzKToNCiAgICAgICAgcmV0dXJuIFRydWUNCg==
oxScriptType: person_authentication
programmingLanguage: python

dn: inum=%(inumOrg)s!8BAF.80D6,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Fido U2F authentication module
displayName: u2f
gluuStatus: false
inum: %(inumOrg)s!8BAF.80D6
oxConfigurationProperty: {"value1":"u2f_application_id","value2":"https://%(hostname)s","description":""}
oxConfigurationProperty: {"value1":"u2f_server_uri","value2":"https://%(hostname)s","description":""}
oxLevel: 10
oxModuleProperty: {"value1":"usage_type","value2":"interactive","description
 ":""}
oxRevision: 1
oxScript:: ZnJvbSBvcmcueGRpLm1vZGVsLmN1c3RvbS5zY3JpcHQudHlwZS5hdXRoIGltcG9yd
 CBQZXJzb25BdXRoZW50aWNhdGlvblR5cGUNCmZyb20gb3JnLmpib3NzLnNlYW0uY29udGV4dHMg
 aW1wb3J0IENvbnRleHQsIENvbnRleHRzDQpmcm9tIG9yZy5qYm9zcy5zZWFtLnNlY3VyaXR5IGl
 tcG9ydCBJZGVudGl0eQ0KZnJvbSBvcmcueGRpLm94YXV0aC5zZXJ2aWNlIGltcG9ydCBVc2VyU2
 VydmljZQ0KZnJvbSBvcmcueGRpLnV0aWwgaW1wb3J0IFN0cmluZ0hlbHBlcg0KZnJvbSBvcmcue
 GRpLnV0aWwgaW1wb3J0IEFycmF5SGVscGVyDQpmcm9tIG9yZy54ZGkub3hhdXRoLmNsaWVudC5m
 aWRvLnUyZiBpbXBvcnQgRmlkb1UyZkNsaWVudEZhY3RvcnkNCmZyb20gb3JnLnhkaS5veGF1dGg
 uc2VydmljZS5maWRvLnUyZiBpbXBvcnQgRGV2aWNlUmVnaXN0cmF0aW9uU2VydmljZQ0KZnJvbS
 BvcmcueGRpLm94YXV0aC51dGlsIGltcG9ydCBTZXJ2ZXJVdGlsDQpmcm9tIG9yZy54ZGkub3hhd
 XRoLm1vZGVsLmNvbmZpZyBpbXBvcnQgQ29uc3RhbnRzDQpmcm9tIG9yZy5qYm9zcy5yZXN0ZWFz
 eS5jbGllbnQgaW1wb3J0IENsaWVudFJlc3BvbnNlRmFpbHVyZQ0KZnJvbSBqYXZheC53cy5ycy5
 jb3JlIGltcG9ydCBSZXNwb25zZQ0KZnJvbSBqYXZhLnV0aWwgaW1wb3J0IEFycmF5cw0KDQppbX
 BvcnQgc3lzDQppbXBvcnQgamF2YQ0KDQpjbGFzcyBQZXJzb25BdXRoZW50aWNhdGlvbihQZXJzb
 25BdXRoZW50aWNhdGlvblR5cGUpOg0KICAgIGRlZiBfX2luaXRfXyhzZWxmLCBjdXJyZW50VGlt
 ZU1pbGxpcyk6DQogICAgICAgIHNlbGYuY3VycmVudFRpbWVNaWxsaXMgPSBjdXJyZW50VGltZU1
 pbGxpcw0KDQogICAgZGVmIGluaXQoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KIC
 AgICAgICBwcmludCAiVTJGLiBJbml0aWFsaXphdGlvbiINCg0KICAgICAgICBwcmludCAiVTJGL
 iBJbml0aWFsaXphdGlvbi4gRG93bmxvYWRpbmcgVTJGIG1ldGFkYXRhIg0KICAgICAgICB1MmZf
 c2VydmVyX3VyaSA9IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmdldCgidTJmX3NlcnZlcl91cmk
 iKS5nZXRWYWx1ZTIoKQ0KICAgICAgICB1MmZfc2VydmVyX21ldGFkYXRhX3VyaSA9IHUyZl9zZX
 J2ZXJfdXJpICsgIi8ud2VsbC1rbm93bi9maWRvLXUyZi1jb25maWd1cmF0aW9uIg0KDQogICAgI
 CAgIG1ldGFEYXRhQ29uZmlndXJhdGlvblNlcnZpY2UgPSBGaWRvVTJmQ2xpZW50RmFjdG9yeS5p
 bnN0YW5jZSgpLmNyZWF0ZU1ldGFEYXRhQ29uZmlndXJhdGlvblNlcnZpY2UodTJmX3NlcnZlcl9
 tZXRhZGF0YV91cmkpDQogICAgICAgIHNlbGYubWV0YURhdGFDb25maWd1cmF0aW9uID0gbWV0YU
 RhdGFDb25maWd1cmF0aW9uU2VydmljZS5nZXRNZXRhZGF0YUNvbmZpZ3VyYXRpb24oKQ0KICAgI
 CAgICANCiAgICAgICAgcHJpbnQgIlUyRi4gSW5pdGlhbGl6ZWQgc3VjY2Vzc2Z1bGx5Ig0KICAg
 ICAgICByZXR1cm4gVHJ1ZSAgIA0KDQogICAgZGVmIGRlc3Ryb3koc2VsZiwgY29uZmlndXJhdGl
 vbkF0dHJpYnV0ZXMpOg0KICAgICAgICBwcmludCAiVTJGLiBEZXN0cm95Ig0KICAgICAgICBwcm
 ludCAiVTJGLiBEZXN0cm95ZWQgc3VjY2Vzc2Z1bGx5Ig0KICAgICAgICByZXR1cm4gVHJ1ZQ0KD
 QogICAgZGVmIGdldEFwaVZlcnNpb24oc2VsZik6DQogICAgICAgIHJldHVybiAxDQoNCiAgICBk
 ZWYgaXNWYWxpZEF1dGhlbnRpY2F0aW9uTWV0aG9kKHNlbGYsIHVzYWdlVHlwZSwgY29uZmlndXJ
 hdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICByZXR1cm4gVHJ1ZQ0KDQogICAgZGVmIGdldEFsdG
 VybmF0aXZlQXV0aGVudGljYXRpb25NZXRob2Qoc2VsZiwgdXNhZ2VUeXBlLCBjb25maWd1cmF0a
 W9uQXR0cmlidXRlcyk6DQogICAgICAgIHJldHVybiBOb25lDQoNCiAgICBkZWYgYXV0aGVudGlj
 YXRlKHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCByZXF1ZXN0UGFyYW1ldGVycywgc3R
 lcCk6DQogICAgICAgIGNyZWRlbnRpYWxzID0gSWRlbnRpdHkuaW5zdGFuY2UoKS5nZXRDcmVkZW
 50aWFscygpDQogICAgICAgIHVzZXJfbmFtZSA9IGNyZWRlbnRpYWxzLmdldFVzZXJuYW1lKCkNC
 g0KICAgICAgICBpZiAoc3RlcCA9PSAxKToNCiAgICAgICAgICAgIHByaW50ICJVMkYuIEF1dGhl
 bnRpY2F0ZSBmb3Igc3RlcCAxIg0KDQogICAgICAgICAgICB1c2VyX3Bhc3N3b3JkID0gY3JlZGV
 udGlhbHMuZ2V0UGFzc3dvcmQoKQ0KICAgICAgICAgICAgbG9nZ2VkX2luID0gRmFsc2UNCiAgIC
 AgICAgICAgIGlmIChTdHJpbmdIZWxwZXIuaXNOb3RFbXB0eVN0cmluZyh1c2VyX25hbWUpIGFuZ
 CBTdHJpbmdIZWxwZXIuaXNOb3RFbXB0eVN0cmluZyh1c2VyX3Bhc3N3b3JkKSk6DQogICAgICAg
 ICAgICAgICAgdXNlclNlcnZpY2UgPSBVc2VyU2VydmljZS5pbnN0YW5jZSgpDQogICAgICAgICA
 gICAgICAgbG9nZ2VkX2luID0gdXNlclNlcnZpY2UuYXV0aGVudGljYXRlKHVzZXJfbmFtZSwgdX
 Nlcl9wYXNzd29yZCkNCg0KICAgICAgICAgICAgaWYgKG5vdCBsb2dnZWRfaW4pOg0KICAgICAgI
 CAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgICAgICByZXR1cm4gVHJ1ZQ0KICAgICAg
 ICBlbGlmIChzdGVwID09IDIpOg0KICAgICAgICAgICAgcHJpbnQgIlUyRi4gQXV0aGVudGljYXR
 lIGZvciBzdGVwIDIiDQoNCiAgICAgICAgICAgIHRva2VuX3Jlc3BvbnNlID0gU2VydmVyVXRpbC
 5nZXRGaXJzdFZhbHVlKHJlcXVlc3RQYXJhbWV0ZXJzLCAidG9rZW5SZXNwb25zZSIpDQogICAgI
 CAgICAgICBpZiB0b2tlbl9yZXNwb25zZSA9PSBOb25lOg0KICAgICAgICAgICAgICAgIHByaW50
 ICJVMkYuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAyLiB0b2tlblJlc3BvbnNlIGlzIGVtcHR5Ig0
 KICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgICAgICBhdXRoX21ldGhvZC
 A9IFNlcnZlclV0aWwuZ2V0Rmlyc3RWYWx1ZShyZXF1ZXN0UGFyYW1ldGVycywgImF1dGhNZXRob
 2QiKQ0KICAgICAgICAgICAgaWYgYXV0aF9tZXRob2QgPT0gTm9uZToNCiAgICAgICAgICAgICAg
 ICBwcmludCAiVTJGLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMi4gYXV0aE1ldGhvZCBpcyBlbXB
 0eSINCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICAgY3JlZGVudG
 lhbHMgPSBJZGVudGl0eS5pbnN0YW5jZSgpLmdldENyZWRlbnRpYWxzKCkNCiAgICAgICAgICAgI
 HVzZXIgPSBjcmVkZW50aWFscy5nZXRVc2VyKCkNCiAgICAgICAgICAgIGlmICh1c2VyID09IE5v
 bmUpOg0KICAgICAgICAgICAgICAgIHByaW50ICJVMkYuIFByZXBhcmUgZm9yIHN0ZXAgMi4gRmF
 pbGVkIHRvIGRldGVybWluZSB1c2VyIG5hbWUiDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbH
 NlDQoNCiAgICAgICAgICAgIGlmIChhdXRoX21ldGhvZCA9PSAnYXV0aGVudGljYXRlJyk6DQogI
 CAgICAgICAgICAgICAgcHJpbnQgIlUyRi4gUHJlcGFyZSBmb3Igc3RlcCAyLiBDYWxsIEZJRE8g
 VTJGIGluIG9yZGVyIHRvIGZpbmlzaCBhdXRoZW50aWNhdGlvbiB3b3JrZmxvdyINCiAgICAgICA
 gICAgICAgICBhdXRoZW50aWNhdGlvblJlcXVlc3RTZXJ2aWNlID0gRmlkb1UyZkNsaWVudEZhY3
 RvcnkuaW5zdGFuY2UoKS5jcmVhdGVBdXRoZW50aWNhdGlvblJlcXVlc3RTZXJ2aWNlKHNlbGYub
 WV0YURhdGFDb25maWd1cmF0aW9uKQ0KICAgICAgICAgICAgICAgIGF1dGhlbnRpY2F0aW9uU3Rh
 dHVzID0gYXV0aGVudGljYXRpb25SZXF1ZXN0U2VydmljZS5maW5pc2hBdXRoZW50aWNhdGlvbih
 1c2VyLmdldFVzZXJJZCgpLCB0b2tlbl9yZXNwb25zZSkNCg0KICAgICAgICAgICAgICAgIGlmIC
 hhdXRoZW50aWNhdGlvblN0YXR1cy5nZXRTdGF0dXMoKSAhPSBDb25zdGFudHMuUkVTVUxUX1NVQ
 0NFU1MpOg0KICAgICAgICAgICAgICAgICAgICBwcmludCAiVTJGLiBBdXRoZW50aWNhdGUgZm9y
 IHN0ZXAgMi4gR2V0IGludmFsaWQgYXV0aGVudGljYXRpb24gc3RhdHVzIGZyb20gRklETyBVMkY
 gc2VydmVyIg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgIC
 AgICAgIHJldHVybiBUcnVlDQogICAgICAgICAgICBlbGlmIChhdXRoX21ldGhvZCA9PSAnZW5yb
 2xsJyk6DQogICAgICAgICAgICAgICAgcHJpbnQgIlUyRi4gUHJlcGFyZSBmb3Igc3RlcCAyLiBD
 YWxsIEZJRE8gVTJGIGluIG9yZGVyIHRvIGZpbmlzaCByZWdpc3RyYXRpb24gd29ya2Zsb3ciDQo
 gICAgICAgICAgICAgICAgcmVnaXN0cmF0aW9uUmVxdWVzdFNlcnZpY2UgPSBGaWRvVTJmQ2xpZW
 50RmFjdG9yeS5pbnN0YW5jZSgpLmNyZWF0ZVJlZ2lzdHJhdGlvblJlcXVlc3RTZXJ2aWNlKHNlb
 GYubWV0YURhdGFDb25maWd1cmF0aW9uKQ0KICAgICAgICAgICAgICAgIHJlZ2lzdHJhdGlvblN0
 YXR1cyA9IHJlZ2lzdHJhdGlvblJlcXVlc3RTZXJ2aWNlLmZpbmlzaFJlZ2lzdHJhdGlvbih1c2V
 yLmdldFVzZXJJZCgpLCB0b2tlbl9yZXNwb25zZSkNCg0KICAgICAgICAgICAgICAgIGlmIChyZW
 dpc3RyYXRpb25TdGF0dXMuZ2V0U3RhdHVzKCkgIT0gQ29uc3RhbnRzLlJFU1VMVF9TVUNDRVNTK
 ToNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgIlUyRi4gQXV0aGVudGljYXRlIGZvciBzdGVw
 IDIuIEdldCBpbnZhbGlkIHJlZ2lzdHJhdGlvbiBzdGF0dXMgZnJvbSBGSURPIFUyRiBzZXJ2ZXI
 iDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgICAgICAgICAgcm
 V0dXJuIFRydWUNCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgcHJpbnQgIlUyR
 i4gUHJlcGFyZSBmb3Igc3RlcCAyLiBBdXRoZW50aWNhdGlvZCBtZXRob2QgaXMgaW52YWxpZCIN
 CiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICAgcmV0dXJuIEZhbHN
 lDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgIGRlZiBwcm
 VwYXJlRm9yU3RlcChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywgcmVxdWVzdFBhcmFtZ
 XRlcnMsIHN0ZXApOg0KICAgICAgICBjb250ZXh0ID0gQ29udGV4dHMuZ2V0RXZlbnRDb250ZXh0
 KCkNCg0KICAgICAgICBpZiAoc3RlcCA9PSAxKToNCiAgICAgICAgICAgIHJldHVybiBUcnVlDQo
 gICAgICAgIGVsaWYgKHN0ZXAgPT0gMik6DQogICAgICAgICAgICBwcmludCAiVTJGLiBQcmVwYX
 JlIGZvciBzdGVwIDIiDQoNCiAgICAgICAgICAgIGNyZWRlbnRpYWxzID0gSWRlbnRpdHkuaW5zd
 GFuY2UoKS5nZXRDcmVkZW50aWFscygpDQogICAgICAgICAgICB1c2VyID0gY3JlZGVudGlhbHMu
 Z2V0VXNlcigpDQoNCiAgICAgICAgICAgIGlmICh1c2VyID09IE5vbmUpOg0KICAgICAgICAgICA
 gICAgIHByaW50ICJVMkYuIFByZXBhcmUgZm9yIHN0ZXAgMi4gRmFpbGVkIHRvIGRldGVybWluZS
 B1c2VyIG5hbWUiDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgI
 HUyZl9hcHBsaWNhdGlvbl9pZCA9IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmdldCgidTJmX2Fw
 cGxpY2F0aW9uX2lkIikuZ2V0VmFsdWUyKCkNCg0KICAgICAgICAgICAgIyBDaGVjayBpZiB1c2V
 yIGhhdmUgcmVnaXN0ZXJlZCBkZXZpY2VzDQogICAgICAgICAgICBkZXZpY2VSZWdpc3RyYXRpb2
 5TZXJ2aWNlID0gRGV2aWNlUmVnaXN0cmF0aW9uU2VydmljZS5pbnN0YW5jZSgpDQoNCiAgICAgI
 CAgICAgIHVzZXJJbnVtID0gdXNlci5nZXRBdHRyaWJ1dGUoImludW0iKQ0KDQogICAgICAgICAg
 ICBhdXRoZW50aWNhdGlvblJlcXVlc3QgPSBOb25lDQoNCiAgICAgICAgICAgIGRldmljZVJlZ2l
 zdHJhdGlvbnMgPSBkZXZpY2VSZWdpc3RyYXRpb25TZXJ2aWNlLmZpbmRVc2VyRGV2aWNlUmVnaX
 N0cmF0aW9ucyh1c2VySW51bSwgdTJmX2FwcGxpY2F0aW9uX2lkKQ0KICAgICAgICAgICAgaWYgK
 GRldmljZVJlZ2lzdHJhdGlvbnMuc2l6ZSgpID4gMCk6DQogICAgICAgICAgICAgICAgcHJpbnQg
 IlUyRi4gUHJlcGFyZSBmb3Igc3RlcCAyLiBDYWxsIEZJRE8gVTJGIGluIG9yZGVyIHRvIHN0YXJ
 0IGF1dGhlbnRpY2F0aW9uIHdvcmtmbG93Ig0KDQogICAgICAgICAgICAgICAgdHJ5Og0KICAgIC
 AgICAgICAgICAgICAgICBhdXRoZW50aWNhdGlvblJlcXVlc3RTZXJ2aWNlID0gRmlkb1UyZkNsa
 WVudEZhY3RvcnkuaW5zdGFuY2UoKS5jcmVhdGVBdXRoZW50aWNhdGlvblJlcXVlc3RTZXJ2aWNl
 KHNlbGYubWV0YURhdGFDb25maWd1cmF0aW9uKQ0KICAgICAgICAgICAgICAgICAgICBhdXRoZW5
 0aWNhdGlvblJlcXVlc3QgPSBhdXRoZW50aWNhdGlvblJlcXVlc3RTZXJ2aWNlLnN0YXJ0QXV0aG
 VudGljYXRpb24odXNlci5nZXRVc2VySWQoKSwgdTJmX2FwcGxpY2F0aW9uX2lkKQ0KICAgICAgI
 CAgICAgICAgIGV4Y2VwdCBDbGllbnRSZXNwb25zZUZhaWx1cmUsIGV4Og0KICAgICAgICAgICAg
 ICAgICAgICBpZiAoZXguZ2V0UmVzcG9uc2UoKS5nZXRSZXNwb25zZVN0YXR1cygpICE9IFJlc3B
 vbnNlLlN0YXR1cy5OT1RfRk9VTkQpOg0KICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgIl
 UyRi4gUHJlcGFyZSBmb3Igc3RlcCAyLiBGYWlsZWQgdG8gc3RhcnQgYXV0aGVudGljYXRpb24gd
 29ya2Zsb3cuIEV4Y2VwdGlvbjoiLCBzeXMuZXhjX2luZm8oKVsxXQ0KICAgICAgICAgICAgICAg
 ICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgIHByaW50ICJVMkYuIFByZXBhcmU
 gZm9yIHN0ZXAgMi4gQ2FsbCBGSURPIFUyRiBpbiBvcmRlciB0byBzdGFydCByZWdpc3RyYXRpb2
 4gd29ya2Zsb3ciDQogICAgICAgICAgICByZWdpc3RyYXRpb25SZXF1ZXN0U2VydmljZSA9IEZpZ
 G9VMmZDbGllbnRGYWN0b3J5Lmluc3RhbmNlKCkuY3JlYXRlUmVnaXN0cmF0aW9uUmVxdWVzdFNl
 cnZpY2Uoc2VsZi5tZXRhRGF0YUNvbmZpZ3VyYXRpb24pDQogICAgICAgICAgICByZWdpc3RyYXR
 pb25SZXF1ZXN0ID0gcmVnaXN0cmF0aW9uUmVxdWVzdFNlcnZpY2Uuc3RhcnRSZWdpc3RyYXRpb2
 4odXNlci5nZXRVc2VySWQoKSwgdTJmX2FwcGxpY2F0aW9uX2lkKQ0KDQogICAgICAgICAgICBjb
 250ZXh0LnNldCgiZmlkb191MmZfYXV0aGVudGljYXRpb25fcmVxdWVzdCIsIFNlcnZlclV0aWwu
 YXNKc29uKGF1dGhlbnRpY2F0aW9uUmVxdWVzdCkpDQogICAgICAgICAgICBjb250ZXh0LnNldCg
 iZmlkb191MmZfcmVnaXN0cmF0aW9uX3JlcXVlc3QiLCBTZXJ2ZXJVdGlsLmFzSnNvbihyZWdpc3
 RyYXRpb25SZXF1ZXN0KSkNCg0KICAgICAgICAgICAgcmV0dXJuIFRydWUNCiAgICAgICAgZWxpZ
 iAoc3RlcCA9PSAzKToNCiAgICAgICAgICAgIHByaW50ICJVMkYuIFByZXBhcmUgZm9yIHN0ZXAg
 MiINCg0KICAgICAgICAgICAgcmV0dXJuIFRydWUNCiAgICAgICAgZWxzZToNCiAgICAgICAgICA
 gIHJldHVybiBGYWxzZQ0KDQogICAgZGVmIGdldEV4dHJhUGFyYW1ldGVyc0ZvclN0ZXAoc2VsZi
 wgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHN0ZXApOg0KICAgICAgICByZXR1cm4gTm9uZQ0KD
 QogICAgZGVmIGdldENvdW50QXV0aGVudGljYXRpb25TdGVwcyhzZWxmLCBjb25maWd1cmF0aW9u
 QXR0cmlidXRlcyk6DQogICAgICAgIHJldHVybiAyDQoNCiAgICBkZWYgZ2V0UGFnZUZvclN0ZXA
 oc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHN0ZXApOg0KICAgICAgICBpZiAoc3RlcC
 A9PSAyKToNCiAgICAgICAgICAgIHJldHVybiAiL2F1dGgvdTJmL2xvZ2luLnhodG1sIg0KDQogI
 CAgICAgIHJldHVybiAiIg0KDQogICAgZGVmIGxvZ291dChzZWxmLCBjb25maWd1cmF0aW9uQXR0
 cmlidXRlcywgcmVxdWVzdFBhcmFtZXRlcnMpOg0KICAgICAgICByZXR1cm4gVHJ1ZQ0K
oxScriptType: person_authentication
programmingLanguage: python

dn: inum=%(inumOrg)s!5018.F9CF,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: DUO authentication module
displayName: duo
gluuStatus: false
inum: %(inumOrg)s!5018.F9CF
oxConfigurationProperty: {"value1":"duo_creds_file","value2":"/etc/certs/duo
 _creds.json","description":""}
oxConfigurationProperty: {"value1":"duo_host","value2":"api-random.duosecuri
 ty.com","description":""}
oxLevel: 20
oxModuleProperty: {"value1":"usage_type","value2":"interactive","description
 ":""}
oxRevision: 1
oxScript:: ZnJvbSBvcmcuamJvc3Muc2VhbS5jb250ZXh0cyBpbXBvcnQgQ29udGV4dCwgQ29ud
 GV4dHMNCmZyb20gb3JnLmpib3NzLnNlYW0uc2VjdXJpdHkgaW1wb3J0IElkZW50aXR5DQpmcm9t
 IG9yZy54ZGkubW9kZWwuY3VzdG9tLnNjcmlwdC50eXBlLmF1dGggaW1wb3J0IFBlcnNvbkF1dGh
 lbnRpY2F0aW9uVHlwZQ0KZnJvbSBvcmcueGRpLm94YXV0aC5zZXJ2aWNlIGltcG9ydCBVc2VyU2
 VydmljZQ0KZnJvbSBvcmcueGRpLm94YXV0aC5zZXJ2aWNlIGltcG9ydCBVc2VyR3JvdXBTZXJ2a
 WNlDQpmcm9tIG9yZy54ZGkuc2VydmljZSBpbXBvcnQgTWFpbFNlcnZpY2UNCmZyb20gb3JnLnhk
 aS51dGlsIGltcG9ydCBTdHJpbmdIZWxwZXINCmZyb20gb3JnLnhkaS51dGlsIGltcG9ydCBBcnJ
 heUhlbHBlcg0KDQppbXBvcnQgamF2YQ0KaW1wb3J0IGR1b193ZWINCnRyeToNCiAgICBpbXBvcn
 QganNvbg0KZXhjZXB0IEltcG9ydEVycm9yOg0KICAgIGltcG9ydCBzaW1wbGVqc29uIGFzIGpzb
 24NCg0KY2xhc3MgUGVyc29uQXV0aGVudGljYXRpb24oUGVyc29uQXV0aGVudGljYXRpb25UeXBl
 KToNCiAgICBkZWYgX19pbml0X18oc2VsZiwgY3VycmVudFRpbWVNaWxsaXMpOg0KICAgICAgICB
 zZWxmLmN1cnJlbnRUaW1lTWlsbGlzID0gY3VycmVudFRpbWVNaWxsaXMNCg0KICAgIGRlZiBpbm
 l0KHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcHJpbnQgIkR1by4gS
 W5pdGlhbGl6YXRpb24iDQoNCiAgICAgICAgZHVvX2NyZWRzX2ZpbGUgPSBjb25maWd1cmF0aW9u
 QXR0cmlidXRlcy5nZXQoImR1b19jcmVkc19maWxlIikuZ2V0VmFsdWUyKCkNCiAgICAgICAgIyB
 Mb2FkIGNyZWRlbnRpYWxzIGZyb20gZmlsZQ0KICAgICAgICBmID0gb3BlbihkdW9fY3JlZHNfZm
 lsZSwgJ3InKQ0KICAgICAgICB0cnk6DQogICAgICAgICAgICBjcmVkcyA9IGpzb24ubG9hZHMoZ
 i5yZWFkKCkpDQogICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgIHByaW50ICJEdW8uIEluaXRp
 YWxpemF0aW9uLiBGYWlsZWQgdG8gbG9hZCBjcmVkcyBmcm9tIGZpbGU6IiwgZHVvX2NyZWRzX2Z
 pbGUNCiAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KICAgICAgICBmaW5hbGx5Og0KICAgICAgIC
 AgICAgZi5jbG9zZSgpDQoNCiAgICAgICAgc2VsZi5pa2V5ID0gY3JlZHNbImlrZXkiXQ0KICAgI
 CAgICBzZWxmLnNrZXkgPSBjcmVkc1sic2tleSJdDQogICAgICAgIHNlbGYuYWtleSA9IGNyZWRz
 WyJha2V5Il0NCg0KICAgICAgICBzZWxmLnVzZV9kdW9fZ3JvdXAgPSBGYWxzZQ0KICAgICAgICB
 pZiAoY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuY29udGFpbnNLZXkoImR1b19ncm91cCIpKToNCi
 AgICAgICAgICAgIHNlbGYuZHVvX2dyb3VwID0gY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuZ2V0K
 CJkdW9fZ3JvdXAiKS5nZXRWYWx1ZTIoKQ0KICAgICAgICAgICAgc2VsZi51c2VfZHVvX2dyb3Vw
 ID0gVHJ1ZQ0KICAgICAgICAgICAgcHJpbnQgIkR1by4gSW5pdGlhbGl6YXRpb24uIFVzaW5nIER
 1byBvbmx5IGlmIHVzZXIgYmVsb25nIHRvIGdyb3VwOiIsIHNlbGYuZHVvX2dyb3VwDQoNCiAgIC
 AgICAgc2VsZi51c2VfYXVkaXRfZ3JvdXAgPSBGYWxzZQ0KICAgICAgICBpZiAoY29uZmlndXJhd
 GlvbkF0dHJpYnV0ZXMuY29udGFpbnNLZXkoImF1ZGl0X2dyb3VwIikpOg0KICAgICAgICAgICAg
 c2VsZi5hdWRpdF9ncm91cCA9IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmdldCgiYXVkaXRfZ3J
 vdXAiKS5nZXRWYWx1ZTIoKQ0KDQogICAgICAgICAgICBpZiAobm90IGNvbmZpZ3VyYXRpb25BdH
 RyaWJ1dGVzLmNvbnRhaW5zS2V5KCJhdWRpdF9ncm91cF9lbWFpbCIpKToNCiAgICAgICAgICAgI
 CAgICBwcmludCAiRHVvLiBJbml0aWFsaXphdGlvbi4gUHJvcGVydHkgYXVkaXRfZ3JvdXBfZW1h
 aWwgaXMgbm90IHNwZWNpZmllZCINCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICA
 gICAgICAgICAgc2VsZi5hdWRpdF9lbWFpbCA9IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmdldC
 giYXVkaXRfZ3JvdXBfZW1haWwiKS5nZXRWYWx1ZTIoKQ0KICAgICAgICAgICAgc2VsZi51c2VfY
 XVkaXRfZ3JvdXAgPSBUcnVlDQoNCiAgICAgICAgICAgIHByaW50ICJEdW8uIEluaXRpYWxpemF0
 aW9uLiBVc2luZyBhdWRpdG8gZ3JvdXA6Iiwgc2VsZi5hdWRpdF9ncm91cA0KICAgICAgICAgICA
 gDQogICAgICAgIGlmIChzZWxmLnVzZV9kdW9fZ3JvdXAgb3Igc2VsZi51c2VfYXVkaXRfZ3JvdX
 ApOg0KICAgICAgICAgICAgaWYgKG5vdCBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5jb250YWluc
 0tleSgiYXVkaXRfYXR0cmlidXRlIikpOg0KICAgICAgICAgICAgICAgIHByaW50ICJEdW8uIElu
 aXRpYWxpemF0aW9uLiBQcm9wZXJ0eSBhdWRpdF9hdHRyaWJ1dGUgaXMgbm90IHNwZWNpZmllZCI
 NCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCiAgICAgICAgICAgIGVsc2U6DQogICAgIC
 AgICAgICAgICAgc2VsZi5hdWRpdF9hdHRyaWJ1dGUgPSBjb25maWd1cmF0aW9uQXR0cmlidXRlc
 y5nZXQoImF1ZGl0X2F0dHJpYnV0ZSIpLmdldFZhbHVlMigpDQoNCg0KICAgICAgICBwcmludCAi
 RHVvLiBJbml0aWFsaXplZCBzdWNjZXNzZnVsbHkiDQogICAgICAgIHJldHVybiBUcnVlICAgDQo
 NCiAgICBkZWYgZGVzdHJveShzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgIC
 AgIHByaW50ICJEdW8uIERlc3Ryb3kiDQogICAgICAgIHByaW50ICJEdW8uIERlc3Ryb3llZCBzd
 WNjZXNzZnVsbHkiDQogICAgICAgIHJldHVybiBUcnVlDQoNCiAgICBkZWYgZ2V0QXBpVmVyc2lv
 bihzZWxmKToNCiAgICAgICAgcmV0dXJuIDENCg0KICAgIGRlZiBpc1ZhbGlkQXV0aGVudGljYXR
 pb25NZXRob2Qoc2VsZiwgdXNhZ2VUeXBlLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogIC
 AgICAgIHJldHVybiBUcnVlDQoNCiAgICBkZWYgZ2V0QWx0ZXJuYXRpdmVBdXRoZW50aWNhdGlvb
 k1ldGhvZChzZWxmLCB1c2FnZVR5cGUsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAg
 ICAgcmV0dXJuIE5vbmUNCg0KICAgIGRlZiBhdXRoZW50aWNhdGUoc2VsZiwgY29uZmlndXJhdGl
 vbkF0dHJpYnV0ZXMsIHJlcXVlc3RQYXJhbWV0ZXJzLCBzdGVwKToNCiAgICAgICAgZHVvX2hvc3
 QgPSBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5nZXQoImR1b19ob3N0IikuZ2V0VmFsdWUyKCkNC
 g0KICAgICAgICBjcmVkZW50aWFscyA9IElkZW50aXR5Lmluc3RhbmNlKCkuZ2V0Q3JlZGVudGlh
 bHMoKQ0KICAgICAgICB1c2VyX25hbWUgPSBjcmVkZW50aWFscy5nZXRVc2VybmFtZSgpDQoNCiA
 gICAgICAgaWYgKHN0ZXAgPT0gMSk6DQogICAgICAgICAgICBwcmludCAiRHVvLiBBdXRoZW50aW
 NhdGUgZm9yIHN0ZXAgMSINCg0KICAgICAgICAgICAgdXNlcl9wYXNzd29yZCA9IGNyZWRlbnRpY
 WxzLmdldFBhc3N3b3JkKCkNCiAgICAgICAgICAgIGxvZ2dlZF9pbiA9IEZhbHNlDQogICAgICAg
 ICAgICBpZiAoU3RyaW5nSGVscGVyLmlzTm90RW1wdHlTdHJpbmcodXNlcl9uYW1lKSBhbmQgU3R
 yaW5nSGVscGVyLmlzTm90RW1wdHlTdHJpbmcodXNlcl9wYXNzd29yZCkpOg0KICAgICAgICAgIC
 AgICAgIHVzZXJTZXJ2aWNlID0gVXNlclNlcnZpY2UuaW5zdGFuY2UoKQ0KICAgICAgICAgICAgI
 CAgIGxvZ2dlZF9pbiA9IHVzZXJTZXJ2aWNlLmF1dGhlbnRpY2F0ZSh1c2VyX25hbWUsIHVzZXJf
 cGFzc3dvcmQpDQoNCiAgICAgICAgICAgIGlmIChub3QgbG9nZ2VkX2luKToNCiAgICAgICAgICA
 gICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICAgdXNlciA9IGNyZWRlbnRpYWxzLmdldF
 VzZXIoKQ0KICAgICAgICAgICAgaWYgKHNlbGYudXNlX2R1b19ncm91cCk6DQogICAgICAgICAgI
 CAgICAgcHJpbnQgIkR1by4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIENoZWNraW5nIGlmIHVz
 ZXIgYmVsb25nIHRvIER1byBncm91cCINCiAgICAgICAgICAgICAgICBpc19tZW1iZXJfZHVvX2d
 yb3VwID0gc2VsZi5pc1VzZXJNZW1iZXJPZkdyb3VwKHVzZXIsIHNlbGYuYXVkaXRfYXR0cmlidX
 RlLCBzZWxmLmR1b19ncm91cCkNCiAgICAgICAgICAgICAgICBpZiAoaXNfbWVtYmVyX2R1b19nc
 m91cCk6DQogICAgICAgICAgICAgICAgICAgIHByaW50ICJEdW8uIEF1dGhlbnRpY2F0ZSBmb3Ig
 c3RlcCAxLiBVc2VyICciICsgdXNlci5nZXRVc2VySWQoKSArICInIG1lbWJlciBvZiBEdW8gZ3J
 vdXAiDQogICAgICAgICAgICAgICAgICAgIGR1b19jb3VudF9sb2dpbl9zdGVwcyA9IDINCiAgIC
 AgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICBzZWxmLnByb2Nlc3NBdWRpd
 Edyb3VwKHVzZXIpDQogICAgICAgICAgICAgICAgICAgIGR1b19jb3VudF9sb2dpbl9zdGVwcyA9
 IDENCg0KICAgICAgICAgICAgICAgIGNvbnRleHQgPSBDb250ZXh0cy5nZXRFdmVudENvbnRleHQ
 oKQ0KICAgICAgICAgICAgICAgIGNvbnRleHQuc2V0KCJkdW9fY291bnRfbG9naW5fc3RlcHMiLC
 BkdW9fY291bnRfbG9naW5fc3RlcHMpDQoNCiAgICAgICAgICAgIHJldHVybiBUcnVlDQogICAgI
 CAgIGVsaWYgKHN0ZXAgPT0gMik6DQogICAgICAgICAgICBwcmludCAiRHVvLiBBdXRoZW50aWNh
 dGUgZm9yIHN0ZXAgMiINCg0KICAgICAgICAgICAgc2lnX3Jlc3BvbnNlX2FycmF5ID0gcmVxdWV
 zdFBhcmFtZXRlcnMuZ2V0KCJzaWdfcmVzcG9uc2UiKQ0KICAgICAgICAgICAgaWYgQXJyYXlIZW
 xwZXIuaXNFbXB0eShzaWdfcmVzcG9uc2VfYXJyYXkpOg0KICAgICAgICAgICAgICAgIHByaW50I
 CJEdW8uIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAyLiBzaWdfcmVzcG9uc2UgaXMgZW1wdHkiDQog
 ICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgIGR1b19zaWdfcmVzcG9
 uc2UgPSBzaWdfcmVzcG9uc2VfYXJyYXlbMF0NCg0KICAgICAgICAgICAgcHJpbnQgIkR1by4gQX
 V0aGVudGljYXRlIGZvciBzdGVwIDIuIGR1b19zaWdfcmVzcG9uc2U6ICIgKyBkdW9fc2lnX3Jlc
 3BvbnNlDQoNCiAgICAgICAgICAgIGF1dGhlbnRpY2F0ZWRfdXNlcm5hbWUgPSBkdW9fd2ViLnZl
 cmlmeV9yZXNwb25zZShzZWxmLmlrZXksIHNlbGYuc2tleSwgc2VsZi5ha2V5LCBkdW9fc2lnX3J
 lc3BvbnNlKQ0KDQogICAgICAgICAgICBwcmludCAiRHVvLiBBdXRoZW50aWNhdGUgZm9yIHN0ZX
 AgMi4gYXV0aGVudGljYXRlZF91c2VybmFtZTogIiArIGF1dGhlbnRpY2F0ZWRfdXNlcm5hbWUgK
 yAiLCBleHBlY3RlZCB1c2VyX25hbWU6ICIgKyB1c2VyX25hbWUNCg0KICAgICAgICAgICAgaWYg
 KG5vdCBTdHJpbmdIZWxwZXIuZXF1YWxzKHVzZXJfbmFtZSwgYXV0aGVudGljYXRlZF91c2VybmF
 tZSkpOg0KICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgICAgICBzZWxmLn
 Byb2Nlc3NBdWRpdEdyb3VwKGNyZWRlbnRpYWxzLmdldFVzZXIoKSkNCg0KICAgICAgICAgICAgc
 mV0dXJuIFRydWUNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQog
 ICAgZGVmIHByZXBhcmVGb3JTdGVwKHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCByZXF
 1ZXN0UGFyYW1ldGVycywgc3RlcCk6DQogICAgICAgIGNvbnRleHQgPSBDb250ZXh0cy5nZXRFdm
 VudENvbnRleHQoKQ0KDQogICAgICAgIGR1b19ob3N0ID0gY29uZmlndXJhdGlvbkF0dHJpYnV0Z
 XMuZ2V0KCJkdW9faG9zdCIpLmdldFZhbHVlMigpDQoNCiAgICAgICAgY3JlZGVudGlhbHMgPSBJ
 ZGVudGl0eS5pbnN0YW5jZSgpLmdldENyZWRlbnRpYWxzKCkNCiAgICAgICAgdXNlcl9uYW1lID0
 gY3JlZGVudGlhbHMuZ2V0VXNlcm5hbWUoKQ0KDQogICAgICAgIGlmIChzdGVwID09IDEpOg0KIC
 AgICAgICAgICAgcHJpbnQgIkR1by4gUHJlcGFyZSBmb3Igc3RlcCAxIg0KDQogICAgICAgICAgI
 CByZXR1cm4gVHJ1ZQ0KICAgICAgICBlbGlmIChzdGVwID09IDIpOg0KICAgICAgICAgICAgcHJp
 bnQgIkR1by4gUHJlcGFyZSBmb3Igc3RlcCAyIg0KDQogICAgICAgICAgICBkdW9fc2lnX3JlcXV
 lc3QgPSBkdW9fd2ViLnNpZ25fcmVxdWVzdChzZWxmLmlrZXksIHNlbGYuc2tleSwgc2VsZi5ha2
 V5LCB1c2VyX25hbWUpDQogICAgICAgICAgICBwcmludCAiRHVvLiBQcmVwYXJlIGZvciBzdGVwI
 DIuIGR1b19zaWdfcmVxdWVzdDogIiArIGR1b19zaWdfcmVxdWVzdA0KICAgICAgICAgICAgDQog
 ICAgICAgICAgICBjb250ZXh0LnNldCgiZHVvX2hvc3QiLCBkdW9faG9zdCkNCiAgICAgICAgICA
 gIGNvbnRleHQuc2V0KCJkdW9fc2lnX3JlcXVlc3QiLCBkdW9fc2lnX3JlcXVlc3QpDQoNCiAgIC
 AgICAgICAgIHJldHVybiBUcnVlDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gR
 mFsc2UNCg0KICAgIGRlZiBnZXRFeHRyYVBhcmFtZXRlcnNGb3JTdGVwKHNlbGYsIGNvbmZpZ3Vy
 YXRpb25BdHRyaWJ1dGVzLCBzdGVwKToNCiAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgIGRlZiB
 nZXRDb3VudEF1dGhlbnRpY2F0aW9uU3RlcHMoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZX
 MpOg0KICAgICAgICBjb250ZXh0ID0gQ29udGV4dHMuZ2V0RXZlbnRDb250ZXh0KCkNCiAgICAgI
 CAgaWYgKGNvbnRleHQuaXNTZXQoImR1b19jb3VudF9sb2dpbl9zdGVwcyIpKToNCiAgICAgICAg
 ICAgIHJldHVybiBjb250ZXh0LmdldCgiZHVvX2NvdW50X2xvZ2luX3N0ZXBzIikNCg0KICAgICA
 gICByZXR1cm4gMg0KDQogICAgZGVmIGdldFBhZ2VGb3JTdGVwKHNlbGYsIGNvbmZpZ3VyYXRpb2
 5BdHRyaWJ1dGVzLCBzdGVwKToNCiAgICAgICAgaWYgKHN0ZXAgPT0gMik6DQogICAgICAgICAgI
 CByZXR1cm4gIi9hdXRoL2R1by9kdW9sb2dpbi54aHRtbCINCiAgICAgICAgcmV0dXJuICIiDQoN
 CiAgICBkZWYgbG9nb3V0KHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCByZXF1ZXN0UGF
 yYW1ldGVycyk6DQogICAgICAgIHJldHVybiBUcnVlDQoNCiAgICBkZWYgaXNVc2VyTWVtYmVyT2
 ZHcm91cChzZWxmLCB1c2VyLCBhdHRyaWJ1dGUsIGdyb3VwKToNCiAgICAgICAgaXNfbWVtYmVyI
 D0gRmFsc2UNCiAgICAgICAgbWVtYmVyX29mX2xpc3QgPSB1c2VyLmdldEF0dHJpYnV0ZVZhbHVl
 cyhhdHRyaWJ1dGUpDQogICAgICAgIGlmIChtZW1iZXJfb2ZfbGlzdCAhPSBOb25lKToNCiAgICA
 gICAgICAgIGZvciBtZW1iZXJfb2YgaW4gbWVtYmVyX29mX2xpc3Q6DQogICAgICAgICAgICAgIC
 AgaWYgKFN0cmluZ0hlbHBlci5lcXVhbHNJZ25vcmVDYXNlKGdyb3VwLCBtZW1iZXJfb2YpKToNC
 iAgICAgICAgICAgICAgICAgICAgaXNfbWVtYmVyID0gVHJ1ZQ0KICAgICAgICAgICAgICAgICAg
 ICBicmVhaw0KDQogICAgICAgIHJldHVybiBpc19tZW1iZXINCg0KICAgIGRlZiBwcm9jZXNzQXV
 kaXRHcm91cChzZWxmLCB1c2VyKToNCiAgICAgICAgaWYgKHNlbGYudXNlX2F1ZGl0X2dyb3VwKT
 oNCiAgICAgICAgICAgIGlzX21lbWJlciA9IHNlbGYuaXNVc2VyTWVtYmVyT2ZHcm91cCh1c2VyL
 CBzZWxmLmF1ZGl0X2F0dHJpYnV0ZSwgc2VsZi5hdWRpdF9ncm91cCkNCiAgICAgICAgICAgIGlm
 IChpc19tZW1iZXIpOg0KICAgICAgICAgICAgICAgIHByaW50ICJEdW8uIEF1dGhlbnRpY2F0ZSB
 mb3IgcHJvY2Vzc0F1ZGl0R3JvdXAuIFVzZXIgJyIgKyB1c2VyLmdldFVzZXJJZCgpICsgIicgbW
 VtYmVyIG9mIGF1ZGl0IGdyb3VwIg0KICAgICAgICAgICAgICAgIHByaW50ICJEdW8uIEF1dGhlb
 nRpY2F0ZSBmb3IgcHJvY2Vzc0F1ZGl0R3JvdXAuIFNlbmRpbmcgZS1tYWlsIGFib3V0IHVzZXIg
 JyIgKyB1c2VyLmdldFVzZXJJZCgpICsgIicgbG9naW4gdG8iLCBzZWxmLmF1ZGl0X2VtYWlsDQo
 gICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgIyBTZW5kIGUtbWFpbCB0byBhZG1pbm
 lzdHJhdG9yDQogICAgICAgICAgICAgICAgdXNlcl9pZCA9IHVzZXIuZ2V0VXNlcklkKCkNCiAgI
 CAgICAgICAgICAgICBtYWlsU2VydmljZSA9IE1haWxTZXJ2aWNlLmluc3RhbmNlKCkNCiAgICAg
 ICAgICAgICAgICBzdWJqZWN0ID0gIlVzZXIgbG9nIGluOiAiICsgdXNlcl9pZA0KICAgICAgICA
 gICAgICAgIGJvZHkgPSAiVXNlciBsb2cgaW46ICIgKyB1c2VyX2lkDQogICAgICAgICAgICAgIC
 AgbWFpbFNlcnZpY2Uuc2VuZE1haWwoc2VsZi5hdWRpdF9lbWFpbCwgc3ViamVjdCwgYm9keSkNC
 g==
oxScriptType: person_authentication
programmingLanguage: python

dn: inum=%(inumOrg)s!14AF.A70C,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: CAS authentication module
displayName: cas
gluuStatus: false
inum: %(inumOrg)s!14AF.A70C
oxConfigurationProperty: {"value1":"cas_map_user","value2":"true","description":""}
oxConfigurationProperty: {"value1":"cas_renew_opt","value2":"false","description":""}
oxConfigurationProperty: {"value1":"cas_host","value2":"https://%(hostname)s/cas","description":""}
oxLevel: 30
oxModuleProperty: {"value1":"usage_type","value2":"interactive","description":""}
oxRevision: 1
oxScript:: ZnJvbSBvcmcuamJvc3Muc2VhbS5jb250ZXh0cyBpbXBvcnQgQ29udGV4dCwgQ29ud
 GV4dHMNCmZyb20gb3JnLmpib3NzLnNlYW0uc2VjdXJpdHkgaW1wb3J0IElkZW50aXR5DQpmcm9t
 IG9yZy5qYm9zcy5zZWFtIGltcG9ydCBDb21wb25lbnQNCmZyb20gamF2YXguZmFjZXMuY29udGV
 4dCBpbXBvcnQgRmFjZXNDb250ZXh0DQpmcm9tIG9yZy5qYm9zcy5zZWFtIGltcG9ydCBDb21wb2
 5lbnQNCmZyb20gb3JnLmFwYWNoZS5odHRwLmVudGl0eSBpbXBvcnQgQ29udGVudFR5cGUgDQpmc
 m9tIG9yZy54ZGkubW9kZWwuY3VzdG9tLnNjcmlwdC50eXBlLmF1dGggaW1wb3J0IFBlcnNvbkF1
 dGhlbnRpY2F0aW9uVHlwZQ0KZnJvbSBvcmcueGRpLm94YXV0aC5zZXJ2aWNlIGltcG9ydCBVc2V
 yU2VydmljZQ0KZnJvbSBvcmcueGRpLm94YXV0aC5zZXJ2aWNlIGltcG9ydCBBdXRoZW50aWNhdG
 lvblNlcnZpY2UNCmZyb20gb3JnLnhkaS5veGF1dGguc2VydmljZS5uZXQgaW1wb3J0IEh0dHBTZ
 XJ2aWNlDQpmcm9tIG9yZy54ZGkudXRpbCBpbXBvcnQgU3RyaW5nSGVscGVyDQpmcm9tIG9yZy54
 ZGkudXRpbCBpbXBvcnQgQXJyYXlIZWxwZXINCmZyb20gb3JnLmFwYWNoZS5odHRwLnBhcmFtcyB
 pbXBvcnQgQ29yZUNvbm5lY3Rpb25QTmFtZXMNCmZyb20gamF2YS51dGlsIGltcG9ydCBBcnJheX
 MNCmZyb20gamF2YS51dGlsIGltcG9ydCBIYXNoTWFwDQoNCmltcG9ydCBqYXZhDQppbXBvcnQgc
 3lzDQoNCmNsYXNzIFBlcnNvbkF1dGhlbnRpY2F0aW9uKFBlcnNvbkF1dGhlbnRpY2F0aW9uVHlw
 ZSk6DQogICAgZGVmIF9faW5pdF9fKHNlbGYsIGN1cnJlbnRUaW1lTWlsbGlzKToNCiAgICAgICA
 gc2VsZi5jdXJyZW50VGltZU1pbGxpcyA9IGN1cnJlbnRUaW1lTWlsbGlzDQoNCiAgICBkZWYgaW
 5pdChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHByaW50ICJDQVMyL
 iBJbml0aWFsaXphdGlvbiINCiAgICAgICAgcHJpbnQgIkNBUzIuIEluaXRpYWxpemVkIHN1Y2Nl
 c3NmdWxseSINCiAgICAgICAgcmV0dXJuIFRydWUgICANCg0KICAgIGRlZiBkZXN0cm95KHNlbGY
 sIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcHJpbnQgIkNBUzIuIERlc3Ryb3
 kiDQogICAgICAgIHByaW50ICJDQVMyLiBEZXN0cm95ZWQgc3VjY2Vzc2Z1bGx5Ig0KICAgICAgI
 CByZXR1cm4gVHJ1ZQ0KDQogICAgZGVmIGdldEFwaVZlcnNpb24oc2VsZik6DQogICAgICAgIHJl
 dHVybiAxDQoNCiAgICBkZWYgaXNWYWxpZEF1dGhlbnRpY2F0aW9uTWV0aG9kKHNlbGYsIHVzYWd
 lVHlwZSwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICBwcmludCAiQ0FTMi4gUm
 VzdCBBUEkgYXV0aGVudGljYXRlIGlzVmFsaWRBdXRoZW50aWNhdGlvbk1ldGhvZCINCg0KICAgI
 CAgICBpZiAobm90IChjb25maWd1cmF0aW9uQXR0cmlidXRlcy5jb250YWluc0tleSgiY2FzX3Zh
 bGlkYXRpb25fdXJpIikgYW5kDQogICAgICAgICAgICBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5
 jb250YWluc0tleSgiY2FzX3ZhbGlkYXRpb25fcGF0dGVybiIpIGFuZA0KICAgICAgICAgICAgY2
 9uZmlndXJhdGlvbkF0dHJpYnV0ZXMuY29udGFpbnNLZXkoImNhc192YWxpZGF0aW9uX3RpbWVvd
 XQiKSkpOg0KICAgICAgICAgICAgcmV0dXJuIFRydWUNCg0KICAgICAgICBjYXNfdmFsaWRhdGlv
 bl91cmkgPSBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5nZXQoImNhc192YWxpZGF0aW9uX3VyaSI
 pLmdldFZhbHVlMigpDQogICAgICAgIGNhc192YWxpZGF0aW9uX3BhdHRlcm4gPSBjb25maWd1cm
 F0aW9uQXR0cmlidXRlcy5nZXQoImNhc192YWxpZGF0aW9uX3BhdHRlcm4iKS5nZXRWYWx1ZTIoK
 Q0KICAgICAgICBjYXNfdmFsaWRhdGlvbl90aW1lb3V0ID0gaW50KGNvbmZpZ3VyYXRpb25BdHRy
 aWJ1dGVzLmdldCgiY2FzX3ZhbGlkYXRpb25fdGltZW91dCIpLmdldFZhbHVlMigpKSAqIDEwMDA
 NCg0KICAgICAgICBodHRwU2VydmljZSA9IEh0dHBTZXJ2aWNlLmluc3RhbmNlKCk7DQoNCiAgIC
 AgICAgaHR0cF9jbGllbnQgPSBodHRwU2VydmljZS5nZXRIdHRwc0NsaWVudCgpOw0KICAgICAgI
 CBodHRwX2NsaWVudF9wYXJhbXMgPSBodHRwX2NsaWVudC5nZXRQYXJhbXMoKTsNCiAgICAgICAg
 aHR0cF9jbGllbnRfcGFyYW1zLnNldEludFBhcmFtZXRlcihDb3JlQ29ubmVjdGlvblBOYW1lcy5
 DT05ORUNUSU9OX1RJTUVPVVQsIGNhc192YWxpZGF0aW9uX3RpbWVvdXQpOw0KDQogICAgICAgIH
 RyeToNCiAgICAgICAgICAgIGh0dHBfc2VydmljZV9yZXNwb25zZSA9IGh0dHBTZXJ2aWNlLmV4Z
 WN1dGVHZXQoaHR0cF9jbGllbnQsIGNhc192YWxpZGF0aW9uX3VyaSkNCiAgICAgICAgICAgIGh0
 dHBfcmVzcG9uc2UgPSBodHRwX3NlcnZpY2VfcmVzcG9uc2UuZ2V0SHR0cFJlc3BvbnNlKCkNCiA
 gICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgcHJpbnQgIkNBUzIuIFJlc3QgQVBJIGF1dGhlbn
 RpY2F0ZSBpc1ZhbGlkQXV0aGVudGljYXRpb25NZXRob2QuIEV4Y2VwdGlvbjogIiwgc3lzLmV4Y
 19pbmZvKClbMV0NCiAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgIHRyeToNCiAg
 ICAgICAgICAgIGlmIChodHRwX3Jlc3BvbnNlLmdldFN0YXR1c0xpbmUoKS5nZXRTdGF0dXNDb2R
 lKCkgIT0gMjAwKToNCiAgICAgICAgICAgICAgICBwcmludCAiQ0FTMi4gUmVzdCBBUEkgYXV0aG
 VudGljYXRlIGlzVmFsaWRBdXRoZW50aWNhdGlvbk1ldGhvZC4gR2V0IGludmFsaWQgcmVzcG9uc
 2UgZnJvbSBDQVMyIHNlcnZlcjogIiwgc3RyKGh0dHBfcmVzcG9uc2VfdGlja2V0LmdldFN0YXR1
 c0xpbmUoKS5nZXRTdGF0dXNDb2RlKCkpDQogICAgICAgICAgICAgICAgaHR0cFNlcnZpY2UuY29
 uc3VtZShodHRwX3Jlc3BvbnNlKQ0KICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KICAgIA
 0KICAgICAgICAgICAgdmFsaWRhdGlvbl9yZXNwb25zZV9ieXRlcyA9IGh0dHBTZXJ2aWNlLmdld
 FJlc3BvbnNlQ29udGVudChodHRwX3Jlc3BvbnNlKQ0KICAgICAgICAgICAgdmFsaWRhdGlvbl9y
 ZXNwb25zZV9zdHJpbmcgPSBodHRwU2VydmljZS5jb252ZXJ0RW50aXR5VG9TdHJpbmcodmFsaWR
 hdGlvbl9yZXNwb25zZV9ieXRlcykNCiAgICAgICAgICAgIGh0dHBTZXJ2aWNlLmNvbnN1bWUoaH
 R0cF9yZXNwb25zZSkNCiAgICAgICAgZmluYWxseToNCiAgICAgICAgICAgIGh0dHBfc2VydmljZ
 V9yZXNwb25zZS5jbG9zZUNvbm5lY3Rpb24oKQ0KDQogICAgICAgIGlmICh2YWxpZGF0aW9uX3Jl
 c3BvbnNlX3N0cmluZyA9PSBOb25lIG9yIHZhbGlkYXRpb25fcmVzcG9uc2Vfc3RyaW5nLmZpbmQ
 oY2FzX3ZhbGlkYXRpb25fcGF0dGVybikgPT0gLTEpOg0KICAgICAgICAgICAgcHJpbnQgIkNBUz
 IuIFJlc3QgQVBJIGF1dGhlbnRpY2F0ZSBpc1ZhbGlkQXV0aGVudGljYXRpb25NZXRob2QuIEdld
 CBpbnZhbGlkIGxvZ2luIHBhZ2UgZnJvbSBDQVMyIHNlcnZlcjoiDQogICAgICAgICAgICByZXR1
 cm4gRmFsc2UNCg0KICAgICAgICByZXR1cm4gVHJ1ZQ0KDQogICAgZGVmIGdldEFsdGVybmF0aXZ
 lQXV0aGVudGljYXRpb25NZXRob2Qoc2VsZiwgdXNhZ2VUeXBlLCBjb25maWd1cmF0aW9uQXR0cm
 lidXRlcyk6DQogICAgICAgIGNhc19hbHRfYXV0aF9tb2RlID0gY29uZmlndXJhdGlvbkF0dHJpY
 nV0ZXMuZ2V0KCJjYXNfYWx0X2F1dGhfbW9kZSIpLmdldFZhbHVlMigpDQogICAgICAgIHJldHVy
 biBjYXNfYWx0X2F1dGhfbW9kZQ0KDQogICAgZGVmIGF1dGhlbnRpY2F0ZShzZWxmLCBjb25maWd
 1cmF0aW9uQXR0cmlidXRlcywgcmVxdWVzdFBhcmFtZXRlcnMsIHN0ZXApOg0KICAgICAgICBjb2
 50ZXh0ID0gQ29udGV4dHMuZ2V0RXZlbnRDb250ZXh0KCkNCiAgICAgICAgYXV0aGVudGljYXRpb
 25TZXJ2aWNlID0gQXV0aGVudGljYXRpb25TZXJ2aWNlLmluc3RhbmNlKCkNCiAgICAgICAgdXNl
 clNlcnZpY2UgPSBVc2VyU2VydmljZS5pbnN0YW5jZSgpDQogICAgICAgIGh0dHBTZXJ2aWNlID0
 gSHR0cFNlcnZpY2UuaW5zdGFuY2UoKTsNCg0KICAgICAgICBjYXNfaG9zdCA9IGNvbmZpZ3VyYX
 Rpb25BdHRyaWJ1dGVzLmdldCgiY2FzX2hvc3QiKS5nZXRWYWx1ZTIoKQ0KICAgICAgICBjYXNfb
 WFwX3VzZXIgPSBTdHJpbmdIZWxwZXIudG9Cb29sZWFuKGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVz
 LmdldCgiY2FzX21hcF91c2VyIikuZ2V0VmFsdWUyKCksIEZhbHNlKQ0KICAgICAgICBjYXNfcmV
 uZXdfb3B0ID0gU3RyaW5nSGVscGVyLnRvQm9vbGVhbihjb25maWd1cmF0aW9uQXR0cmlidXRlcy
 5nZXQoImNhc19yZW5ld19vcHQiKS5nZXRWYWx1ZTIoKSwgRmFsc2UpDQoNCiAgICAgICAgY2FzX
 2V4dHJhX29wdHMgPSBOb25lDQogICAgICAgIGlmIChjb25maWd1cmF0aW9uQXR0cmlidXRlcy5j
 b250YWluc0tleSgiY2FzX2V4dHJhX29wdHMiKSk6DQogICAgICAgICAgICBjYXNfZXh0cmFfb3B
 0cyA9IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmdldCgiY2FzX2V4dHJhX29wdHMiKS5nZXRWYW
 x1ZTIoKQ0KDQogICAgICAgIGlmIChzdGVwID09IDEpOg0KICAgICAgICAgICAgcHJpbnQgIkNBU
 zIuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxIg0KICAgICAgICAgICAgdGlja2V0X2FycmF5ID0g
 cmVxdWVzdFBhcmFtZXRlcnMuZ2V0KCJ0aWNrZXQiKQ0KICAgICAgICAgICAgaWYgQXJyYXlIZWx
 wZXIuaXNFbXB0eSh0aWNrZXRfYXJyYXkpOg0KICAgICAgICAgICAgICAgIHByaW50ICJDQVMyLi
 BBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gdGlja2V0IGlzIGVtcHR5Ig0KICAgICAgICAgICAgI
 CAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgICAgICB0aWNrZXQgPSB0aWNrZXRfYXJyYXlbMF0N
 CiAgICAgICAgICAgIHByaW50ICJDQVMyLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gdGlja2V
 0OiAiICsgdGlja2V0DQoNCiAgICAgICAgICAgIGlmIChTdHJpbmdIZWxwZXIuaXNFbXB0eVN0cm
 luZyh0aWNrZXQpKToNCiAgICAgICAgICAgICAgICBwcmludCAiQ0FTMi4gQXV0aGVudGljYXRlI
 GZvciBzdGVwIDEuIHRpY2tldCBpcyBpbnZhbGlkIg0KICAgICAgICAgICAgICAgIHJldHVybiBG
 YWxzZQ0KDQogICAgICAgICAgICAjIFZhbGlkYXRlIHRpY2tldA0KICAgICAgICAgICAgcmVxdWV
 zdCA9IEZhY2VzQ29udGV4dC5nZXRDdXJyZW50SW5zdGFuY2UoKS5nZXRFeHRlcm5hbENvbnRleH
 QoKS5nZXRSZXF1ZXN0KCkNCg0KICAgICAgICAgICAgcGFyYW1ldGVyc01hcCA9IEhhc2hNYXAoK
 Q0KICAgICAgICAgICAgcGFyYW1ldGVyc01hcC5wdXQoInNlcnZpY2UiLCBodHRwU2VydmljZS5j
 b25zdHJ1Y3RTZXJ2ZXJVcmwocmVxdWVzdCkgKyAiL3Bvc3Rsb2dpbiIpDQogICAgICAgICAgICB
 pZiAoY2FzX3JlbmV3X29wdCk6DQogICAgICAgICAgICAgICAgcGFyYW1ldGVyc01hcC5wdXQoIn
 JlbmV3IiwgInRydWUiKQ0KICAgICAgICAgICAgcGFyYW1ldGVyc01hcC5wdXQoInRpY2tldCIsI
 HRpY2tldCkNCiAgICAgICAgICAgIGNhc19zZXJ2aWNlX3JlcXVlc3RfdXJpID0gYXV0aGVudGlj
 YXRpb25TZXJ2aWNlLnBhcmFtZXRlcnNBc1N0cmluZyhwYXJhbWV0ZXJzTWFwKQ0KICAgICAgICA
 gICAgY2FzX3NlcnZpY2VfcmVxdWVzdF91cmkgPSBjYXNfaG9zdCArICIvc2VydmljZVZhbGlkYX
 RlPyIgKyBjYXNfc2VydmljZV9yZXF1ZXN0X3VyaQ0KICAgICAgICAgICAgaWYgKGNhc19leHRyY
 V9vcHRzICE9IE5vbmUpOg0KICAgICAgICAgICAgICAgIGNhc19zZXJ2aWNlX3JlcXVlc3RfdXJp
 ID0gY2FzX3NlcnZpY2VfcmVxdWVzdF91cmkgKyAiJiIgKyBjYXNfZXh0cmFfb3B0cw0KDQogICA
 gICAgICAgICBwcmludCAiQ0FTMi4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIGNhc19zZXJ2aW
 NlX3JlcXVlc3RfdXJpOiAiICsgY2FzX3NlcnZpY2VfcmVxdWVzdF91cmkNCg0KICAgICAgICAgI
 CAgaHR0cF9jbGllbnQgPSBodHRwU2VydmljZS5nZXRIdHRwc0NsaWVudCgpOw0KICAgICAgICAg
 ICAgaHR0cF9zZXJ2aWNlX3Jlc3BvbnNlID0gaHR0cFNlcnZpY2UuZXhlY3V0ZUdldChodHRwX2N
 saWVudCwgY2FzX3NlcnZpY2VfcmVxdWVzdF91cmkpDQogICAgICAgICAgICANCiAgICAgICAgIC
 AgIHRyeToNCiAgICAgICAgICAgICAgICB2YWxpZGF0aW9uX2NvbnRlbnQgPSBodHRwU2VydmljZ
 S5jb252ZXJ0RW50aXR5VG9TdHJpbmcoaHR0cFNlcnZpY2UuZ2V0UmVzcG9uc2VDb250ZW50KGh0
 dHBfc2VydmljZV9yZXNwb25zZS5nZXRIdHRwUmVzcG9uc2UoKSkpDQogICAgICAgICAgICBmaW5
 hbGx5Og0KICAgICAgICAgICAgICAgIGh0dHBfc2VydmljZV9yZXNwb25zZS5jbG9zZUNvbm5lY3
 Rpb24oKQ0KDQogICAgICAgICAgICBwcmludCAiQ0FTMi4gQXV0aGVudGljYXRlIGZvciBzdGVwI
 DEuIHZhbGlkYXRpb25fY29udGVudDogIiArIHZhbGlkYXRpb25fY29udGVudA0KICAgICAgICAg
 ICAgaWYgU3RyaW5nSGVscGVyLmlzRW1wdHkodmFsaWRhdGlvbl9jb250ZW50KToNCiAgICAgICA
 gICAgICAgICBwcmludCAiQ0FTMi4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIFRpY2tldCB2YW
 xpZGF0aW9uIHJlc3BvbnNlIGlzIGludmFsaWQiDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhb
 HNlDQoNCiAgICAgICAgICAgIGNhczJfYXV0aF9mYWlsdXJlID0gc2VsZi5wYXJzZV90YWcodmFs
 aWRhdGlvbl9jb250ZW50LCAiY2FzOmF1dGhlbnRpY2F0aW9uRmFpbHVyZSIpDQogICAgICAgICA
 gICBwcmludCAiQ0FTMi4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIGNhczJfYXV0aF9mYWlsdX
 JlOiAiLCBjYXMyX2F1dGhfZmFpbHVyZQ0KDQogICAgICAgICAgICBjYXMyX3VzZXJfdWlkID0gc
 2VsZi5wYXJzZV90YWcodmFsaWRhdGlvbl9jb250ZW50LCAiY2FzOnVzZXIiKQ0KICAgICAgICAg
 ICAgcHJpbnQgIkNBUzIuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBjYXMyX3VzZXJfdWlkOiA
 iLCBjYXMyX3VzZXJfdWlkDQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmICgoY2FzMl9hdX
 RoX2ZhaWx1cmUgIT0gTm9uZSkgb3IgKGNhczJfdXNlcl91aWQgPT0gTm9uZSkpOg0KICAgICAgI
 CAgICAgICAgIHByaW50ICJDQVMyLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gVGlja2V0IGlz
 IGludmFsaWQiDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgIGl
 mIChjYXNfbWFwX3VzZXIpOg0KICAgICAgICAgICAgICAgIHByaW50ICJDQVMyLiBBdXRoZW50aW
 NhdGUgZm9yIHN0ZXAgMS4gQXR0ZW1wdGluZyB0byBmaW5kIHVzZXIgYnkgb3hFeHRlcm5hbFVpZ
 DogY2FzMjoiICsgY2FzMl91c2VyX3VpZA0KDQogICAgICAgICAgICAgICAgIyBDaGVjayBpZiB0
 aGUgaXMgdXNlciB3aXRoIHNwZWNpZmllZCBjYXMyX3VzZXJfdWlkDQogICAgICAgICAgICAgICA
 gZmluZF91c2VyX2J5X3VpZCA9IHVzZXJTZXJ2aWNlLmdldFVzZXJCeUF0dHJpYnV0ZSgib3hFeH
 Rlcm5hbFVpZCIsICJjYXMyOiIgKyBjYXMyX3VzZXJfdWlkKQ0KDQogICAgICAgICAgICAgICAga
 WYgKGZpbmRfdXNlcl9ieV91aWQgPT0gTm9uZSk6DQogICAgICAgICAgICAgICAgICAgIHByaW50
 ICJDQVMyLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gRmFpbGVkIHRvIGZpbmQgdXNlciINCiA
 gICAgICAgICAgICAgICAgICAgcHJpbnQgIkNBUzIuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLi
 BTZXR0aW5nIGNvdW50IHN0ZXBzIHRvIDIiDQogICAgICAgICAgICAgICAgICAgIGNvbnRleHQuc
 2V0KCJjYXMyX2NvdW50X2xvZ2luX3N0ZXBzIiwgMikNCiAgICAgICAgICAgICAgICAgICAgY29u
 dGV4dC5zZXQoImNhczJfdXNlcl91aWQiLCBjYXMyX3VzZXJfdWlkKQ0KICAgICAgICAgICAgICA
 gICAgICByZXR1cm4gVHJ1ZQ0KDQogICAgICAgICAgICAgICAgZm91bmRfdXNlcl9uYW1lID0gZm
 luZF91c2VyX2J5X3VpZC5nZXRVc2VySWQoKQ0KICAgICAgICAgICAgICAgIHByaW50ICJDQVMyL
 iBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gZm91bmRfdXNlcl9uYW1lOiAiICsgZm91bmRfdXNl
 cl9uYW1lDQoNCiAgICAgICAgICAgICAgICBjcmVkZW50aWFscyA9IElkZW50aXR5Lmluc3RhbmN
 lKCkuZ2V0Q3JlZGVudGlhbHMoKQ0KICAgICAgICAgICAgICAgIGNyZWRlbnRpYWxzLnNldFVzZX
 JuYW1lKGZvdW5kX3VzZXJfbmFtZSkNCiAgICAgICAgICAgICAgICBjcmVkZW50aWFscy5zZXRVc
 2VyKGZpbmRfdXNlcl9ieV91aWQpDQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBwcmlu
 dCAiQ0FTMi4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIFNldHRpbmcgY291bnQgc3RlcHMgdG8
 gMSINCiAgICAgICAgICAgICAgICBjb250ZXh0LnNldCgiY2FzMl9jb3VudF9sb2dpbl9zdGVwcy
 IsIDEpDQoNCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQ0KICAgICAgICAgICAgZWxzZToNC
 iAgICAgICAgICAgICAgICBwcmludCAiQ0FTMi4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIEF0
 dGVtcHRpbmcgdG8gZmluZCB1c2VyIGJ5IHVpZDoiICsgY2FzMl91c2VyX3VpZA0KDQogICAgICA
 gICAgICAgICAgIyBDaGVjayBpZiB0aGUgaXMgdXNlciB3aXRoIHNwZWNpZmllZCBjYXMyX3VzZX
 JfdWlkDQogICAgICAgICAgICAgICAgZmluZF91c2VyX2J5X3VpZCA9IHVzZXJTZXJ2aWNlLmdld
 FVzZXIoY2FzMl91c2VyX3VpZCkNCiAgICAgICAgICAgICAgICBpZiAoZmluZF91c2VyX2J5X3Vp
 ZCA9PSBOb25lKToNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgIkNBUzIuIEF1dGhlbnRpY2F
 0ZSBmb3Igc3RlcCAxLiBGYWlsZWQgdG8gZmluZCB1c2VyIg0KICAgICAgICAgICAgICAgICAgIC
 ByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICAgICAgIGZvdW5kX3VzZXJfbmFtZSA9IGZpbmRfd
 XNlcl9ieV91aWQuZ2V0VXNlcklkKCkNCiAgICAgICAgICAgICAgICBwcmludCAiQ0FTMi4gQXV0
 aGVudGljYXRlIGZvciBzdGVwIDEuIGZvdW5kX3VzZXJfbmFtZTogIiArIGZvdW5kX3VzZXJfbmF
 tZQ0KDQogICAgICAgICAgICAgICAgY3JlZGVudGlhbHMgPSBJZGVudGl0eS5pbnN0YW5jZSgpLm
 dldENyZWRlbnRpYWxzKCkNCiAgICAgICAgICAgICAgICBjcmVkZW50aWFscy5zZXRVc2VybmFtZ
 Shmb3VuZF91c2VyX25hbWUpDQogICAgICAgICAgICAgICAgY3JlZGVudGlhbHMuc2V0VXNlcihm
 aW5kX3VzZXJfYnlfdWlkKQ0KDQogICAgICAgICAgICAgICAgcHJpbnQgIkNBUzIuIEF1dGhlbnR
 pY2F0ZSBmb3Igc3RlcCAxLiBTZXR0aW5nIGNvdW50IHN0ZXBzIHRvIDEiDQogICAgICAgICAgIC
 AgICAgY29udGV4dC5zZXQoImNhczJfY291bnRfbG9naW5fc3RlcHMiLCAxKQ0KDQogICAgICAgI
 CAgICAgICAgcmV0dXJuIFRydWUNCiAgICAgICAgZWxpZiAoc3RlcCA9PSAyKToNCiAgICAgICAg
 ICAgIHByaW50ICJDQVMyLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMiINCg0KICAgICAgICAgICA
 gc2Vzc2lvbkF0dHJpYnV0ZXMgPSBjb250ZXh0LmdldCgic2Vzc2lvbkF0dHJpYnV0ZXMiKQ0KIC
 AgICAgICAgICAgaWYgKHNlc3Npb25BdHRyaWJ1dGVzID09IE5vbmUpIG9yIG5vdCBzZXNzaW9uQ
 XR0cmlidXRlcy5jb250YWluc0tleSgiY2FzMl91c2VyX3VpZCIpOg0KICAgICAgICAgICAgICAg
 IHByaW50ICJDQVMyLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMi4gY2FzMl91c2VyX3VpZCBpcyB
 lbXB0eSINCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICAgY2FzMl
 91c2VyX3VpZCA9IHNlc3Npb25BdHRyaWJ1dGVzLmdldCgiY2FzMl91c2VyX3VpZCIpDQogICAgI
 CAgICAgICBwYXNzZWRfc3RlcDEgPSBTdHJpbmdIZWxwZXIuaXNOb3RFbXB0eVN0cmluZyhjYXMy
 X3VzZXJfdWlkKQ0KICAgICAgICAgICAgaWYgKG5vdCBwYXNzZWRfc3RlcDEpOg0KICAgICAgICA
 gICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgICAgICBjcmVkZW50aWFscyA9IElkZW50aX
 R5Lmluc3RhbmNlKCkuZ2V0Q3JlZGVudGlhbHMoKQ0KICAgICAgICAgICAgdXNlcl9uYW1lID0gY
 3JlZGVudGlhbHMuZ2V0VXNlcm5hbWUoKQ0KICAgICAgICAgICAgdXNlcl9wYXNzd29yZCA9IGNy
 ZWRlbnRpYWxzLmdldFBhc3N3b3JkKCkNCg0KICAgICAgICAgICAgbG9nZ2VkX2luID0gRmFsc2U
 NCiAgICAgICAgICAgIGlmIChTdHJpbmdIZWxwZXIuaXNOb3RFbXB0eVN0cmluZyh1c2VyX25hbW
 UpIGFuZCBTdHJpbmdIZWxwZXIuaXNOb3RFbXB0eVN0cmluZyh1c2VyX3Bhc3N3b3JkKSk6DQogI
 CAgICAgICAgICAgICAgbG9nZ2VkX2luID0gdXNlclNlcnZpY2UuYXV0aGVudGljYXRlKHVzZXJf
 bmFtZSwgdXNlcl9wYXNzd29yZCkNCg0KICAgICAgICAgICAgaWYgKG5vdCBsb2dnZWRfaW4pOg0
 KICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgICAgICAjIENoZWNrIGlmIH
 RoZXJlIGlzIHVzZXIgd2hpY2ggaGFzIGNhczJfdXNlcl91aWQNCiAgICAgICAgICAgICMgQXZva
 WQgbWFwcGluZyBDQVMyIGFjY291bnQgdG8gbW9yZSB0aGFuIG9uZSBJRFAgYWNjb3VudA0KICAg
 ICAgICAgICAgZmluZF91c2VyX2J5X3VpZCA9IHVzZXJTZXJ2aWNlLmdldFVzZXJCeUF0dHJpYnV
 0ZSgib3hFeHRlcm5hbFVpZCIsICJjYXMyOiIgKyBjYXMyX3VzZXJfdWlkKQ0KDQogICAgICAgIC
 AgICBpZiAoZmluZF91c2VyX2J5X3VpZCA9PSBOb25lKToNCiAgICAgICAgICAgICAgICAjIEFkZ
 CBjYXMyX3VzZXJfdWlkIHRvIHVzZXIgb25lIGlkIFVJRHMNCiAgICAgICAgICAgICAgICBmaW5k
 X3VzZXJfYnlfdWlkID0gdXNlclNlcnZpY2UuYWRkVXNlckF0dHJpYnV0ZSh1c2VyX25hbWUsICJ
 veEV4dGVybmFsVWlkIiwgImNhczI6IiArIGNhczJfdXNlcl91aWQpDQogICAgICAgICAgICAgIC
 AgaWYgKGZpbmRfdXNlcl9ieV91aWQgPT0gTm9uZSk6DQogICAgICAgICAgICAgICAgICAgIHBya
 W50ICJDQVMyLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMi4gRmFpbGVkIHRvIHVwZGF0ZSBjdXJy
 ZW50IHVzZXIiDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgICA
 gICAgICAgcmV0dXJuIFRydWUNCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgZm
 91bmRfdXNlcl9uYW1lID0gZmluZF91c2VyX2J5X3VpZC5nZXRVc2VySWQoKQ0KICAgICAgICAgI
 CAgICAgIHByaW50ICJDQVMyLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMi4gZm91bmRfdXNlcl9u
 YW1lOiAiICsgZm91bmRfdXNlcl9uYW1lDQogICAgDQogICAgICAgICAgICAgICAgaWYgU3RyaW5
 nSGVscGVyLmVxdWFscyh1c2VyX25hbWUsIGZvdW5kX3VzZXJfbmFtZSk6DQogICAgICAgICAgIC
 AgICAgICAgIHJldHVybiBUcnVlDQogICAgICAgIA0KICAgICAgICAgICAgcmV0dXJuIEZhbHNlD
 QogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgIGRlZiBwcmVw
 YXJlRm9yU3RlcChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywgcmVxdWVzdFBhcmFtZXR
 lcnMsIHN0ZXApOg0KICAgICAgICBjb250ZXh0ID0gQ29udGV4dHMuZ2V0RXZlbnRDb250ZXh0KC
 kNCiAgICAgICAgYXV0aGVudGljYXRpb25TZXJ2aWNlID0gQXV0aGVudGljYXRpb25TZXJ2aWNlL
 mluc3RhbmNlKCkNCiAgICAgICAgaHR0cFNlcnZpY2UgPSBIdHRwU2VydmljZS5pbnN0YW5jZSgp
 Ow0KDQogICAgICAgIGNhc19ob3N0ID0gY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuZ2V0KCJjYXN
 faG9zdCIpLmdldFZhbHVlMigpDQogICAgICAgIGNhc19yZW5ld19vcHQgPSBTdHJpbmdIZWxwZX
 IudG9Cb29sZWFuKGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmdldCgiY2FzX3JlbmV3X29wdCIpL
 mdldFZhbHVlMigpLCBGYWxzZSkNCg0KICAgICAgICBjYXNfZXh0cmFfb3B0cyA9IE5vbmUNCiAg
 ICAgICAgaWYgKGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmNvbnRhaW5zS2V5KCJjYXNfZXh0cmF
 fb3B0cyIpKToNCiAgICAgICAgICAgIGNhc19leHRyYV9vcHRzID0gY29uZmlndXJhdGlvbkF0dH
 JpYnV0ZXMuZ2V0KCJjYXNfZXh0cmFfb3B0cyIpLmdldFZhbHVlMigpDQoNCiAgICAgICAgaWYgK
 HN0ZXAgPT0gMSk6DQogICAgICAgICAgICBwcmludCAiQ0FTMi4gUHJlcGFyZSBmb3Igc3RlcCAx
 Ig0KDQogICAgICAgICAgICByZXF1ZXN0ID0gRmFjZXNDb250ZXh0LmdldEN1cnJlbnRJbnN0YW5
 jZSgpLmdldEV4dGVybmFsQ29udGV4dCgpLmdldFJlcXVlc3QoKQ0KICAgICAgICAgICAgcGFyYW
 1ldGVyc01hcCA9IEhhc2hNYXAoKQ0KICAgICAgICAgICAgcGFyYW1ldGVyc01hcC5wdXQoInNlc
 nZpY2UiLCBodHRwU2VydmljZS5jb25zdHJ1Y3RTZXJ2ZXJVcmwocmVxdWVzdCkgKyAiL3Bvc3Rs
 b2dpbiIpDQogICAgICAgICAgICBpZiAoY2FzX3JlbmV3X29wdCk6DQogICAgICAgICAgICAgICA
 gcGFyYW1ldGVyc01hcC5wdXQoInJlbmV3IiwgInRydWUiKQ0KICAgICAgICAgICAgY2FzX3Nlcn
 ZpY2VfcmVxdWVzdF91cmkgPSBhdXRoZW50aWNhdGlvblNlcnZpY2UucGFyYW1ldGVyc0FzU3Rya
 W5nKHBhcmFtZXRlcnNNYXApDQogICAgICAgICAgICBjYXNfc2VydmljZV9yZXF1ZXN0X3VyaSA9
 IGNhc19ob3N0ICsgIi9sb2dpbj8iICsgY2FzX3NlcnZpY2VfcmVxdWVzdF91cmkNCiAgICAgICA
 gICAgIGlmIGNhc19leHRyYV9vcHRzICE9IE5vbmU6DQogICAgICAgICAgICAgICAgY2FzX3Nlcn
 ZpY2VfcmVxdWVzdF91cmkgPSBjYXNfc2VydmljZV9yZXF1ZXN0X3VyaSArICImIiArIGNhc19le
 HRyYV9vcHRzDQoNCiAgICAgICAgICAgIHByaW50ICJDQVMyLiBQcmVwYXJlIGZvciBzdGVwIDEu
 IGNhc19zZXJ2aWNlX3JlcXVlc3RfdXJpOiAiICsgY2FzX3NlcnZpY2VfcmVxdWVzdF91cmkNCg0
 KICAgICAgICAgICAgY29udGV4dC5zZXQoImNhc19zZXJ2aWNlX3JlcXVlc3RfdXJpIiwgY2FzX3
 NlcnZpY2VfcmVxdWVzdF91cmkpDQoNCiAgICAgICAgICAgIHJldHVybiBUcnVlDQogICAgICAgI
 GVsaWYgKHN0ZXAgPT0gMik6DQogICAgICAgICAgICBwcmludCAiQ0FTMi4gUHJlcGFyZSBmb3Ig
 c3RlcCAyIg0KDQogICAgICAgICAgICByZXR1cm4gVHJ1ZQ0KICAgICAgICBlbHNlOg0KICAgICA
 gICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICBkZWYgZ2V0RXh0cmFQYXJhbWV0ZXJzRm9yU3RlcC
 hzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywgc3RlcCk6DQogICAgICAgIGlmIChzdGVwI
 D09IDIpOg0KICAgICAgICAgICAgcmV0dXJuIEFycmF5cy5hc0xpc3QoImNhczJfdXNlcl91aWQi
 KQ0KICAgICAgICANCiAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgIGRlZiBnZXRDb3VudEF1dGh
 lbnRpY2F0aW9uU3RlcHMoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgIC
 Bjb250ZXh0ID0gQ29udGV4dHMuZ2V0RXZlbnRDb250ZXh0KCkNCiAgICAgICAgaWYgKGNvbnRle
 HQuaXNTZXQoImNhczJfY291bnRfbG9naW5fc3RlcHMiKSk6DQogICAgICAgICAgICByZXR1cm4g
 Y29udGV4dC5nZXQoImNhczJfY291bnRfbG9naW5fc3RlcHMiKQ0KICAgICAgICANCiAgICAgICA
 gcmV0dXJuIDINCg0KICAgIGRlZiBnZXRQYWdlRm9yU3RlcChzZWxmLCBjb25maWd1cmF0aW9uQX
 R0cmlidXRlcywgc3RlcCk6DQogICAgICAgIGlmIChzdGVwID09IDEpOg0KICAgICAgICAgICAgc
 mV0dXJuICIvYXV0aC9jYXMyL2NhczJsb2dpbi54aHRtbCINCiAgICAgICAgcmV0dXJuICIvYXV0
 aC9jYXMyL2NhczJwb3N0bG9naW4ueGh0bWwiDQoNCiAgICBkZWYgcGFyc2VfdGFnKHNlbGYsIHN
 0ciwgdGFnKToNCiAgICAgICAgdGFnMV9wb3MxID0gc3RyLmZpbmQoIjwiICsgdGFnKQ0KICAgIC
 AgICAjICBObyB0YWcgZm91bmQsIHJldHVybiBlbXB0eSBzdHJpbmcuDQogICAgICAgIGlmIHRhZ
 zFfcG9zMSA9PSAtMTogcmV0dXJuIE5vbmUNCiAgICAgICAgdGFnMV9wb3MyID0gc3RyLmZpbmQo
 Ij4iLCB0YWcxX3BvczEpDQogICAgICAgIGlmIHRhZzFfcG9zMiA9PSAtMTogcmV0dXJuIE5vbmU
 NCiAgICAgICAgdGFnMl9wb3MxID0gc3RyLmZpbmQoIjwvIiArIHRhZywgdGFnMV9wb3MyKQ0KIC
 AgICAgICBpZiB0YWcyX3BvczEgPT0gLTE6IHJldHVybiBOb25lDQoNCiAgICAgICAgcmV0dXJuI
 HN0clt0YWcxX3BvczIrMTp0YWcyX3BvczFdLnN0cmlwKCkNCg0KICAgIGRlZiBsb2dvdXQoc2Vs
 ZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJlcXVlc3RQYXJhbWV0ZXJzKToNCiAgICAgICA
 gcmV0dXJuIFRydWUNCg==
oxScriptType: person_authentication
programmingLanguage: python

dn: inum=%(inumOrg)s!7523.8F2D,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Google+ authentication module
displayName: gplus
gluuStatus: false
inum: %(inumOrg)s!7523.8F2D
oxConfigurationProperty: {"value1":"gplus_client_secrets_file","value2":"/et
 c/certs/gplus_client_secrets.json","description":""}
oxConfigurationProperty: {"value1":"gplus_deployment_type","value2":"enroll"
 ,"description":""}
oxConfigurationProperty: {"value1":"gplus_remote_attributes_list","value2":"
 email, email, name, family_name, given_name, locale","description":""}
oxConfigurationProperty: {"value1":"gplus_local_attributes_list","value2":"u
 id, mail, givenName, sn, cn, preferredLanguage","description":""}
oxLevel: 40
oxModuleProperty: {"value1":"usage_type","value2":"interactive","description
 ":""}
oxRevision: 1
oxScript:: ZnJvbSBvcmcuamJvc3Muc2VhbS5jb250ZXh0cyBpbXBvcnQgQ29udGV4dCwgQ29ud
 GV4dHMNCmZyb20gb3JnLmpib3NzLnNlYW0uc2VjdXJpdHkgaW1wb3J0IElkZW50aXR5DQpmcm9t
 IGphdmF4LmZhY2VzLmNvbnRleHQgaW1wb3J0IEZhY2VzQ29udGV4dA0KZnJvbSBvcmcueGRpLm1
 vZGVsLmN1c3RvbS5zY3JpcHQudHlwZS5hdXRoIGltcG9ydCBQZXJzb25BdXRoZW50aWNhdGlvbl
 R5cGUNCmZyb20gb3JnLnhkaS5veGF1dGguc2VydmljZSBpbXBvcnQgVXNlclNlcnZpY2UsIENsa
 WVudFNlcnZpY2UsIEF1dGhlbnRpY2F0aW9uU2VydmljZQ0KZnJvbSBvcmcueGRpLnV0aWwgaW1w
 b3J0IFN0cmluZ0hlbHBlciwgQXJyYXlIZWxwZXINCmZyb20gamF2YS51dGlsIGltcG9ydCBBcnJ
 heXMsIEFycmF5TGlzdCwgSGFzaE1hcCwgSWRlbnRpdHlIYXNoTWFwDQpmcm9tIG9yZy54ZGkub3
 hhdXRoLm1vZGVsLmNvbW1vbiBpbXBvcnQgVXNlciwgQ3VzdG9tQXR0cmlidXRlDQpmcm9tIG9yZ
 y54ZGkub3hhdXRoLmNsaWVudCBpbXBvcnQgVG9rZW5DbGllbnQsIFRva2VuUmVxdWVzdCwgVXNl
 ckluZm9DbGllbnQNCmZyb20gb3JnLnhkaS5veGF1dGgubW9kZWwuY29tbW9uIGltcG9ydCBHcmF
 udFR5cGUsIEF1dGhlbnRpY2F0aW9uTWV0aG9kDQpmcm9tIG9yZy54ZGkub3hhdXRoLm1vZGVsLm
 p3dCBpbXBvcnQgSnd0LCBKd3RDbGFpbU5hbWUNCg0KaW1wb3J0IGphdmENCg0KdHJ5Og0KICAgI
 GltcG9ydCBqc29uDQpleGNlcHQgSW1wb3J0RXJyb3I6DQogICAgaW1wb3J0IHNpbXBsZWpzb24g
 YXMganNvbg0KDQpjbGFzcyBQZXJzb25BdXRoZW50aWNhdGlvbihQZXJzb25BdXRoZW50aWNhdGl
 vblR5cGUpOg0KICAgIGRlZiBfX2luaXRfXyhzZWxmLCBjdXJyZW50VGltZU1pbGxpcyk6DQogIC
 AgICAgIHNlbGYuY3VycmVudFRpbWVNaWxsaXMgPSBjdXJyZW50VGltZU1pbGxpcw0KDQogICAgZ
 GVmIGluaXQoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICBwcmludCAi
 R29vZ2xlKyBJbml0aWFsaXphdGlvbiINCg0KICAgICAgICBpZiAobm90IGNvbmZpZ3VyYXRpb25
 BdHRyaWJ1dGVzLmNvbnRhaW5zS2V5KCJncGx1c19jbGllbnRfc2VjcmV0c19maWxlIikpOg0KIC
 AgICAgICAgICAgcHJpbnQgIkdvb2dsZSsgSW5pdGlhbGl6YXRpb24uIFRoZSBwcm9wZXJ0eSBnc
 Gx1c19jbGllbnRfc2VjcmV0c19maWxlIGlzIGVtcHR5Ig0KICAgICAgICAgICAgcmV0dXJuIEZh
 bHNlDQogICAgICAgICAgICANCiAgICAgICAgY2xpZW50U2VjcmV0c0ZpbGUgPSBjb25maWd1cmF
 0aW9uQXR0cmlidXRlcy5nZXQoImdwbHVzX2NsaWVudF9zZWNyZXRzX2ZpbGUiKS5nZXRWYWx1ZT
 IoKQ0KICAgICAgICBzZWxmLmNsaWVudFNlY3JldHMgPSBzZWxmLmxvYWRDbGllbnRTZWNyZXRzK
 GNsaWVudFNlY3JldHNGaWxlKQ0KICAgICAgICBpZiAoc2VsZi5jbGllbnRTZWNyZXRzID09IE5v
 bmUpOg0KICAgICAgICAgICAgcHJpbnQgIkdvb2dsZSsgSW5pdGlhbGl6YXRpb24uIEZpbGUgd2l
 0aCBHb29nbGUrIGNsaWVudCBzZWNyZXRzIHNob3VsZCBiZSBub3QgZW1wdHkiDQogICAgICAgIC
 AgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICBzZWxmLmF0dHJpYnV0ZXNNYXBwaW5nID0gTm9uZ
 Q0KICAgICAgICBpZiAoY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuY29udGFpbnNLZXkoImdwbHVz
 X3JlbW90ZV9hdHRyaWJ1dGVzX2xpc3QiKSBhbmQNCiAgICAgICAgICAgIGNvbmZpZ3VyYXRpb25
 BdHRyaWJ1dGVzLmNvbnRhaW5zS2V5KCJncGx1c19sb2NhbF9hdHRyaWJ1dGVzX2xpc3QiKSk6DQ
 oNCiAgICAgICAgICAgIHJlbW90ZUF0dHJpYnV0ZXNMaXN0ID0gY29uZmlndXJhdGlvbkF0dHJpY
 nV0ZXMuZ2V0KCJncGx1c19yZW1vdGVfYXR0cmlidXRlc19saXN0IikuZ2V0VmFsdWUyKCkNCiAg
 ICAgICAgICAgIGlmIChTdHJpbmdIZWxwZXIuaXNFbXB0eShyZW1vdGVBdHRyaWJ1dGVzTGlzdCk
 pOg0KICAgICAgICAgICAgICAgIHByaW50ICJHb29nbGUrIEluaXRpYWxpemF0aW9uLiBUaGUgcH
 JvcGVydHkgZ3BsdXNfcmVtb3RlX2F0dHJpYnV0ZXNfbGlzdCBpcyBlbXB0eSINCiAgICAgICAgI
 CAgICAgICByZXR1cm4gRmFsc2UgICAgDQoNCiAgICAgICAgICAgIGxvY2FsQXR0cmlidXRlc0xp
 c3QgPSBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5nZXQoImdwbHVzX2xvY2FsX2F0dHJpYnV0ZXN
 fbGlzdCIpLmdldFZhbHVlMigpDQogICAgICAgICAgICBpZiAoU3RyaW5nSGVscGVyLmlzRW1wdH
 kobG9jYWxBdHRyaWJ1dGVzTGlzdCkpOg0KICAgICAgICAgICAgICAgIHByaW50ICJHb29nbGUrI
 EluaXRpYWxpemF0aW9uLiBUaGUgcHJvcGVydHkgZ3BsdXNfbG9jYWxfYXR0cmlidXRlc19saXN0
 IGlzIGVtcHR5Ig0KICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgICAgICB
 zZWxmLmF0dHJpYnV0ZXNNYXBwaW5nID0gc2VsZi5wcmVwYXJlQXR0cmlidXRlc01hcHBpbmcocm
 Vtb3RlQXR0cmlidXRlc0xpc3QsIGxvY2FsQXR0cmlidXRlc0xpc3QpDQogICAgICAgICAgICBpZ
 iAoc2VsZi5hdHRyaWJ1dGVzTWFwcGluZyA9PSBOb25lKToNCiAgICAgICAgICAgICAgICBwcmlu
 dCAiR29vZ2xlKyBJbml0aWFsaXphdGlvbi4gVGhlIGF0dHJpYnV0ZXMgbWFwcGluZyBpc24ndCB
 2YWxpZCINCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICBzZWxmLmV4dG
 Vuc2lvbk1vZHVsZSA9IE5vbmUNCiAgICAgICAgaWYgKGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzL
 mNvbnRhaW5zS2V5KCJleHRlbnNpb25fbW9kdWxlIikpOg0KICAgICAgICAgICAgZXh0ZW5zaW9u
 TW9kdWxlTmFtZSA9IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmdldCgiZXh0ZW5zaW9uX21vZHV
 sZSIpLmdldFZhbHVlMigpDQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgc2VsZi
 5leHRlbnNpb25Nb2R1bGUgPSBfX2ltcG9ydF9fKGV4dGVuc2lvbk1vZHVsZU5hbWUpDQogICAgI
 CAgICAgICAgICAgZXh0ZW5zaW9uTW9kdWxlSW5pdFJlc3VsdCA9IHNlbGYuZXh0ZW5zaW9uTW9k
 dWxlLmluaXQoY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpDQogICAgICAgICAgICAgICAgaWYgKG5
 vdCBleHRlbnNpb25Nb2R1bGVJbml0UmVzdWx0KToNCiAgICAgICAgICAgICAgICAgICAgcmV0dX
 JuIEZhbHNlDQogICAgICAgICAgICBleGNlcHQgSW1wb3J0RXJyb3IsIGV4Og0KICAgICAgICAgI
 CAgICAgIHByaW50ICJHb29nbGUrIEluaXRpYWxpemF0aW9uLiBGYWlsZWQgdG8gbG9hZCBncGx1
 c19leHRlbnNpb25fbW9kdWxlOiIsIGV4dGVuc2lvbk1vZHVsZU5hbWUNCiAgICAgICAgICAgICA
 gICBwcmludCAiR29vZ2xlKyBJbml0aWFsaXphdGlvbi4gVW5leHBlY3RlZCBlcnJvcjoiLCBleA
 0KICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgIHByaW50ICJHb29nbGUrI
 EluaXRpYWxpemVkIHN1Y2Nlc3NmdWxseSINCiAgICAgICAgcmV0dXJuIFRydWUgICANCg0KICAg
 IGRlZiBkZXN0cm95KHNlbGYsIGF1dGhDb25maWd1cmF0aW9uKToNCiAgICAgICAgcHJpbnQgIkd
 vb2dsZSsgRGVzdHJveSINCiAgICAgICAgcHJpbnQgIkdvb2dsZSsgRGVzdHJveWVkIHN1Y2Nlc3
 NmdWxseSINCg0KICAgIGRlZiBnZXRBcGlWZXJzaW9uKHNlbGYpOg0KICAgICAgICByZXR1cm4gM
 Q0KDQogICAgZGVmIGlzVmFsaWRBdXRoZW50aWNhdGlvbk1ldGhvZChzZWxmLCB1c2FnZVR5cGUs
 IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcmV0dXJuIFRydWUNCg0KICAgIGR
 lZiBnZXRBbHRlcm5hdGl2ZUF1dGhlbnRpY2F0aW9uTWV0aG9kKHNlbGYsIHVzYWdlVHlwZSwgY2
 9uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICByZXR1cm4gTm9uZQ0KDQogICAgZGVmI
 GF1dGhlbnRpY2F0ZShzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywgcmVxdWVzdFBhcmFt
 ZXRlcnMsIHN0ZXApOg0KICAgICAgICBjb250ZXh0ID0gQ29udGV4dHMuZ2V0RXZlbnRDb250ZXh
 0KCkNCiAgICAgICAgYXV0aGVudGljYXRpb25TZXJ2aWNlID0gQXV0aGVudGljYXRpb25TZXJ2aW
 NlLmluc3RhbmNlKCkNCiAgICAgICAgdXNlclNlcnZpY2UgPSBVc2VyU2VydmljZS5pbnN0YW5jZ
 SgpDQoNCiAgICAgICAgbWFwVXNlckRlcGxveW1lbnQgPSBGYWxzZQ0KICAgICAgICBlbnJvbGxV
 c2VyRGVwbG95bWVudCA9IEZhbHNlDQogICAgICAgIGlmIChjb25maWd1cmF0aW9uQXR0cmlidXR
 lcy5jb250YWluc0tleSgiZ3BsdXNfZGVwbG95bWVudF90eXBlIikpOg0KICAgICAgICAgICAgZG
 VwbG95bWVudFR5cGUgPSBTdHJpbmdIZWxwZXIudG9Mb3dlckNhc2UoY29uZmlndXJhdGlvbkF0d
 HJpYnV0ZXMuZ2V0KCJncGx1c19kZXBsb3ltZW50X3R5cGUiKS5nZXRWYWx1ZTIoKSkNCiAgICAg
 ICAgICAgIA0KICAgICAgICAgICAgaWYgKFN0cmluZ0hlbHBlci5lcXVhbHNJZ25vcmVDYXNlKGR
 lcGxveW1lbnRUeXBlLCAibWFwIikpOg0KICAgICAgICAgICAgICAgIG1hcFVzZXJEZXBsb3ltZW
 50ID0gVHJ1ZQ0KICAgICAgICAgICAgaWYgKFN0cmluZ0hlbHBlci5lcXVhbHNJZ25vcmVDYXNlK
 GRlcGxveW1lbnRUeXBlLCAiZW5yb2xsIikpOg0KICAgICAgICAgICAgICAgIGVucm9sbFVzZXJE
 ZXBsb3ltZW50ID0gVHJ1ZQ0KDQogICAgICAgIGlmIChzdGVwID09IDEpOg0KICAgICAgICAgICA
 gcHJpbnQgIkdvb2dsZSsgQXV0aGVudGljYXRlIGZvciBzdGVwIDEiDQogDQogICAgICAgICAgIC
 BncGx1c0F1dGhDb2RlQXJyYXkgPSByZXF1ZXN0UGFyYW1ldGVycy5nZXQoImdwbHVzX2F1dGhfY
 29kZSIpDQogICAgICAgICAgICBncGx1c0F1dGhDb2RlID0gZ3BsdXNBdXRoQ29kZUFycmF5WzBd
 DQoNCiAgICAgICAgICAgICMgQ2hlY2sgaWYgdXNlciB1c2VzIGJhc2ljIG1ldGhvZCB0byBsb2c
 gaW4NCiAgICAgICAgICAgIHVzZUJhc2ljQXV0aCA9IEZhbHNlDQogICAgICAgICAgICBpZiAoU3
 RyaW5nSGVscGVyLmlzRW1wdHlTdHJpbmcoZ3BsdXNBdXRoQ29kZSkpOg0KICAgICAgICAgICAgI
 CAgIHVzZUJhc2ljQXV0aCA9IFRydWUNCg0KICAgICAgICAgICAgIyBVc2UgYmFzaWMgbWV0aG9k
 IHRvIGxvZyBpbg0KICAgICAgICAgICAgaWYgKHVzZUJhc2ljQXV0aCk6DQogICAgICAgICAgICA
 gICAgcHJpbnQgIkdvb2dsZSsgQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIEJhc2ljIGF1dGhlbn
 RpY2F0aW9uIg0KICAgICAgICANCiAgICAgICAgICAgICAgICBjb250ZXh0LnNldCgiZ3BsdXNfY
 291bnRfbG9naW5fc3RlcHMiLCAxKQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBjcmVkZW50
 aWFscyA9IElkZW50aXR5Lmluc3RhbmNlKCkuZ2V0Q3JlZGVudGlhbHMoKQ0KICAgICAgICAgICA
 gICAgIHVzZXJOYW1lID0gY3JlZGVudGlhbHMuZ2V0VXNlcm5hbWUoKQ0KICAgICAgICAgICAgIC
 AgIHVzZXJQYXNzd29yZCA9IGNyZWRlbnRpYWxzLmdldFBhc3N3b3JkKCkNCiAgICAgICAgDQogI
 CAgICAgICAgICAgICAgbG9nZ2VkSW4gPSBGYWxzZQ0KICAgICAgICAgICAgICAgIGlmIChTdHJp
 bmdIZWxwZXIuaXNOb3RFbXB0eVN0cmluZyh1c2VyTmFtZSkgYW5kIFN0cmluZ0hlbHBlci5pc05
 vdEVtcHR5U3RyaW5nKHVzZXJQYXNzd29yZCkpOg0KICAgICAgICAgICAgICAgICAgICB1c2VyU2
 VydmljZSA9IFVzZXJTZXJ2aWNlLmluc3RhbmNlKCkNCiAgICAgICAgICAgICAgICAgICAgbG9nZ
 2VkSW4gPSB1c2VyU2VydmljZS5hdXRoZW50aWNhdGUodXNlck5hbWUsIHVzZXJQYXNzd29yZCkN
 CiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYgKG5vdCBsb2dnZWRJbik6DQogICAgICAgICA
 gICAgICAgICAgIHJldHVybiBGYWxzZQ0KICAgICAgICANCiAgICAgICAgICAgICAgICByZXR1cm
 4gVHJ1ZQ0KDQogICAgICAgICAgICAjIFVzZSBHb29nbGUrIG1ldGhvZCB0byBsb2cgaW4NCiAgI
 CAgICAgICAgIHByaW50ICJHb29nbGUrIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBncGx1c0F1
 dGhDb2RlOiIsIGdwbHVzQXV0aENvZGUNCg0KICAgICAgICAgICAgY3VycmVudENsaWVudFNlY3J
 ldHMgPSBzZWxmLmdldEN1cnJlbnRDbGllbnRTZWNyZXRzKHNlbGYuY2xpZW50U2VjcmV0cywgY2
 9uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJlcXVlc3RQYXJhbWV0ZXJzKQ0KICAgICAgICAgICAga
 WYgKGN1cnJlbnRDbGllbnRTZWNyZXRzID09IE5vbmUpOg0KICAgICAgICAgICAgICAgIHByaW50
 ICJHb29nbGUrIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBDbGllbnQgc2VjcmV0cyBjb25maWd
 1cmF0aW9uIGlzIGludmFsaWQiDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQogICAgIC
 AgICAgICANCiAgICAgICAgICAgIHByaW50ICJHb29nbGUrIEF1dGhlbnRpY2F0ZSBmb3Igc3Rlc
 CAxLiBBdHRlbXB0aW5nIHRvIGdldHMgdG9rZW5zIg0KICAgICAgICAgICAgdG9rZW5SZXNwb25z
 ZSA9IHNlbGYuZ2V0VG9rZW5zQnlDb2RlKHNlbGYuY2xpZW50U2VjcmV0cywgY29uZmlndXJhdGl
 vbkF0dHJpYnV0ZXMsIGdwbHVzQXV0aENvZGUpOw0KICAgICAgICAgICAgaWYgKCh0b2tlblJlc3
 BvbnNlID09IE5vbmUpIG9yICh0b2tlblJlc3BvbnNlLmdldElkVG9rZW4oKSA9PSBOb25lKSBvc
 iAodG9rZW5SZXNwb25zZS5nZXRBY2Nlc3NUb2tlbigpID09IE5vbmUpKToNCiAgICAgICAgICAg
 ICAgICBwcmludCAiR29vZ2xlKyBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gRmFpbGVkIHRvIGd
 ldCB0b2tlbnMiDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQogICAgICAgICAgICBlbH
 NlOg0KICAgICAgICAgICAgICAgIHByaW50ICJHb29nbGUrIEF1dGhlbnRpY2F0ZSBmb3Igc3Rlc
 CAxLiBTdWNjZXNzZnVsbHkgZ2V0cyB0b2tlbnMiDQoNCiAgICAgICAgICAgIGp3dCA9IEp3dC5w
 YXJzZSh0b2tlblJlc3BvbnNlLmdldElkVG9rZW4oKSkNCiAgICAgICAgICAgICMgVE9ETzogVmF
 saWRhdGUgSUQgVG9rZW4gU2lnbmF0dXJlICANCg0KICAgICAgICAgICAgZ3BsdXNVc2VyVWlkID
 0gand0LmdldENsYWltcygpLmdldENsYWltQXNTdHJpbmcoSnd0Q2xhaW1OYW1lLlNVQkpFQ1RfS
 URFTlRJRklFUik7DQogICAgICAgICAgICBwcmludCAiR29vZ2xlKyBBdXRoZW50aWNhdGUgZm9y
 IHN0ZXAgMS4gRm91bmQgR29vZ2xlIHVzZXIgSUQgaW4gdGhlIElEIHRva2VuOiAiLCBncGx1c1V
 zZXJVaWQNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYgKG1hcFVzZXJEZXBsb3ltZW50KT
 oNCiAgICAgICAgICAgICAgICAjIFVzZSBtYXBwaW5nIHRvIGxvY2FsIElEUCB1c2VyDQogICAgI
 CAgICAgICAgICAgcHJpbnQgIkdvb2dsZSsgQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIEF0dGVt
 cHRpbmcgdG8gZmluZCB1c2VyIGJ5IG94RXh0ZXJuYWxVaWQ6IGdwbHVzOiIsIGdwbHVzVXNlclV
 pZA0KDQogICAgICAgICAgICAgICAgIyBDaGVjayBpZiB0aGVyZSBpcyB1c2VyIHdpdGggc3BlY2
 lmaWVkIGdwbHVzVXNlclVpZA0KICAgICAgICAgICAgICAgIGZvdW5kVXNlciA9IHVzZXJTZXJ2a
 WNlLmdldFVzZXJCeUF0dHJpYnV0ZSgib3hFeHRlcm5hbFVpZCIsICJncGx1czoiICsgZ3BsdXNV
 c2VyVWlkKQ0KDQogICAgICAgICAgICAgICAgaWYgKGZvdW5kVXNlciA9PSBOb25lKToNCiAgICA
 gICAgICAgICAgICAgICAgcHJpbnQgIkdvb2dsZSsgQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIE
 ZhaWxlZCB0byBmaW5kIHVzZXIiDQogICAgICAgICAgICAgICAgICAgIHByaW50ICJHb29nbGUrI
 EF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBTZXR0aW5nIGNvdW50IHN0ZXBzIHRvIDIiDQogICAg
 ICAgICAgICAgICAgICAgIGNvbnRleHQuc2V0KCJncGx1c19jb3VudF9sb2dpbl9zdGVwcyIsIDI
 pDQogICAgICAgICAgICAgICAgICAgIGNvbnRleHQuc2V0KCJncGx1c191c2VyX3VpZCIsIGdwbH
 VzVXNlclVpZCkNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRydWUNCg0KICAgICAgICAgI
 CAgICAgIGZvdW5kVXNlck5hbWUgPSBmb3VuZFVzZXIuZ2V0VXNlcklkKCkNCiAgICAgICAgICAg
 ICAgICBwcmludCAiR29vZ2xlKyBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gZm91bmRVc2VyTmF
 tZToiLCBmb3VuZFVzZXJOYW1lDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgdX
 NlckF1dGhlbnRpY2F0ZWQgPSBhdXRoZW50aWNhdGlvblNlcnZpY2UuYXV0aGVudGljYXRlKGZvd
 W5kVXNlck5hbWUpDQogICAgICAgICAgICAgICAgaWYgKHVzZXJBdXRoZW50aWNhdGVkID09IEZh
 bHNlKToNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgIkdvb2dsZSsgQXV0aGVudGljYXRlIGZ
 vciBzdGVwIDEuIEZhaWxlZCB0byBhdXRoZW50aWNhdGUgdXNlciINCiAgICAgICAgICAgICAgIC
 AgICAgcmV0dXJuIEZhbHNlDQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBwcmludCAiR
 29vZ2xlKyBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gU2V0dGluZyBjb3VudCBzdGVwcyB0byAx
 Ig0KICAgICAgICAgICAgICAgIGNvbnRleHQuc2V0KCJncGx1c19jb3VudF9sb2dpbl9zdGVwcyI
 sIDEpDQoNCiAgICAgICAgICAgICAgICBwb3N0TG9naW5SZXN1bHQgPSBzZWxmLmV4dGVuc2lvbl
 Bvc3RMb2dpbihjb25maWd1cmF0aW9uQXR0cmlidXRlcywgZm91bmRVc2VyKQ0KICAgICAgICAgI
 CAgICAgIHByaW50ICJHb29nbGUrIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBwb3N0TG9naW5S
 ZXN1bHQ6IiwgcG9zdExvZ2luUmVzdWx0DQoNCiAgICAgICAgICAgICAgICByZXR1cm4gcG9zdEx
 vZ2luUmVzdWx0DQogICAgICAgICAgICBlbGlmIChlbnJvbGxVc2VyRGVwbG95bWVudCk6DQogIC
 AgICAgICAgICAgICAgIyBVc2UgYXV0byBlbnJvbGxtZW50IHRvIGxvY2FsIElEUA0KICAgICAgI
 CAgICAgICAgIHByaW50ICJHb29nbGUrIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBBdHRlbXB0
 aW5nIHRvIGZpbmQgdXNlciBieSBveEV4dGVybmFsVWlkOiBncGx1czoiLCBncGx1c1VzZXJVaWQ
 NCiANCiAgICAgICAgICAgICAgICAjIENoZWNrIGlmIHRoZXJlIGlzIHVzZXIgd2l0aCBzcGVjaW
 ZpZWQgZ3BsdXNVc2VyVWlkDQogICAgICAgICAgICAgICAgZm91bmRVc2VyID0gdXNlclNlcnZpY
 2UuZ2V0VXNlckJ5QXR0cmlidXRlKCJveEV4dGVybmFsVWlkIiwgImdwbHVzOiIgKyBncGx1c1Vz
 ZXJVaWQpDQogDQogICAgICAgICAgICAgICAgaWYgKGZvdW5kVXNlciA9PSBOb25lKToNCiAgICA
 gICAgICAgICAgICAgICAgIyBBdXRvIHVzZXIgZW5yb2xsZW1udA0KICAgICAgICAgICAgICAgIC
 AgICBwcmludCAiR29vZ2xlKyBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gVGhlcmUgaXMgbm8gd
 XNlciBpbiBMREFQLiBBZGRpbmcgdXNlciB0byBsb2NhbCBMREFQIg0KDQogICAgICAgICAgICAg
 ICAgICAgIHByaW50ICJHb29nbGUrIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBBdHRlbXB0aW5
 nIHRvIGdldHMgdXNlciBpbmZvIg0KICAgICAgICAgICAgICAgICAgICB1c2VySW5mb1Jlc3Bvbn
 NlID0gc2VsZi5nZXRVc2VySW5mbyhjdXJyZW50Q2xpZW50U2VjcmV0cywgY29uZmlndXJhdGlvb
 kF0dHJpYnV0ZXMsIHRva2VuUmVzcG9uc2UuZ2V0QWNjZXNzVG9rZW4oKSkNCiAgICAgICAgICAg
 ICAgICAgICAgaWYgKCh1c2VySW5mb1Jlc3BvbnNlID09IE5vbmUpIG9yICh1c2VySW5mb1Jlc3B
 vbnNlLmdldENsYWltcygpLnNpemUoKSA9PSAwKSk6DQogICAgICAgICAgICAgICAgICAgICAgIC
 BwcmludCAiR29vZ2xlKyBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gRmFpbGVkIHRvIGdldCB1c
 2VyIGluZm8iDQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCiAgICAgICAg
 ICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICJHb29nbGU
 rIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBTdWNjZXNzZnVsbHkgZ2V0cyB1c2VyIGluZm8iDQ
 ogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBncGx1c1Jlc3BvbnNlQ
 XR0cmlidXRlcyA9IHVzZXJJbmZvUmVzcG9uc2UuZ2V0Q2xhaW1zKCkNCiANCiAgICAgICAgICAg
 ICAgICAgICAgIyBDb252ZXJ0IEdvb2dsZSsgdXNlciBjbGFpbXMgdG8gbG92ZXIgY2FzZQ0KICA
 gICAgICAgICAgICAgICAgICBncGx1c1Jlc3BvbnNlTm9ybWFsaXplZEF0dHJpYnV0ZXMgPSBIYX
 NoTWFwKCkNCiAgICAgICAgICAgICAgICAgICAgZm9yIGdwbHVzUmVzcG9uc2VBdHRyaWJ1dGVFb
 nRyeSBpbiBncGx1c1Jlc3BvbnNlQXR0cmlidXRlcy5lbnRyeVNldCgpOg0KICAgICAgICAgICAg
 ICAgICAgICAgICAgZ3BsdXNSZXNwb25zZU5vcm1hbGl6ZWRBdHRyaWJ1dGVzLnB1dCgNCiAgICA
 gICAgICAgICAgICAgICAgICAgICAgICBTdHJpbmdIZWxwZXIudG9Mb3dlckNhc2UoZ3BsdXNSZX
 Nwb25zZUF0dHJpYnV0ZUVudHJ5LmdldEtleSgpKSwgZ3BsdXNSZXNwb25zZUF0dHJpYnV0ZUVud
 HJ5LmdldFZhbHVlKCkpDQogDQogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRBdHRyaWJ1dGVz
 TWFwcGluZyA9IHNlbGYuZ2V0Q3VycmVudEF0dHJpYnV0ZXNNYXBwaW5nKHNlbGYuYXR0cmlidXR
 lc01hcHBpbmcsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCByZXF1ZXN0UGFyYW1ldGVycykNCi
 AgICAgICAgICAgICAgICAgICAgcHJpbnQgIkdvb2dsZSsgQXV0aGVudGljYXRlIGZvciBzdGVwI
 DEuIFVzaW5nIG5leHQgYXR0cmlidXRlcyBtYXBwaW5nIiwgY3VycmVudEF0dHJpYnV0ZXNNYXBw
 aW5nDQogDQogICAgICAgICAgICAgICAgICAgIG5ld1VzZXIgPSBVc2VyKCkNCiAgICAgICAgICA
 gICAgICAgICAgZm9yIGF0dHJpYnV0ZXNNYXBwaW5nRW50cnkgaW4gY3VycmVudEF0dHJpYnV0ZX
 NNYXBwaW5nLmVudHJ5U2V0KCk6DQogICAgICAgICAgICAgICAgICAgICAgICByZW1vdGVBdHRya
 WJ1dGUgPSBhdHRyaWJ1dGVzTWFwcGluZ0VudHJ5LmdldEtleSgpDQogICAgICAgICAgICAgICAg
 ICAgICAgICBsb2NhbEF0dHJpYnV0ZSA9IGF0dHJpYnV0ZXNNYXBwaW5nRW50cnkuZ2V0VmFsdWU
 oKQ0KIA0KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxBdHRyaWJ1dGVWYWx1ZSA9IGdwbH
 VzUmVzcG9uc2VOb3JtYWxpemVkQXR0cmlidXRlcy5nZXQocmVtb3RlQXR0cmlidXRlKQ0KICAgI
 CAgICAgICAgICAgICAgICAgICAgaWYgKGxvY2FsQXR0cmlidXRlICE9IE5vbmUpOg0KICAgICAg
 ICAgICAgICAgICAgICAgICAgICAgIG5ld1VzZXIuc2V0QXR0cmlidXRlKGxvY2FsQXR0cmlidXR
 lLCBsb2NhbEF0dHJpYnV0ZVZhbHVlKQ0KIA0KICAgICAgICAgICAgICAgICAgICBpZiAobmV3VX
 Nlci5nZXRBdHRyaWJ1dGUoInNuIikgPT0gTm9uZSk6DQogICAgICAgICAgICAgICAgICAgICAgI
 CBuZXdVc2VyLnNldEF0dHJpYnV0ZSgic24iLCBncGx1c1VzZXJVaWQpDQogDQogICAgICAgICAg
 ICAgICAgICAgIGlmIChuZXdVc2VyLmdldEF0dHJpYnV0ZSgiY24iKSA9PSBOb25lKToNCiAgICA
 gICAgICAgICAgICAgICAgICAgIG5ld1VzZXIuc2V0QXR0cmlidXRlKCJjbiIsIGdwbHVzVXNlcl
 VpZCkNCg0KICAgICAgICAgICAgICAgICAgICBuZXdVc2VyLnNldEF0dHJpYnV0ZSgib3hFeHRlc
 m5hbFVpZCIsICJncGx1czoiICsgZ3BsdXNVc2VyVWlkKQ0KICAgICAgICAgICAgICAgICAgICBw
 cmludCAiR29vZ2xlKyBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gQXR0ZW1wdGluZyB0byBhZGQ
 gdXNlciIsIGdwbHVzVXNlclVpZCwgIiB3aXRoIG5leHQgYXR0cmlidXRlcyIsIG5ld1VzZXIuZ2
 V0Q3VzdG9tQXR0cmlidXRlcygpDQogDQogICAgICAgICAgICAgICAgICAgIGZvdW5kVXNlciA9I
 HVzZXJTZXJ2aWNlLmFkZFVzZXIobmV3VXNlciwgVHJ1ZSkNCiAgICAgICAgICAgICAgICAgICAg
 cHJpbnQgIkdvb2dsZSsgQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIEFkZGVkIG5ldyB1c2VyIHd
 pdGggVUlEIiwgZm91bmRVc2VyLmdldFVzZXJJZCgpDQoNCiAgICAgICAgICAgICAgICBmb3VuZF
 VzZXJOYW1lID0gZm91bmRVc2VyLmdldFVzZXJJZCgpDQogICAgICAgICAgICAgICAgcHJpbnQgI
 kdvb2dsZSsgQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIGZvdW5kVXNlck5hbWU6IiwgZm91bmRV
 c2VyTmFtZQ0KDQogICAgICAgICAgICAgICAgdXNlckF1dGhlbnRpY2F0ZWQgPSBhdXRoZW50aWN
 hdGlvblNlcnZpY2UuYXV0aGVudGljYXRlKGZvdW5kVXNlck5hbWUpDQogICAgICAgICAgICAgIC
 AgaWYgKHVzZXJBdXRoZW50aWNhdGVkID09IEZhbHNlKToNCiAgICAgICAgICAgICAgICAgICAgc
 HJpbnQgIkdvb2dsZSsgQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIEZhaWxlZCB0byBhdXRoZW50
 aWNhdGUgdXNlciINCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICA
 gICAgICAgICBwcmludCAiR29vZ2xlKyBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gU2V0dGluZy
 Bjb3VudCBzdGVwcyB0byAxIg0KICAgICAgICAgICAgICAgIGNvbnRleHQuc2V0KCJncGx1c19jb
 3VudF9sb2dpbl9zdGVwcyIsIDEpDQoNCiAgICAgICAgICAgICAgICBwb3N0TG9naW5SZXN1bHQg
 PSBzZWxmLmV4dGVuc2lvblBvc3RMb2dpbihjb25maWd1cmF0aW9uQXR0cmlidXRlcywgZm91bmR
 Vc2VyKQ0KICAgICAgICAgICAgICAgIHByaW50ICJHb29nbGUrIEF1dGhlbnRpY2F0ZSBmb3Igc3
 RlcCAxLiBwb3N0TG9naW5SZXN1bHQ6IiwgcG9zdExvZ2luUmVzdWx0DQoNCiAgICAgICAgICAgI
 CAgICByZXR1cm4gcG9zdExvZ2luUmVzdWx0DQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAg
 ICAgICAgICMgQ2hlY2sgaWYgdGhlcmUgaXMgdXNlciB3aXRoIHNwZWNpZmllZCBncGx1c1VzZXJ
 VaWQNCiAgICAgICAgICAgICAgICBwcmludCAiR29vZ2xlKyBBdXRoZW50aWNhdGUgZm9yIHN0ZX
 AgMS4gQXR0ZW1wdGluZyB0byBmaW5kIHVzZXIgYnkgdWlkOiIsIGdwbHVzVXNlclVpZA0KDQogI
 CAgICAgICAgICAgICAgZm91bmRVc2VyID0gdXNlclNlcnZpY2UuZ2V0VXNlcihncGx1c1VzZXJV
 aWQpDQogICAgICAgICAgICAgICAgaWYgKGZvdW5kVXNlciA9PSBOb25lKToNCiAgICAgICAgICA
 gICAgICAgICAgcHJpbnQgIkdvb2dsZSsgQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIEZhaWxlZC
 B0byBmaW5kIHVzZXIiDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgI
 CAgICAgICAgICAgZm91bmRVc2VyTmFtZSA9IGZvdW5kVXNlci5nZXRVc2VySWQoKQ0KICAgICAg
 ICAgICAgICAgIHByaW50ICJHb29nbGUrIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBmb3VuZFV
 zZXJOYW1lOiIsIGZvdW5kVXNlck5hbWUNCg0KICAgICAgICAgICAgICAgIHVzZXJBdXRoZW50aW
 NhdGVkID0gYXV0aGVudGljYXRpb25TZXJ2aWNlLmF1dGhlbnRpY2F0ZShmb3VuZFVzZXJOYW1lK
 Q0KICAgICAgICAgICAgICAgIGlmICh1c2VyQXV0aGVudGljYXRlZCA9PSBGYWxzZSk6DQogICAg
 ICAgICAgICAgICAgICAgIHByaW50ICJHb29nbGUrIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiB
 GYWlsZWQgdG8gYXV0aGVudGljYXRlIHVzZXIiDQogICAgICAgICAgICAgICAgICAgIHJldHVybi
 BGYWxzZQ0KDQogICAgICAgICAgICAgICAgcHJpbnQgIkdvb2dsZSsgQXV0aGVudGljYXRlIGZvc
 iBzdGVwIDEuIFNldHRpbmcgY291bnQgc3RlcHMgdG8gMSINCiAgICAgICAgICAgICAgICBjb250
 ZXh0LnNldCgiZ3BsdXNfY291bnRfbG9naW5fc3RlcHMiLCAxKQ0KDQogICAgICAgICAgICAgICA
 gcG9zdExvZ2luUmVzdWx0ID0gc2VsZi5leHRlbnNpb25Qb3N0TG9naW4oY29uZmlndXJhdGlvbk
 F0dHJpYnV0ZXMsIGZvdW5kVXNlcikNCiAgICAgICAgICAgICAgICBwcmludCAiR29vZ2xlKyBBd
 XRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gcG9zdExvZ2luUmVzdWx0OiIsIHBvc3RMb2dpblJlc3Vs
 dA0KDQogICAgICAgICAgICAgICAgcmV0dXJuIHBvc3RMb2dpblJlc3VsdA0KICAgICAgICBlbGl
 mIChzdGVwID09IDIpOg0KICAgICAgICAgICAgcHJpbnQgIkdvb2dsZSsgQXV0aGVudGljYXRlIG
 ZvciBzdGVwIDIiDQogICAgICAgICAgICANCiAgICAgICAgICAgIHNlc3Npb25BdHRyaWJ1dGVzI
 D0gY29udGV4dC5nZXQoInNlc3Npb25BdHRyaWJ1dGVzIikNCiAgICAgICAgICAgIGlmIChzZXNz
 aW9uQXR0cmlidXRlcyA9PSBOb25lKSBvciBub3Qgc2Vzc2lvbkF0dHJpYnV0ZXMuY29udGFpbnN
 LZXkoImdwbHVzX3VzZXJfdWlkIik6DQogICAgICAgICAgICAgICAgcHJpbnQgIkdvb2dsZSsgQX
 V0aGVudGljYXRlIGZvciBzdGVwIDIuIGdwbHVzX3VzZXJfdWlkIGlzIGVtcHR5Ig0KICAgICAgI
 CAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgICAgICBncGx1c1VzZXJVaWQgPSBzZXNz
 aW9uQXR0cmlidXRlcy5nZXQoImdwbHVzX3VzZXJfdWlkIikNCiAgICAgICAgICAgIHBhc3NlZF9
 zdGVwMSA9IFN0cmluZ0hlbHBlci5pc05vdEVtcHR5U3RyaW5nKGdwbHVzVXNlclVpZCkNCiAgIC
 AgICAgICAgIGlmIChub3QgcGFzc2VkX3N0ZXAxKToNCiAgICAgICAgICAgICAgICByZXR1cm4gR
 mFsc2UNCg0KICAgICAgICAgICAgY3JlZGVudGlhbHMgPSBJZGVudGl0eS5pbnN0YW5jZSgpLmdl
 dENyZWRlbnRpYWxzKCkNCiAgICAgICAgICAgIHVzZXJOYW1lID0gY3JlZGVudGlhbHMuZ2V0VXN
 lcm5hbWUoKQ0KICAgICAgICAgICAgdXNlclBhc3N3b3JkID0gY3JlZGVudGlhbHMuZ2V0UGFzc3
 dvcmQoKQ0KDQogICAgICAgICAgICBsb2dnZWRJbiA9IEZhbHNlDQogICAgICAgICAgICBpZiAoU
 3RyaW5nSGVscGVyLmlzTm90RW1wdHlTdHJpbmcodXNlck5hbWUpIGFuZCBTdHJpbmdIZWxwZXIu
 aXNOb3RFbXB0eVN0cmluZyh1c2VyUGFzc3dvcmQpKToNCiAgICAgICAgICAgICAgICBsb2dnZWR
 JbiA9IHVzZXJTZXJ2aWNlLmF1dGhlbnRpY2F0ZSh1c2VyTmFtZSwgdXNlclBhc3N3b3JkKQ0KDQ
 ogICAgICAgICAgICBpZiAobm90IGxvZ2dlZEluKToNCiAgICAgICAgICAgICAgICByZXR1cm4gR
 mFsc2UNCg0KICAgICAgICAgICAgIyBDaGVjayBpZiB0aGVyZSBpcyB1c2VyIHdoaWNoIGhhcyBn
 cGx1c1VzZXJVaWQNCiAgICAgICAgICAgICMgQXZvaWQgbWFwcGluZyBHb29nbGUgYWNjb3VudCB
 0byBtb3JlIHRoYW4gb25lIElEUCBhY2NvdW50DQogICAgICAgICAgICBmb3VuZFVzZXIgPSB1c2
 VyU2VydmljZS5nZXRVc2VyQnlBdHRyaWJ1dGUoIm94RXh0ZXJuYWxVaWQiLCAiZ3BsdXM6IiArI
 GdwbHVzVXNlclVpZCkNCg0KICAgICAgICAgICAgaWYgKGZvdW5kVXNlciA9PSBOb25lKToNCiAg
 ICAgICAgICAgICAgICAjIEFkZCBncGx1c1VzZXJVaWQgdG8gdXNlciBvbmUgaWQgVUlEcw0KICA
 gICAgICAgICAgICAgIGZvdW5kVXNlciA9IHVzZXJTZXJ2aWNlLmFkZFVzZXJBdHRyaWJ1dGUodX
 Nlck5hbWUsICJveEV4dGVybmFsVWlkIiwgImdwbHVzOiIgKyBncGx1c1VzZXJVaWQpDQogICAgI
 CAgICAgICAgICAgaWYgKGZvdW5kVXNlciA9PSBOb25lKToNCiAgICAgICAgICAgICAgICAgICAg
 cHJpbnQgIkdvb2dsZSsgQXV0aGVudGljYXRlIGZvciBzdGVwIDIuIEZhaWxlZCB0byB1cGRhdGU
 gY3VycmVudCB1c2VyIg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgIC
 AgICAgICAgICAgIHBvc3RMb2dpblJlc3VsdCA9IHNlbGYuZXh0ZW5zaW9uUG9zdExvZ2luKGNvb
 mZpZ3VyYXRpb25BdHRyaWJ1dGVzLCBmb3VuZFVzZXIpDQogICAgICAgICAgICAgICAgcHJpbnQg
 Ikdvb2dsZSsgQXV0aGVudGljYXRlIGZvciBzdGVwIDIuIHBvc3RMb2dpblJlc3VsdDoiLCBwb3N
 0TG9naW5SZXN1bHQNCg0KICAgICAgICAgICAgICAgIHJldHVybiBwb3N0TG9naW5SZXN1bHQNCi
 AgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgZm91bmRVc2VyTmFtZSA9IGZvdW5kV
 XNlci5nZXRVc2VySWQoKQ0KICAgICAgICAgICAgICAgIHByaW50ICJHb29nbGUrIEF1dGhlbnRp
 Y2F0ZSBmb3Igc3RlcCAyLiBmb3VuZFVzZXJOYW1lOiIsIGZvdW5kVXNlck5hbWUNCiAgICANCiA
 gICAgICAgICAgICAgICBpZiBTdHJpbmdIZWxwZXIuZXF1YWxzKHVzZXJOYW1lLCBmb3VuZFVzZX
 JOYW1lKToNCiAgICAgICAgICAgICAgICAgICAgcG9zdExvZ2luUmVzdWx0ID0gc2VsZi5leHRlb
 nNpb25Qb3N0TG9naW4oY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIGZvdW5kVXNlcikNCiAgICAg
 ICAgICAgICAgICAgICAgcHJpbnQgIkdvb2dsZSsgQXV0aGVudGljYXRlIGZvciBzdGVwIDIuIHB
 vc3RMb2dpblJlc3VsdDoiLCBwb3N0TG9naW5SZXN1bHQNCiAgICANCiAgICAgICAgICAgICAgIC
 AgICAgcmV0dXJuIHBvc3RMb2dpblJlc3VsdA0KICAgICAgICANCiAgICAgICAgICAgIHJldHVyb
 iBGYWxzZQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICBk
 ZWYgcHJlcGFyZUZvclN0ZXAoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJlcXVlc3R
 QYXJhbWV0ZXJzLCBzdGVwKToNCiAgICAgICAgY29udGV4dCA9IENvbnRleHRzLmdldEV2ZW50Q2
 9udGV4dCgpDQogICAgICAgIGF1dGhlbnRpY2F0aW9uU2VydmljZSA9IEF1dGhlbnRpY2F0aW9uU
 2VydmljZS5pbnN0YW5jZSgpDQoNCiAgICAgICAgaWYgKHN0ZXAgPT0gMSk6DQogICAgICAgICAg
 ICBwcmludCAiR29vZ2xlKyBQcmVwYXJlIGZvciBzdGVwIDEiDQogICAgICAgICAgICANCiAgICA
 gICAgICAgIGN1cnJlbnRDbGllbnRTZWNyZXRzID0gc2VsZi5nZXRDdXJyZW50Q2xpZW50U2Vjcm
 V0cyhzZWxmLmNsaWVudFNlY3JldHMsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCByZXF1ZXN0U
 GFyYW1ldGVycykNCiAgICAgICAgICAgIGlmIChjdXJyZW50Q2xpZW50U2VjcmV0cyA9PSBOb25l
 KToNCiAgICAgICAgICAgICAgICBwcmludCAiR29vZ2xlKyBQcmVwYXJlIGZvciBzdGVwIDEuIEd
 vb2dsZSsgY2xpZW50IGNvbmZpZ3VyYXRpb24gaXMgaW52YWxpZCINCiAgICAgICAgICAgICAgIC
 ByZXR1cm4gRmFsc2UNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgY29udGV4dC5zZXQoImdwb
 HVzX2NsaWVudF9pZCIsIGN1cnJlbnRDbGllbnRTZWNyZXRzWyJ3ZWIiXVsiY2xpZW50X2lkIl0p
 DQogICAgICAgICAgICBjb250ZXh0LnNldCgiZ3BsdXNfY2xpZW50X3NlY3JldCIsIGN1cnJlbnR
 DbGllbnRTZWNyZXRzWyJ3ZWIiXVsiY2xpZW50X3NlY3JldCJdKQ0KDQogICAgICAgICAgICByZX
 R1cm4gVHJ1ZQ0KICAgICAgICBlbGlmIChzdGVwID09IDIpOg0KICAgICAgICAgICAgcHJpbnQgI
 kdvb2dsZSsgUHJlcGFyZSBmb3Igc3RlcCAyIg0KDQogICAgICAgICAgICByZXR1cm4gVHJ1ZQ0K
 ICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICBkZWYgZ2V0RXh
 0cmFQYXJhbWV0ZXJzRm9yU3RlcChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywgc3RlcC
 k6DQogICAgICAgIGlmIChzdGVwID09IDIpOg0KICAgICAgICAgICAgcmV0dXJuIEFycmF5cy5hc
 0xpc3QoImdwbHVzX3VzZXJfdWlkIikNCg0KICAgICAgICByZXR1cm4gTm9uZQ0KDQogICAgZGVm
 IGdldENvdW50QXV0aGVudGljYXRpb25TdGVwcyhzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXR
 lcyk6DQogICAgICAgIGNvbnRleHQgPSBDb250ZXh0cy5nZXRFdmVudENvbnRleHQoKQ0KICAgIC
 AgICBpZiAoY29udGV4dC5pc1NldCgiZ3BsdXNfY291bnRfbG9naW5fc3RlcHMiKSk6DQogICAgI
 CAgICAgICByZXR1cm4gY29udGV4dC5nZXQoImdwbHVzX2NvdW50X2xvZ2luX3N0ZXBzIikNCiAg
 ICAgICAgDQogICAgICAgIHJldHVybiAyDQoNCiAgICBkZWYgZ2V0UGFnZUZvclN0ZXAoc2VsZiw
 gY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHN0ZXApOg0KICAgICAgICBpZiAoc3RlcCA9PSAxKT
 oNCiAgICAgICAgICAgIHJldHVybiAiL2F1dGgvZ3BsdXMvZ3BsdXNsb2dpbi54aHRtbCINCg0KI
 CAgICAgICByZXR1cm4gIi9hdXRoL2dwbHVzL2dwbHVzcG9zdGxvZ2luLnhodG1sIg0KDQogICAg
 ZGVmIGxvZ291dChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywgcmVxdWVzdFBhcmFtZXR
 lcnMpOg0KICAgICAgICAjIFRPRE8gUmV2b2tlIHRva2VuDQogICAgICAgIHJldHVybiBUcnVlDQ
 oNCiAgICBkZWYgbG9hZENsaWVudFNlY3JldHMoc2VsZiwgY2xpZW50U2VjcmV0c0ZpbGUpOg0KI
 CAgICAgICBjbGllbnRTZWNyZXRzID0gTm9uZQ0KDQogICAgICAgICMgTG9hZCBjZXJ0aWZpY2F0
 ZSBmcm9tIGZpbGUNCiAgICAgICAgZiA9IG9wZW4oY2xpZW50U2VjcmV0c0ZpbGUsICdyJykNCiA
 gICAgICAgdHJ5Og0KICAgICAgICAgICAgY2xpZW50U2VjcmV0cyA9IGpzb24ubG9hZHMoZi5yZW
 FkKCkpDQogICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgIHByaW50ICJGYWlsZWQgdG8gbG9hZ
 CBHb29nbGUrIGNsaWVudCBzZWNyZXRzIGZyb20gZmlsZToiLCBjbGllbnRTZWNyZXRzDQogICAg
 ICAgICAgICByZXR1cm4gTm9uZQ0KICAgICAgICBmaW5hbGx5Og0KICAgICAgICAgICAgZi5jbG9
 zZSgpDQogICAgICAgIA0KICAgICAgICByZXR1cm4gY2xpZW50U2VjcmV0cw0KDQogICAgZGVmIG
 dldENsaWVudENvbmZpZ3VyYXRpb24oc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJlc
 XVlc3RQYXJhbWV0ZXJzKToNCiAgICAgICAgIyBHZXQgY2xpZW50IGNvbmZpZ3VyYXRpb24NCiAg
 ICAgICAgaWYgKGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmNvbnRhaW5zS2V5KCJncGx1c19jbGl
 lbnRfY29uZmlndXJhdGlvbl9hdHRyaWJ1dGUiKSk6DQogICAgICAgICAgICBjbGllbnRDb25maW
 d1cmF0aW9uQXR0cmlidXRlID0gY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuZ2V0KCJncGx1c19jb
 GllbnRfY29uZmlndXJhdGlvbl9hdHRyaWJ1dGUiKS5nZXRWYWx1ZTIoKQ0KICAgICAgICAgICAg
 cHJpbnQgIkdvb2dsZSsgR2V0Q2xpZW50Q29uZmlndXJhdGlvbi4gVXNpbmcgY2xpZW50IGF0dHJ
 pYnV0ZToiLCBjbGllbnRDb25maWd1cmF0aW9uQXR0cmlidXRlDQoNCiAgICAgICAgICAgIGlmIC
 hyZXF1ZXN0UGFyYW1ldGVycyA9PSBOb25lKToNCiAgICAgICAgICAgICAgICByZXR1cm4gTm9uZ
 Q0KDQogICAgICAgICAgICBjbGllbnRJZCA9IE5vbmUNCiAgICAgICAgICAgIA0KICAgICAgICAg
 ICAgIyBBdHRlbXB0IHRvIGRldGVybWluZSBjbGllbnRfaWQgZnJvbSByZXF1ZXN0DQogICAgICA
 gICAgICBjbGllbnRJZEFycmF5ID0gcmVxdWVzdFBhcmFtZXRlcnMuZ2V0KCJjbGllbnRfaWQiKQ
 0KICAgICAgICAgICAgaWYgKEFycmF5SGVscGVyLmlzTm90RW1wdHkoY2xpZW50SWRBcnJheSkgY
 W5kIFN0cmluZ0hlbHBlci5pc05vdEVtcHR5U3RyaW5nKGNsaWVudElkQXJyYXlbMF0pKToNCiAg
 ICAgICAgICAgICAgICBjbGllbnRJZCA9IGNsaWVudElkQXJyYXlbMF0NCg0KICAgICAgICAgICA
 gIyBBdHRlbXB0IHRvIGRldGVybWluZSBjbGllbnRfaWQgZnJvbSBldmVudCBjb250ZXh0DQogIC
 AgICAgICAgICBpZiAoY2xpZW50SWQgPT0gTm9uZSk6DQogICAgICAgICAgICAgICAgZXZlbnRDb
 250ZXh0ID0gQ29udGV4dHMuZ2V0RXZlbnRDb250ZXh0KCkNCiAgICAgICAgICAgICAgICBpZiAo
 ZXZlbnRDb250ZXh0LmlzU2V0KCJzdG9yZWRfcmVxdWVzdF9wYXJhbWV0ZXJzIikpOg0KICAgICA
 gICAgICAgICAgICAgICBjbGllbnRJZCA9IGV2ZW50Q29udGV4dC5nZXQoInN0b3JlZF9yZXF1ZX
 N0X3BhcmFtZXRlcnMiKS5nZXQoImNsaWVudF9pZCIpDQoNCiAgICAgICAgICAgIGlmIChjbGllb
 nRJZCA9PSBOb25lKToNCiAgICAgICAgICAgICAgICBwcmludCAiR29vZ2xlKyBHZXRDbGllbnRD
 b25maWd1cmF0aW9uLiBjbGllbnRfaWQgaXMgZW1wdHkiDQogICAgICAgICAgICAgICAgcmV0dXJ
 uIE5vbmUNCg0KICAgICAgICAgICAgY2xpZW50U2VydmljZSA9IENsaWVudFNlcnZpY2UuaW5zdG
 FuY2UoKQ0KICAgICAgICAgICAgY2xpZW50ID0gY2xpZW50U2VydmljZS5nZXRDbGllbnQoY2xpZ
 W50SWQpDQogICAgICAgICAgICBpZiAoY2xpZW50ID09IE5vbmUpOg0KICAgICAgICAgICAgICAg
 IHByaW50ICJHb29nbGUrIEdldENsaWVudENvbmZpZ3VyYXRpb24uIEZhaWxlZCB0byBmaW5kIGN
 saWVudCIsIGNsaWVudElkLCAiIGluIGxvY2FsIExEQVAiDQogICAgICAgICAgICAgICAgcmV0dX
 JuIE5vbmUNCg0KICAgICAgICAgICAgY2xpZW50Q29uZmlndXJhdGlvbiA9IGNsaWVudFNlcnZpY
 2UuZ2V0Q3VzdG9tQXR0cmlidXRlKGNsaWVudCwgY2xpZW50Q29uZmlndXJhdGlvbkF0dHJpYnV0
 ZSkNCiAgICAgICAgICAgIGlmICgoY2xpZW50Q29uZmlndXJhdGlvbiA9PSBOb25lKSBvciBTdHJ
 pbmdIZWxwZXIuaXNFbXB0eShjbGllbnRDb25maWd1cmF0aW9uLmdldFZhbHVlKCkpKToNCiAgIC
 AgICAgICAgICAgICBwcmludCAiR29vZ2xlKyBHZXRDbGllbnRDb25maWd1cmF0aW9uLiBDbGllb
 nQiLCBjbGllbnRJZCwgIiBhdHRyaWJ1dGUiLCBjbGllbnRDb25maWd1cmF0aW9uQXR0cmlidXRl
 LCAiIGlzIGVtcHR5Ig0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBwcmludCA
 iR29vZ2xlKyBHZXRDbGllbnRDb25maWd1cmF0aW9uLiBDbGllbnQiLCBjbGllbnRJZCwgIiBhdH
 RyaWJ1dGUiLCBjbGllbnRDb25maWd1cmF0aW9uQXR0cmlidXRlLCAiIGlzIiwgY2xpZW50Q29uZ
 mlndXJhdGlvbg0KICAgICAgICAgICAgICAgIHJldHVybiBjbGllbnRDb25maWd1cmF0aW9uDQoN
 CiAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgIGRlZiBnZXRDdXJyZW50Q2xpZW50U2VjcmV0cyh
 zZWxmLCBjdXJyZW50Q2xpZW50U2VjcmV0cywgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJlcX
 Vlc3RQYXJhbWV0ZXJzKToNCiAgICAgICAgY2xpZW50Q29uZmlndXJhdGlvbiA9IHNlbGYuZ2V0Q
 2xpZW50Q29uZmlndXJhdGlvbihjb25maWd1cmF0aW9uQXR0cmlidXRlcywgcmVxdWVzdFBhcmFt
 ZXRlcnMpDQogICAgICAgIGlmIChjbGllbnRDb25maWd1cmF0aW9uID09IE5vbmUpOg0KICAgICA
 gICAgICAgcmV0dXJuIGN1cnJlbnRDbGllbnRTZWNyZXRzDQogICAgICAgIA0KICAgICAgICBjbG
 llbnRDb25maWd1cmF0aW9uVmFsdWUgPSBqc29uLmxvYWRzKGNsaWVudENvbmZpZ3VyYXRpb24uZ
 2V0VmFsdWUoKSkNCg0KICAgICAgICByZXR1cm4gY2xpZW50Q29uZmlndXJhdGlvblZhbHVlWyJn
 cGx1cyJdDQoNCiAgICBkZWYgZ2V0Q3VycmVudEF0dHJpYnV0ZXNNYXBwaW5nKHNlbGYsIGN1cnJ
 lbnRBdHRyaWJ1dGVzTWFwcGluZywgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJlcXVlc3RQYX
 JhbWV0ZXJzKToNCiAgICAgICAgY2xpZW50Q29uZmlndXJhdGlvbiA9IHNlbGYuZ2V0Q2xpZW50Q
 29uZmlndXJhdGlvbihjb25maWd1cmF0aW9uQXR0cmlidXRlcywgcmVxdWVzdFBhcmFtZXRlcnMp
 DQogICAgICAgIGlmIChjbGllbnRDb25maWd1cmF0aW9uID09IE5vbmUpOg0KICAgICAgICAgICA
 gcmV0dXJuIGN1cnJlbnRBdHRyaWJ1dGVzTWFwcGluZw0KDQogICAgICAgIGNsaWVudENvbmZpZ3
 VyYXRpb25WYWx1ZSA9IGpzb24ubG9hZHMoY2xpZW50Q29uZmlndXJhdGlvbi5nZXRWYWx1ZSgpK
 Q0KDQogICAgICAgIGNsaWVudEF0dHJpYnV0ZXNNYXBwaW5nID0gc2VsZi5wcmVwYXJlQXR0cmli
 dXRlc01hcHBpbmcoY2xpZW50Q29uZmlndXJhdGlvblZhbHVlWyJncGx1c19yZW1vdGVfYXR0cml
 idXRlc19saXN0Il0sIGNsaWVudENvbmZpZ3VyYXRpb25WYWx1ZVsiZ3BsdXNfbG9jYWxfYXR0cm
 lidXRlc19saXN0Il0pDQogICAgICAgIGlmIChjbGllbnRBdHRyaWJ1dGVzTWFwcGluZyA9PSBOb
 25lKToNCiAgICAgICAgICAgIHByaW50ICJHb29nbGUrIEdldEN1cnJlbnRBdHRyaWJ1dGVzTWFw
 cGluZy4gQ2xpZW50IGF0dHJpYnV0ZXMgbWFwcGluZyBpcyBpbnZhbGlkLiBVc2luZyBkZWZhdWx
 0IG9uZSINCiAgICAgICAgICAgIHJldHVybiBjdXJyZW50QXR0cmlidXRlc01hcHBpbmcNCg0KIC
 AgICAgICByZXR1cm4gY2xpZW50QXR0cmlidXRlc01hcHBpbmcNCg0KICAgIGRlZiBwcmVwYXJlQ
 XR0cmlidXRlc01hcHBpbmcoc2VsZiwgcmVtb3RlQXR0cmlidXRlc0xpc3QsIGxvY2FsQXR0cmli
 dXRlc0xpc3QpOg0KICAgICAgICByZW1vdGVBdHRyaWJ1dGVzTGlzdEFycmF5ID0gU3RyaW5nSGV
 scGVyLnNwbGl0KHJlbW90ZUF0dHJpYnV0ZXNMaXN0LCAiLCIpDQogICAgICAgIGlmIChBcnJheU
 hlbHBlci5pc0VtcHR5KHJlbW90ZUF0dHJpYnV0ZXNMaXN0QXJyYXkpKToNCiAgICAgICAgICAgI
 HByaW50ICJHb29nbGUrIFByZXBhcmVBdHRyaWJ1dGVzTWFwcGluZy4gVGhlcmUgaXMgbm8gYXR0
 cmlidXRlcyBzcGVjaWZpZWQgaW4gcmVtb3RlQXR0cmlidXRlc0xpc3QgcHJvcGVydHkiDQogICA
 gICAgICAgICByZXR1cm4gTm9uZQ0KICAgICAgICANCiAgICAgICAgbG9jYWxBdHRyaWJ1dGVzTG
 lzdEFycmF5ID0gU3RyaW5nSGVscGVyLnNwbGl0KGxvY2FsQXR0cmlidXRlc0xpc3QsICIsIikNC
 iAgICAgICAgaWYgKEFycmF5SGVscGVyLmlzRW1wdHkobG9jYWxBdHRyaWJ1dGVzTGlzdEFycmF5
 KSk6DQogICAgICAgICAgICBwcmludCAiR29vZ2xlKyBQcmVwYXJlQXR0cmlidXRlc01hcHBpbmc
 uIFRoZXJlIGlzIG5vIGF0dHJpYnV0ZXMgc3BlY2lmaWVkIGluIGxvY2FsQXR0cmlidXRlc0xpc3
 QgcHJvcGVydHkiDQogICAgICAgICAgICByZXR1cm4gTm9uZQ0KDQogICAgICAgIGlmIChsZW4oc
 mVtb3RlQXR0cmlidXRlc0xpc3RBcnJheSkgIT0gbGVuKGxvY2FsQXR0cmlidXRlc0xpc3RBcnJh
 eSkpOg0KICAgICAgICAgICAgcHJpbnQgIkdvb2dsZSsgUHJlcGFyZUF0dHJpYnV0ZXNNYXBwaW5
 nLiBUaGUgbnVtYmVyIG9mIGF0dHJpYnV0ZXMgaW4gcmVtb3RlQXR0cmlidXRlc0xpc3QgYW5kIG
 xvY2FsQXR0cmlidXRlc0xpc3QgaXNuJ3QgZXF1YWwiDQogICAgICAgICAgICByZXR1cm4gTm9uZ
 Q0KICAgICAgICANCiAgICAgICAgYXR0cmlidXRlTWFwcGluZyA9IElkZW50aXR5SGFzaE1hcCgp
 DQogICAgICAgIGNvbnRhaW5zVWlkID0gRmFsc2UNCiAgICAgICAgaSA9IDANCiAgICAgICAgY29
 1bnQgPSBsZW4ocmVtb3RlQXR0cmlidXRlc0xpc3RBcnJheSkNCiAgICAgICAgd2hpbGUgKGkgPC
 Bjb3VudCk6DQogICAgICAgICAgICByZW1vdGVBdHRyaWJ1dGUgPSBTdHJpbmdIZWxwZXIudG9Mb
 3dlckNhc2UocmVtb3RlQXR0cmlidXRlc0xpc3RBcnJheVtpXSkNCiAgICAgICAgICAgIGxvY2Fs
 QXR0cmlidXRlID0gU3RyaW5nSGVscGVyLnRvTG93ZXJDYXNlKGxvY2FsQXR0cmlidXRlc0xpc3R
 BcnJheVtpXSkNCiAgICAgICAgICAgIGF0dHJpYnV0ZU1hcHBpbmcucHV0KHJlbW90ZUF0dHJpYn
 V0ZSwgbG9jYWxBdHRyaWJ1dGUpDQoNCiAgICAgICAgICAgIGlmIChTdHJpbmdIZWxwZXIuZXF1Y
 WxzSWdub3JlQ2FzZShsb2NhbEF0dHJpYnV0ZSwgInVpZCIpKToNCiAgICAgICAgICAgICAgICBj
 b250YWluc1VpZCA9IFRydWUNCg0KICAgICAgICAgICAgaSA9IGkgKyAxDQoNCiAgICAgICAgaWY
 gKG5vdCBjb250YWluc1VpZCk6DQogICAgICAgICAgICBwcmludCAiR29vZ2xlKyBQcmVwYXJlQX
 R0cmlidXRlc01hcHBpbmcuIFRoZXJlIGlzIG5vIG1hcHBpbmcgdG8gbWFuZGF0b3J5ICd1aWQnI
 GF0dHJpYnV0ZSINCiAgICAgICAgICAgIHJldHVybiBOb25lDQogICAgICAgIA0KICAgICAgICBy
 ZXR1cm4gYXR0cmlidXRlTWFwcGluZw0KDQogICAgZGVmIGdldFRva2Vuc0J5Q29kZShzZWxmLCB
 jdXJyZW50Q2xpZW50U2VjcmV0cywgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIGNvZGUpOg0KIC
 AgICAgICB0b2tlblJlcXVlc3QgPSBUb2tlblJlcXVlc3QoR3JhbnRUeXBlLkNMSUVOVF9DUkVER
 U5USUFMUykNCiAgICAgICAgdG9rZW5SZXF1ZXN0LnNldEF1dGhlbnRpY2F0aW9uTWV0aG9kKEF1
 dGhlbnRpY2F0aW9uTWV0aG9kLkNMSUVOVF9TRUNSRVRfUE9TVCkNCiAgICAgICAgdG9rZW5SZXF
 1ZXN0LnNldENvZGUoY29kZSkNCiAgICAgICAgdG9rZW5SZXF1ZXN0LnNldEF1dGhVc2VybmFtZS
 hjdXJyZW50Q2xpZW50U2VjcmV0c1sid2ViIl1bImNsaWVudF9pZCJdKQ0KICAgICAgICB0b2tlb
 lJlcXVlc3Quc2V0QXV0aFBhc3N3b3JkKGN1cnJlbnRDbGllbnRTZWNyZXRzWyJ3ZWIiXVsiY2xp
 ZW50X3NlY3JldCJdKQ0KICAgICAgICB0b2tlblJlcXVlc3Quc2V0UmVkaXJlY3RVcmkoInBvc3R
 tZXNzYWdlIikNCiAgICAgICAgdG9rZW5SZXF1ZXN0LnNldEdyYW50VHlwZShHcmFudFR5cGUuQV
 VUSE9SSVpBVElPTl9DT0RFKQ0KDQogICAgICAgIHRva2VuQ2xpZW50ID0gVG9rZW5DbGllbnQoY
 3VycmVudENsaWVudFNlY3JldHNbIndlYiJdWyJ0b2tlbl91cmkiXSkNCiAgICAgICAgdG9rZW5D
 bGllbnQuc2V0UmVxdWVzdCh0b2tlblJlcXVlc3QpDQogICAgICAgIA0KICAgICAgICB0b2tlblJ
 lc3BvbnNlID0gdG9rZW5DbGllbnQuZXhlYygpDQogICAgICAgIGlmICgodG9rZW5SZXNwb25zZS
 A9PSBOb25lKSBvciAodG9rZW5SZXNwb25zZS5nZXRTdGF0dXMoKSAhPSAyMDApKToNCiAgICAgI
 CAgICAgIHJldHVybiBOb25lDQoNCiAgICAgICAgcmV0dXJuIHRva2VuUmVzcG9uc2UNCg0KICAg
 IGRlZiBnZXRVc2VySW5mbyhzZWxmLCBjdXJyZW50Q2xpZW50U2VjcmV0cywgY29uZmlndXJhdGl
 vbkF0dHJpYnV0ZXMsIGFjY2Vzc1Rva2VuKToNCiAgICAgICAgdXNlckluZm9DbGllbnQgPSBVc2
 VySW5mb0NsaWVudCgiaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20vcGx1cy92MS9wZW9wbGUvb
 WUvb3BlbklkQ29ubmVjdCIpDQoNCiAgICAgICAgdXNlckluZm9SZXNwb25zZSA9IHVzZXJJbmZv
 Q2xpZW50LmV4ZWNVc2VySW5mbyhhY2Nlc3NUb2tlbikNCiAgICAgICAgaWYgKCh1c2VySW5mb1J
 lc3BvbnNlID09IE5vbmUpIG9yICh1c2VySW5mb1Jlc3BvbnNlLmdldFN0YXR1cygpICE9IDIwMC
 kpOg0KICAgICAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgICAgICByZXR1cm4gdXNlckluZm9SZ
 XNwb25zZQ0KDQogICAgZGVmIGV4dGVuc2lvblBvc3RMb2dpbihzZWxmLCBjb25maWd1cmF0aW9u
 QXR0cmlidXRlcywgdXNlcik6DQogICAgICAgIGlmIChzZWxmLmV4dGVuc2lvbk1vZHVsZSAhPSB
 Ob25lKToNCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICBwb3N0TG9naW5SZXN1bH
 QgPSBzZWxmLmV4dGVuc2lvbk1vZHVsZS5wb3N0TG9naW4oY29uZmlndXJhdGlvbkF0dHJpYnV0Z
 XMsIHVzZXIpDQogICAgICAgICAgICAgICAgcHJpbnQgIkdvb2dsZSsgUG9zdExvZ2luIHJlc3Vs
 dDoiLCBwb3N0TG9naW5SZXN1bHQNCg0KICAgICAgICAgICAgICAgIHJldHVybiBwb3N0TG9naW5
 SZXN1bHQNCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24sIGV4Og0KICAgICAgICAgICAgIC
 AgIHByaW50ICJHb29nbGUrIFBvc3RMb2dpbi4gRmFpbGVkIHRvIGV4ZWN1dGUgcG9zdExvZ2luI
 G1ldGhvZCINCiAgICAgICAgICAgICAgICBwcmludCAiR29vZ2xlKyBQb3N0TG9naW4uIFVuZXhw
 ZWN0ZWQgZXJyb3I6IiwgZXgNCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCiAgICAgICA
 gICAgIGV4Y2VwdCBqYXZhLmxhbmcuVGhyb3dhYmxlLCBleDoNCiAgICAgICAgICAgICAgICBwcm
 ludCAiR29vZ2xlKyBQb3N0TG9naW4uIEZhaWxlZCB0byBleGVjdXRlIHBvc3RMb2dpbiBtZXRob
 2QiDQogICAgICAgICAgICAgICAgZXgucHJpbnRTdGFja1RyYWNlKCkgDQogICAgICAgICAgICAg
 ICAgcmV0dXJuIEZhbHNlDQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICByZXR1cm4gVHJ
 1ZQ0K
oxScriptType: person_authentication
programmingLanguage: python

dn: inum=%(inumOrg)s!D40C.1CA3,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Saml authentication module
displayName: saml
gluuStatus: false
inum: %(inumOrg)s!D40C.1CA3
oxConfigurationProperty: {"value1":"saml_certificate_file","value2":"/etc/ce
 rts/saml.pem","description":""}
oxConfigurationProperty: {"value1":"saml_deployment_type","value2":"enroll",
 "description":""}
oxConfigurationProperty: {"value1":"saml_idp_attributes_list","value2":"http
 ://schemas.xmlsoap.org/ws/2005/05/identity/claims/name, http://schemas.xmls
 oap.org/ws/2005/05/identity/claims/emailaddress, http://schemas.xmlsoap.org
 /ws/2005/05/identity/claims/givenname, http://schemas.xmlsoap.org/ws/2005/0
 5/identity/claims/surname, http://schemas.xmlsoap.org/ws/2005/05/identity/c
 laims/surname","description":""}
oxConfigurationProperty: {"value1":"saml_local_attributes_list","value2":"ui
 d, mail, givenName, sn, cn","description":""}
oxConfigurationProperty: {"value1":"saml_name_identifier_format","value2":"u
 rn:oasis:names:tc:SAML:2.0:nameid-format:persistent","description":""}
oxConfigurationProperty: {"value1":"saml_use_authn_context","value2":"true",
 "description":""}
oxConfigurationProperty: {"value1":"saml_validate_response","value2":"true",
 "description":""}
oxConfigurationProperty: {"value1":"saml_idp_sso_target_url","value2":"https
 ://idp.gluu.info/idp/profile/SAML2/Redirect/SSO","description":""}
oxConfigurationProperty: {"value1":"saml_issuer","value2":"https://sp.gluu.i
 nfo/shibboleth","description":""}
oxLevel: 50
oxModuleProperty: {"value1":"usage_type","value2":"interactive","description
 ":""}
oxRevision: 1
oxScript:: ZnJvbSBvcmcuamJvc3Muc2VhbS5jb250ZXh0cyBpbXBvcnQgQ29udGV4dCwgQ29ud
 GV4dHMNCmZyb20gb3JnLmpib3NzLnNlYW0uc2VjdXJpdHkgaW1wb3J0IElkZW50aXR5DQpmcm9t
 IGphdmF4LmZhY2VzLmNvbnRleHQgaW1wb3J0IEZhY2VzQ29udGV4dA0KZnJvbSBvcmcueGRpLm1
 vZGVsLmN1c3RvbS5zY3JpcHQudHlwZS5hdXRoIGltcG9ydCBQZXJzb25BdXRoZW50aWNhdGlvbl
 R5cGUNCmZyb20gb3JnLnhkaS5veGF1dGguc2VydmljZSBpbXBvcnQgVXNlclNlcnZpY2UsIENsa
 WVudFNlcnZpY2UsIEF1dGhlbnRpY2F0aW9uU2VydmljZSwgQXR0cmlidXRlU2VydmljZQ0KZnJv
 bSBvcmcueGRpLm94YXV0aC5zZXJ2aWNlLm5ldCBpbXBvcnQgSHR0cFNlcnZpY2UNCmZyb20gb3J
 nLnhkaS51dGlsIGltcG9ydCBTdHJpbmdIZWxwZXINCmZyb20gb3JnLnhkaS51dGlsIGltcG9ydC
 BBcnJheUhlbHBlcg0KZnJvbSBvcmcuZ2x1dS5zYW1sIGltcG9ydCBTYW1sQ29uZmlndXJhdGlvb
 iwgQXV0aFJlcXVlc3QsIFJlc3BvbnNlDQpmcm9tIGphdmEudXRpbCBpbXBvcnQgQXJyYXlzLCBB
 cnJheUxpc3QsIEhhc2hNYXAsIElkZW50aXR5SGFzaE1hcA0KZnJvbSBvcmcueGRpLm94YXV0aC5
 tb2RlbC5jb21tb24gaW1wb3J0IFVzZXIsIEN1c3RvbUF0dHJpYnV0ZQ0KDQppbXBvcnQgamF2YQ
 0KDQp0cnk6DQogICAgaW1wb3J0IGpzb24NCmV4Y2VwdCBJbXBvcnRFcnJvcjoNCiAgICBpbXBvc
 nQgc2ltcGxlanNvbiBhcyBqc29uDQoNCmNsYXNzIFBlcnNvbkF1dGhlbnRpY2F0aW9uKFBlcnNv
 bkF1dGhlbnRpY2F0aW9uVHlwZSk6DQogICAgZGVmIF9faW5pdF9fKHNlbGYsIGN1cnJlbnRUaW1
 lTWlsbGlzKToNCiAgICAgICAgc2VsZi5jdXJyZW50VGltZU1pbGxpcyA9IGN1cnJlbnRUaW1lTW
 lsbGlzDQoNCiAgICBkZWYgaW5pdChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogI
 CAgICAgIHByaW50ICJTYW1sLiBJbml0aWFsaXphdGlvbiINCg0KICAgICAgICBzYW1sX2NlcnRp
 ZmljYXRlX2ZpbGUgPSBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5nZXQoInNhbWxfY2VydGlmaWN
 hdGVfZmlsZSIpLmdldFZhbHVlMigpDQogICAgICAgIHNhbWxfaWRwX3Nzb190YXJnZXRfdXJsID
 0gY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuZ2V0KCJzYW1sX2lkcF9zc29fdGFyZ2V0X3VybCIpL
 mdldFZhbHVlMigpDQogICAgICAgIHNhbWxfaXNzdWVyID0gY29uZmlndXJhdGlvbkF0dHJpYnV0
 ZXMuZ2V0KCJzYW1sX2lzc3VlciIpLmdldFZhbHVlMigpDQogICAgICAgIHNhbWxfdXNlX2F1dGh
 uX2NvbnRleHQgPSBTdHJpbmdIZWxwZXIudG9Cb29sZWFuKGNvbmZpZ3VyYXRpb25BdHRyaWJ1dG
 VzLmdldCgic2FtbF91c2VfYXV0aG5fY29udGV4dCIpLmdldFZhbHVlMigpLCBUcnVlKQ0KICAgI
 CAgICBpZiAoc2FtbF91c2VfYXV0aG5fY29udGV4dCk6DQogICAgICAgICAgICBzYW1sX25hbWVf
 aWRlbnRpZmllcl9mb3JtYXQgPSBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5nZXQoInNhbWxfbmF
 tZV9pZGVudGlmaWVyX2Zvcm1hdCIpLmdldFZhbHVlMigpDQogICAgICAgIGVsc2U6DQogICAgIC
 AgICAgICBzYW1sX25hbWVfaWRlbnRpZmllcl9mb3JtYXQgPSBOb25lDQoNCiAgICAgICAgc2Ftb
 F9jZXJ0aWZpY2F0ZSA9IHNlbGYubG9hZENlcml0aWZpY2F0ZShzYW1sX2NlcnRpZmljYXRlX2Zp
 bGUpDQogICAgICAgIGlmIChTdHJpbmdIZWxwZXIuaXNFbXB0eShzYW1sX2NlcnRpZmljYXRlKSk
 6DQogICAgICAgICAgICBwcmludCAiU2FtbC4gSW5pdGlhbGl6YXRpb24uIEZpbGUgd2l0aCB4NT
 A5IGNlcnRpZmljYXRlIHNob3VsZCBiZSBub3QgZW1wdHkiDQogICAgICAgICAgICByZXR1cm4gR
 mFsc2UNCg0KICAgICAgICBzYW1sQ29uZmlndXJhdGlvbiA9IFNhbWxDb25maWd1cmF0aW9uKCkN
 Cg0KICAgICAgICAjIFNldCB0aGUgaXNzdWVyIG9mIHRoZSBhdXRoZW50aWNhdGlvbiByZXF1ZXN
 0LiBUaGlzIHdvdWxkIHVzdWFsbHkgYmUgdGhlIFVSTCBvZiB0aGUgaXNzdWluZyB3ZWIgYXBwbG
 ljYXRpb24NCiAgICAgICAgc2FtbENvbmZpZ3VyYXRpb24uc2V0SXNzdWVyKHNhbWxfaXNzdWVyK
 Q0KDQogICAgICAgICMgVGVsbHMgdGhlIElkUCB0byByZXR1cm4gYSBwZXJzaXN0ZW50IGlkZW50
 aWZpZXIgZm9yIHRoZSB1c2VyDQogICAgICAgIHNhbWxDb25maWd1cmF0aW9uLnNldE5hbWVJZGV
 udGlmaWVyRm9ybWF0KHNhbWxfbmFtZV9pZGVudGlmaWVyX2Zvcm1hdCkNCiAgDQogICAgICAgIC
 MgVGhlIFVSTCBhdCB0aGUgSWRlbnRpdHkgUHJvdmlkZXIgd2hlcmUgdG8gdGhlIGF1dGhlbnRpY
 2F0aW9uIHJlcXVlc3Qgc2hvdWxkIGJlIHNlbnQNCiAgICAgICAgc2FtbENvbmZpZ3VyYXRpb24u
 c2V0SWRwU3NvVGFyZ2V0VXJsKHNhbWxfaWRwX3Nzb190YXJnZXRfdXJsKQ0KDQogICAgICAgICM
 gRW5hYmxlZGlhYmxlIFJlcXVlc3RlZEF1dGhuQ29udGV4dA0KICAgICAgICBzYW1sQ29uZmlndX
 JhdGlvbi5zZXRVc2VSZXF1ZXN0ZWRBdXRobkNvbnRleHQoc2FtbF91c2VfYXV0aG5fY29udGV4d
 CkNCiAgICAgICAgDQogICAgICAgICMgTG9hZCB4NTA5IGNlcnRpZmljYXRlDQogICAgICAgIHNh
 bWxDb25maWd1cmF0aW9uLmxvYWRDZXJ0aWZpY2F0ZUZyb21TdHJpbmcoc2FtbF9jZXJ0aWZpY2F
 0ZSkNCiAgICAgICAgDQogICAgICAgIHNlbGYuc2FtbENvbmZpZ3VyYXRpb24gPSBzYW1sQ29uZm
 lndXJhdGlvbg0KDQogICAgICAgIHNlbGYuYXR0cmlidXRlc01hcHBpbmcgPSBOb25lDQogICAgI
 CAgIGlmIChjb25maWd1cmF0aW9uQXR0cmlidXRlcy5jb250YWluc0tleSgic2FtbF9pZHBfYXR0
 cmlidXRlc19saXN0IikgYW5kDQogICAgICAgICAgICBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5
 jb250YWluc0tleSgic2FtbF9sb2NhbF9hdHRyaWJ1dGVzX2xpc3QiKSk6DQoNCiAgICAgICAgIC
 AgIHNhbWxfaWRwX2F0dHJpYnV0ZXNfbGlzdCA9IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmdld
 Cgic2FtbF9pZHBfYXR0cmlidXRlc19saXN0IikuZ2V0VmFsdWUyKCkNCiAgICAgICAgICAgIGlm
 IChTdHJpbmdIZWxwZXIuaXNFbXB0eShzYW1sX2lkcF9hdHRyaWJ1dGVzX2xpc3QpKToNCiAgICA
 gICAgICAgICAgICBwcmludCAiU2FtbC4gSW5pdGlhbGl6YXRpb24uIFRoZSBwcm9wZXJ0eSBzYW
 1sX2lkcF9hdHRyaWJ1dGVzX2xpc3QgaXMgZW1wdHkiDQogICAgICAgICAgICAgICAgcmV0dXJuI
 EZhbHNlDQoNCiAgICAgICAgICAgIHNhbWxfbG9jYWxfYXR0cmlidXRlc19saXN0ID0gY29uZmln
 dXJhdGlvbkF0dHJpYnV0ZXMuZ2V0KCJzYW1sX2xvY2FsX2F0dHJpYnV0ZXNfbGlzdCIpLmdldFZ
 hbHVlMigpDQogICAgICAgICAgICBpZiAoU3RyaW5nSGVscGVyLmlzRW1wdHkoc2FtbF9sb2NhbF
 9hdHRyaWJ1dGVzX2xpc3QpKToNCiAgICAgICAgICAgICAgICBwcmludCAiU2FtbC4gSW5pdGlhb
 Gl6YXRpb24uIFRoZSBwcm9wZXJ0eSBzYW1sX2xvY2FsX2F0dHJpYnV0ZXNfbGlzdCBpcyBlbXB0
 eSINCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICAgc2VsZi5hdHR
 yaWJ1dGVzTWFwcGluZyA9IHNlbGYucHJlcGFyZUF0dHJpYnV0ZXNNYXBwaW5nKHNhbWxfaWRwX2
 F0dHJpYnV0ZXNfbGlzdCwgc2FtbF9sb2NhbF9hdHRyaWJ1dGVzX2xpc3QpDQogICAgICAgICAgI
 CBpZiAoc2VsZi5hdHRyaWJ1dGVzTWFwcGluZyA9PSBOb25lKToNCiAgICAgICAgICAgICAgICBw
 cmludCAiU2FtbC4gSW5pdGlhbGl6YXRpb24uIFRoZSBhdHRyaWJ1dGVzIG1hcHBpbmcgaXNuJ3Q
 gdmFsaWQiDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgc2VsZi5zYW
 1sRXh0ZW5zaW9uTW9kdWxlID0gTm9uZQ0KICAgICAgICBpZiAoY29uZmlndXJhdGlvbkF0dHJpY
 nV0ZXMuY29udGFpbnNLZXkoInNhbWxfZXh0ZW5zaW9uX21vZHVsZSIpKToNCiAgICAgICAgICAg
 IHNhbWxfZXh0ZW5zaW9uX21vZHVsZV9uYW1lID0gY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuZ2V
 0KCJzYW1sX2V4dGVuc2lvbl9tb2R1bGUiKS5nZXRWYWx1ZTIoKQ0KICAgICAgICAgICAgdHJ5Og
 0KICAgICAgICAgICAgICAgIHNlbGYuc2FtbEV4dGVuc2lvbk1vZHVsZSA9IF9faW1wb3J0X18oc
 2FtbF9leHRlbnNpb25fbW9kdWxlX25hbWUpDQogICAgICAgICAgICAgICAgc2FtbF9leHRlbnNp
 b25fbW9kdWxlX2luaXRfcmVzdWx0ID0gc2VsZi5zYW1sRXh0ZW5zaW9uTW9kdWxlLmluaXQoY29
 uZmlndXJhdGlvbkF0dHJpYnV0ZXMpDQogICAgICAgICAgICAgICAgaWYgKG5vdCBzYW1sX2V4dG
 Vuc2lvbl9tb2R1bGVfaW5pdF9yZXN1bHQpOg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gR
 mFsc2UNCiAgICAgICAgICAgIGV4Y2VwdCBJbXBvcnRFcnJvciwgZXg6DQogICAgICAgICAgICAg
 ICAgcHJpbnQgIlNhbWwuIEluaXRpYWxpemF0aW9uLiBGYWlsZWQgdG8gbG9hZCBzYW1sX2V4dGV
 uc2lvbl9tb2R1bGU6Iiwgc2FtbF9leHRlbnNpb25fbW9kdWxlX25hbWUNCiAgICAgICAgICAgIC
 AgICBwcmludCAiU2FtbC4gSW5pdGlhbGl6YXRpb24uIFVuZXhwZWN0ZWQgZXJyb3I6IiwgZXgNC
 iAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICBwcmludCAiU2FtbC4gSW5p
 dGlhbGl6ZWQgc3VjY2Vzc2Z1bGx5Ig0KICAgICAgICByZXR1cm4gVHJ1ZSAgIA0KDQogICAgZGV
 mIGRlc3Ryb3koc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICBwcmludC
 AiU2FtbC4gRGVzdHJveSINCiAgICAgICAgcHJpbnQgIlNhbWwuIERlc3Ryb3llZCBzdWNjZXNzZ
 nVsbHkiDQogICAgICAgIHJldHVybiBUcnVlDQoNCiAgICBkZWYgZ2V0QXBpVmVyc2lvbihzZWxm
 KToNCiAgICAgICAgcmV0dXJuIDENCg0KICAgIGRlZiBpc1ZhbGlkQXV0aGVudGljYXRpb25NZXR
 ob2Qoc2VsZiwgdXNhZ2VUeXBlLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIH
 JldHVybiBUcnVlDQoNCiAgICBkZWYgZ2V0QWx0ZXJuYXRpdmVBdXRoZW50aWNhdGlvbk1ldGhvZ
 ChzZWxmLCB1c2FnZVR5cGUsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcmV0
 dXJuIE5vbmUNCg0KICAgIGRlZiBhdXRoZW50aWNhdGUoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJ
 pYnV0ZXMsIHJlcXVlc3RQYXJhbWV0ZXJzLCBzdGVwKToNCiAgICAgICAgY29udGV4dCA9IENvbn
 RleHRzLmdldEV2ZW50Q29udGV4dCgpDQogICAgICAgIGF1dGhlbnRpY2F0aW9uU2VydmljZSA9I
 EF1dGhlbnRpY2F0aW9uU2VydmljZS5pbnN0YW5jZSgpDQogICAgICAgIHVzZXJTZXJ2aWNlID0g
 VXNlclNlcnZpY2UuaW5zdGFuY2UoKQ0KDQogICAgICAgIHNhbWxfbWFwX3VzZXIgPSBGYWxzZQ0
 KICAgICAgICBzYW1sX2Vucm9sbF91c2VyID0gRmFsc2UNCiAgICAgICAgc2FtbF9lbnJvbGxfYW
 xsX3VzZXJfYXR0ciA9IEZhbHNlDQogICAgICAgICMgVXNlIHNhbWxfZGVwbG95bWVudF90eXBlI
 G9ubHkgaWYgdGhlcmUgaXMgbm8gYXR0cmlidXRlcyBtYXBwaW5nDQogICAgICAgIGlmIChjb25m
 aWd1cmF0aW9uQXR0cmlidXRlcy5jb250YWluc0tleSgic2FtbF9kZXBsb3ltZW50X3R5cGUiKSk
 6DQogICAgICAgICAgICBzYW1sX2RlcGxveW1lbnRfdHlwZSA9IFN0cmluZ0hlbHBlci50b0xvd2
 VyQ2FzZShjb25maWd1cmF0aW9uQXR0cmlidXRlcy5nZXQoInNhbWxfZGVwbG95bWVudF90eXBlI
 ikuZ2V0VmFsdWUyKCkpDQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmIChTdHJpbmdIZWxw
 ZXIuZXF1YWxzSWdub3JlQ2FzZShzYW1sX2RlcGxveW1lbnRfdHlwZSwgIm1hcCIpKToNCiAgICA
 gICAgICAgICAgICBzYW1sX21hcF91c2VyID0gVHJ1ZQ0KDQogICAgICAgICAgICBpZiAoU3RyaW
 5nSGVscGVyLmVxdWFsc0lnbm9yZUNhc2Uoc2FtbF9kZXBsb3ltZW50X3R5cGUsICJlbnJvbGwiK
 Sk6DQogICAgICAgICAgICAgICAgc2FtbF9lbnJvbGxfdXNlciA9IFRydWUNCg0KICAgICAgICAg
 ICAgaWYgKFN0cmluZ0hlbHBlci5lcXVhbHNJZ25vcmVDYXNlKHNhbWxfZGVwbG95bWVudF90eXB
 lLCAiZW5yb2xsX2FsbF9hdHRyIikpOg0KICAgICAgICAgICAgICAgIHNhbWxfZW5yb2xsX2FsbF
 91c2VyX2F0dHIgPSBUcnVlDQoNCiAgICAgICAgc2FtbF9hbGxvd19iYXNpY19sb2dpbiA9IEZhb
 HNlDQogICAgICAgIGlmIChjb25maWd1cmF0aW9uQXR0cmlidXRlcy5jb250YWluc0tleSgic2Ft
 bF9hbGxvd19iYXNpY19sb2dpbiIpKToNCiAgICAgICAgICAgIHNhbWxfYWxsb3dfYmFzaWNfbG9
 naW4gPSBTdHJpbmdIZWxwZXIudG9Cb29sZWFuKGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmdldC
 gic2FtbF9hbGxvd19iYXNpY19sb2dpbiIpLmdldFZhbHVlMigpLCBGYWxzZSkNCg0KICAgICAgI
 CB1c2VfYmFzaWNfYXV0aCA9IEZhbHNlDQogICAgICAgIGlmIChzYW1sX2FsbG93X2Jhc2ljX2xv
 Z2luKToNCiAgICAgICAgICAgICMgRGV0ZWN0IGlmIHVzZXIgdXNlZCBiYXNpYyBhdXRobmV0aWN
 hdGlvbiBtZXRob2QNCiAgICAgICAgICAgIGNyZWRlbnRpYWxzID0gSWRlbnRpdHkuaW5zdGFuY2
 UoKS5nZXRDcmVkZW50aWFscygpDQoNCiAgICAgICAgICAgIHVzZXJfbmFtZSA9IGNyZWRlbnRpY
 WxzLmdldFVzZXJuYW1lKCkNCiAgICAgICAgICAgIHVzZXJfcGFzc3dvcmQgPSBjcmVkZW50aWFs
 cy5nZXRQYXNzd29yZCgpDQogICAgICAgICAgICBpZiAoU3RyaW5nSGVscGVyLmlzTm90RW1wdHk
 odXNlcl9uYW1lKSBhbmQgU3RyaW5nSGVscGVyLmlzTm90RW1wdHkodXNlcl9wYXNzd29yZCkpOg
 0KICAgICAgICAgICAgICAgIHVzZV9iYXNpY19hdXRoID0gVHJ1ZQ0KDQogICAgICAgIGlmICgoc
 3RlcCA9PSAxKSBhbmQgc2FtbF9hbGxvd19iYXNpY19sb2dpbiBhbmQgdXNlX2Jhc2ljX2F1dGgp
 Og0KICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBCYXN
 pYyBhdXRoZW50aWNhdGlvbiINCg0KICAgICAgICAgICAgY29udGV4dC5zZXQoInNhbWxfY291bn
 RfbG9naW5fc3RlcHMiLCAxKQ0KDQogICAgICAgICAgICBjcmVkZW50aWFscyA9IElkZW50aXR5L
 mluc3RhbmNlKCkuZ2V0Q3JlZGVudGlhbHMoKQ0KICAgICAgICAgICAgdXNlcl9uYW1lID0gY3Jl
 ZGVudGlhbHMuZ2V0VXNlcm5hbWUoKQ0KICAgICAgICAgICAgdXNlcl9wYXNzd29yZCA9IGNyZWR
 lbnRpYWxzLmdldFBhc3N3b3JkKCkNCg0KICAgICAgICAgICAgbG9nZ2VkX2luID0gRmFsc2UNCi
 AgICAgICAgICAgIGlmIChTdHJpbmdIZWxwZXIuaXNOb3RFbXB0eVN0cmluZyh1c2VyX25hbWUpI
 GFuZCBTdHJpbmdIZWxwZXIuaXNOb3RFbXB0eVN0cmluZyh1c2VyX3Bhc3N3b3JkKSk6DQogICAg
 ICAgICAgICAgICAgdXNlclNlcnZpY2UgPSBVc2VyU2VydmljZS5pbnN0YW5jZSgpDQogICAgICA
 gICAgICAgICAgbG9nZ2VkX2luID0gdXNlclNlcnZpY2UuYXV0aGVudGljYXRlKHVzZXJfbmFtZS
 wgdXNlcl9wYXNzd29yZCkNCg0KICAgICAgICAgICAgaWYgKG5vdCBsb2dnZWRfaW4pOg0KICAgI
 CAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgICAgICByZXR1cm4gVHJ1ZQ0KDQog
 ICAgICAgIGlmIChzdGVwID09IDEpOg0KICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhlbnR
 pY2F0ZSBmb3Igc3RlcCAxIg0KDQogICAgICAgICAgICBjdXJyZW50U2FtbENvbmZpZ3VyYXRpb2
 4gPSBzZWxmLmdldEN1cnJlbnRTYW1sQ29uZmlndXJhdGlvbihzZWxmLnNhbWxDb25maWd1cmF0a
 W9uLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywgcmVxdWVzdFBhcmFtZXRlcnMpDQogICAgICAg
 ICAgICBpZiAoY3VycmVudFNhbWxDb25maWd1cmF0aW9uID09IE5vbmUpOg0KICAgICAgICAgICA
 gICAgIHByaW50ICJTYW1sLiBQcmVwYXJlIGZvciBzdGVwIDEuIENsaWVudCBzYW1sIGNvbmZpZ3
 VyYXRpb24gaXMgaW52YWxpZCINCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgI
 CAgICAgICAgc2FtbF9yZXNwb25zZV9hcnJheSA9IHJlcXVlc3RQYXJhbWV0ZXJzLmdldCgiU0FN
 TFJlc3BvbnNlIikNCiAgICAgICAgICAgIGlmIEFycmF5SGVscGVyLmlzRW1wdHkoc2FtbF9yZXN
 wb25zZV9hcnJheSk6DQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhlbnRpY2F0ZS
 Bmb3Igc3RlcCAxLiBzYW1sX3Jlc3BvbnNlIGlzIGVtcHR5Ig0KICAgICAgICAgICAgICAgIHJld
 HVybiBGYWxzZQ0KDQogICAgICAgICAgICBzYW1sX3Jlc3BvbnNlID0gc2FtbF9yZXNwb25zZV9h
 cnJheVswXQ0KDQogICAgICAgICAgICBwcmludCAiU2FtbC4gQXV0aGVudGljYXRlIGZvciBzdGV
 wIDEuIHNhbWxfcmVzcG9uc2U6Iiwgc2FtbF9yZXNwb25zZQ0KDQogICAgICAgICAgICBzYW1sUm
 VzcG9uc2UgPSBSZXNwb25zZShjdXJyZW50U2FtbENvbmZpZ3VyYXRpb24pDQogICAgICAgICAgI
 CBzYW1sUmVzcG9uc2UubG9hZFhtbEZyb21CYXNlNjQoc2FtbF9yZXNwb25zZSkNCiAgICAgICAg
 ICAgIA0KICAgICAgICAgICAgc2FtbF92YWxpZGF0ZV9yZXNwb25zZSA9IFRydWUNCiAgICAgICA
 gICAgIGlmIChjb25maWd1cmF0aW9uQXR0cmlidXRlcy5jb250YWluc0tleSgic2FtbF92YWxpZG
 F0ZV9yZXNwb25zZSIpKToNCiAgICAgICAgICAgICAgICBzYW1sX3ZhbGlkYXRlX3Jlc3BvbnNlI
 D0gU3RyaW5nSGVscGVyLnRvQm9vbGVhbihjb25maWd1cmF0aW9uQXR0cmlidXRlcy5nZXQoInNh
 bWxfdmFsaWRhdGVfcmVzcG9uc2UiKS5nZXRWYWx1ZTIoKSwgRmFsc2UpDQoNCiAgICAgICAgICA
 gIGlmIChzYW1sX3ZhbGlkYXRlX3Jlc3BvbnNlKToNCiAgICAgICAgICAgICAgICBpZiAobm90IH
 NhbWxSZXNwb25zZS5pc1ZhbGlkKCkpOg0KICAgICAgICAgICAgICAgICAgICBwcmludCAiU2Ftb
 C4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIHNhbWxfcmVzcG9uc2UgaXNuJ3QgdmFsaWQiDQoN
 CiAgICAgICAgICAgIHNhbWxfcmVzcG9uc2VfbmFtZV9pZCA9IHNhbWxSZXNwb25zZS5nZXROYW1
 lSWQoKQ0KICAgICAgICAgICAgaWYgKFN0cmluZ0hlbHBlci5pc0VtcHR5KHNhbWxfcmVzcG9uc2
 VfbmFtZV9pZCkpOg0KICAgICAgICAgICAgICAgIHByaW50ICJTYW1sLiBBdXRoZW50aWNhdGUgZ
 m9yIHN0ZXAgMS4gc2FtbF9yZXNwb25zZV9uYW1lX2lkIGlzIGludmFsaWQiDQogICAgICAgICAg
 ICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgIHByaW50ICJTYW1sLiBBdXRoZW50aWN
 hdGUgZm9yIHN0ZXAgMS4gc2FtbF9yZXNwb25zZV9uYW1lX2lkOiIsIHNhbWxfcmVzcG9uc2Vfbm
 FtZV9pZA0KDQogICAgICAgICAgICBzYW1sX3Jlc3BvbnNlX2F0dHJpYnV0ZXMgPSBzYW1sUmVzc
 G9uc2UuZ2V0QXR0cmlidXRlcygpDQogICAgICAgICAgICBwcmludCAiU2FtbC4gQXV0aGVudGlj
 YXRlIGZvciBzdGVwIDEuIGF0dHJpYnV0ZXM6ICIsIHNhbWxfcmVzcG9uc2VfYXR0cmlidXRlcw0
 KDQogICAgICAgICAgICAjIFVzZSBwZXJzaXN0ZW50IElkIGFzIHNhbWxfdXNlcl91aWQNCiAgIC
 AgICAgICAgIHNhbWxfdXNlcl91aWQgPSBzYW1sX3Jlc3BvbnNlX25hbWVfaWQNCiAgICAgICAgI
 CAgIA0KICAgICAgICAgICAgaWYgKHNhbWxfbWFwX3VzZXIpOg0KICAgICAgICAgICAgICAgICMg
 VXNlIG1hcHBpbmcgdG8gbG9jYWwgSURQIHVzZXINCiAgICAgICAgICAgICAgICBwcmludCAiU2F
 tbC4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIEF0dGVtcHRpbmcgdG8gZmluZCB1c2VyIGJ5IG
 94RXh0ZXJuYWxVaWQ6IHNhbWw6Iiwgc2FtbF91c2VyX3VpZA0KDQogICAgICAgICAgICAgICAgI
 yBDaGVjayBpZiB0aGUgaXMgdXNlciB3aXRoIHNwZWNpZmllZCBzYW1sX3VzZXJfdWlkDQogICAg
 ICAgICAgICAgICAgZmluZF91c2VyX2J5X3VpZCA9IHVzZXJTZXJ2aWNlLmdldFVzZXJCeUF0dHJ
 pYnV0ZSgib3hFeHRlcm5hbFVpZCIsICJzYW1sOiIgKyBzYW1sX3VzZXJfdWlkKQ0KDQogICAgIC
 AgICAgICAgICAgaWYgKGZpbmRfdXNlcl9ieV91aWQgPT0gTm9uZSk6DQogICAgICAgICAgICAgI
 CAgICAgIHByaW50ICJTYW1sLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gRmFpbGVkIHRvIGZp
 bmQgdXNlciINCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhlbnRpY2F0ZSB
 mb3Igc3RlcCAxLiBTZXR0aW5nIGNvdW50IHN0ZXBzIHRvIDIiDQogICAgICAgICAgICAgICAgIC
 AgIGNvbnRleHQuc2V0KCJzYW1sX2NvdW50X2xvZ2luX3N0ZXBzIiwgMikNCiAgICAgICAgICAgI
 CAgICAgICAgY29udGV4dC5zZXQoInNhbWxfdXNlcl91aWQiLCBzYW1sX3VzZXJfdWlkKQ0KICAg
 ICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQ0KDQogICAgICAgICAgICAgICAgZm91bmRfdXN
 lcl9uYW1lID0gZmluZF91c2VyX2J5X3VpZC5nZXRVc2VySWQoKQ0KICAgICAgICAgICAgICAgIH
 ByaW50ICJTYW1sLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gZm91bmRfdXNlcl9uYW1lOiIsI
 GZvdW5kX3VzZXJfbmFtZQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIHVzZXJf
 YXV0aGVudGljYXRlZCA9IGF1dGhlbnRpY2F0aW9uU2VydmljZS5hdXRoZW50aWNhdGUoZm91bmR
 fdXNlcl9uYW1lKQ0KICAgICAgICAgICAgICAgIGlmICh1c2VyX2F1dGhlbnRpY2F0ZWQgPT0gRm
 Fsc2UpOg0KICAgICAgICAgICAgICAgICAgICBwcmludCAiU2FtbC4gQXV0aGVudGljYXRlIGZvc
 iBzdGVwIDEuIEZhaWxlZCB0byBhdXRoZW50aWNhdGUgdXNlciINCiAgICAgICAgICAgICAgICAg
 ICAgcmV0dXJuIEZhbHNlDQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBwcmludCAiU2F
 tbC4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIFNldHRpbmcgY291bnQgc3RlcHMgdG8gMSINCi
 AgICAgICAgICAgICAgICBjb250ZXh0LnNldCgic2FtbF9jb3VudF9sb2dpbl9zdGVwcyIsIDEpD
 QoNCiAgICAgICAgICAgICAgICBwb3N0X2xvZ2luX3Jlc3VsdCA9IHNlbGYuc2FtbEV4dGVuc2lv
 blBvc3RMb2dpbihjb25maWd1cmF0aW9uQXR0cmlidXRlcywgZmluZF91c2VyX2J5X3VpZCkNCiA
 gICAgICAgICAgICAgICBwcmludCAiU2FtbC4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIHBvc3
 RfbG9naW5fcmVzdWx0OiIsIHBvc3RfbG9naW5fcmVzdWx0DQoNCiAgICAgICAgICAgICAgICByZ
 XR1cm4gcG9zdF9sb2dpbl9yZXN1bHQNCiAgICAgICAgICAgIGVsaWYgKHNhbWxfZW5yb2xsX3Vz
 ZXIpOg0KICAgICAgICAgICAgICAgICMgVXNlIGF1dG8gZW5yb2xsbWVudCB0byBsb2NhbCBJRFA
 NCiAgICAgICAgICAgICAgICBwcmludCAiU2FtbC4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIE
 F0dGVtcHRpbmcgdG8gZmluZCB1c2VyIGJ5IG94RXh0ZXJuYWxVaWQ6IHNhbWw6Iiwgc2FtbF91c
 2VyX3VpZA0KDQogICAgICAgICAgICAgICAgIyBDaGVjayBpZiB0aGUgaXMgdXNlciB3aXRoIHNw
 ZWNpZmllZCBzYW1sX3VzZXJfdWlkDQogICAgICAgICAgICAgICAgZmluZF91c2VyX2J5X3VpZCA
 9IHVzZXJTZXJ2aWNlLmdldFVzZXJCeUF0dHJpYnV0ZSgib3hFeHRlcm5hbFVpZCIsICJzYW1sOi
 IgKyBzYW1sX3VzZXJfdWlkKQ0KDQogICAgICAgICAgICAgICAgaWYgKGZpbmRfdXNlcl9ieV91a
 WQgPT0gTm9uZSk6DQogICAgICAgICAgICAgICAgICAgICMgQXV0byB1c2VyIGVucm9sbGVtbnQN
 CiAgICAgICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCA
 xLiBUaGVyZSBpcyBubyB1c2VyIGluIExEQVAuIEFkZGluZyB1c2VyIHRvIGxvY2FsIExEQVAiDQ
 oNCiAgICAgICAgICAgICAgICAgICAgIyBDb252ZXJ0IHNhbWwgcmVzdWx0IGF0dHJpYnV0ZXMga
 2V5cyB0byBsb3ZlciBjYXNlDQogICAgICAgICAgICAgICAgICAgIHNhbWxfcmVzcG9uc2Vfbm9y
 bWFsaXplZF9hdHRyaWJ1dGVzID0gSGFzaE1hcCgpDQogICAgICAgICAgICAgICAgICAgIGZvciB
 zYW1sX3Jlc3BvbnNlX2F0dHJpYnV0ZV9lbnRyeSBpbiBzYW1sX3Jlc3BvbnNlX2F0dHJpYnV0ZX
 MuZW50cnlTZXQoKToNCiAgICAgICAgICAgICAgICAgICAgICAgIHNhbWxfcmVzcG9uc2Vfbm9yb
 WFsaXplZF9hdHRyaWJ1dGVzLnB1dCgNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTdHJp
 bmdIZWxwZXIudG9Mb3dlckNhc2Uoc2FtbF9yZXNwb25zZV9hdHRyaWJ1dGVfZW50cnkuZ2V0S2V
 5KCkpLCBzYW1sX3Jlc3BvbnNlX2F0dHJpYnV0ZV9lbnRyeS5nZXRWYWx1ZSgpKQ0KDQogICAgIC
 AgICAgICAgICAgICAgIGN1cnJlbnRBdHRyaWJ1dGVzTWFwcGluZyA9IHNlbGYucHJlcGFyZUN1c
 nJlbnRBdHRyaWJ1dGVzTWFwcGluZyhzZWxmLmF0dHJpYnV0ZXNNYXBwaW5nLCBjb25maWd1cmF0
 aW9uQXR0cmlidXRlcywgcmVxdWVzdFBhcmFtZXRlcnMpDQogICAgICAgICAgICAgICAgICAgIHB
 yaW50ICJTYW1sLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gVXNpbmcgbmV4dCBhdHRyaWJ1dG
 VzIG1hcHBpbmciLCBjdXJyZW50QXR0cmlidXRlc01hcHBpbmcNCg0KICAgICAgICAgICAgICAgI
 CAgICBuZXdVc2VyID0gVXNlcigpDQogICAgICAgICAgICAgICAgICAgIGZvciBhdHRyaWJ1dGVz
 TWFwcGluZ0VudHJ5IGluIGN1cnJlbnRBdHRyaWJ1dGVzTWFwcGluZy5lbnRyeVNldCgpOg0KICA
 gICAgICAgICAgICAgICAgICAgICAgaWRwQXR0cmlidXRlID0gYXR0cmlidXRlc01hcHBpbmdFbn
 RyeS5nZXRLZXkoKQ0KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxBdHRyaWJ1dGUgPSBhd
 HRyaWJ1dGVzTWFwcGluZ0VudHJ5LmdldFZhbHVlKCkNCg0KICAgICAgICAgICAgICAgICAgICAg
 ICAgbG9jYWxBdHRyaWJ1dGVWYWx1ZSA9IHNhbWxfcmVzcG9uc2Vfbm9ybWFsaXplZF9hdHRyaWJ
 1dGVzLmdldChpZHBBdHRyaWJ1dGUpDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAobG9jYW
 xBdHRyaWJ1dGUgIT0gTm9uZSk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3VXNlc
 i5zZXRBdHRyaWJ1dGUobG9jYWxBdHRyaWJ1dGUsIGxvY2FsQXR0cmlidXRlVmFsdWUpDQoNCiAg
 ICAgICAgICAgICAgICAgICAgbmV3VXNlci5zZXRBdHRyaWJ1dGUoIm94RXh0ZXJuYWxVaWQiLCA
 ic2FtbDoiICsgc2FtbF91c2VyX3VpZCkNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgIlNhbW
 wuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBBdHRlbXB0aW5nIHRvIGFkZCB1c2VyIiwgc2Ftb
 F91c2VyX3VpZCwgIiB3aXRoIG5leHQgYXR0cmlidXRlcyIsIG5ld1VzZXIuZ2V0Q3VzdG9tQXR0
 cmlidXRlcygpDQoNCiAgICAgICAgICAgICAgICAgICAgZmluZF91c2VyX2J5X3VpZCA9IHVzZXJ
 TZXJ2aWNlLmFkZFVzZXIobmV3VXNlciwgVHJ1ZSkNCiAgICAgICAgICAgICAgICAgICAgcHJpbn
 QgIlNhbWwuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBBZGRlZCBuZXcgdXNlciB3aXRoIFVJR
 CIsIGZpbmRfdXNlcl9ieV91aWQuZ2V0VXNlcklkKCkNCg0KICAgICAgICAgICAgICAgIGZvdW5k
 X3VzZXJfbmFtZSA9IGZpbmRfdXNlcl9ieV91aWQuZ2V0VXNlcklkKCkNCiAgICAgICAgICAgICA
 gICBwcmludCAiU2FtbC4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIGZvdW5kX3VzZXJfbmFtZT
 oiLCBmb3VuZF91c2VyX25hbWUNCg0KICAgICAgICAgICAgICAgIHVzZXJfYXV0aGVudGljYXRlZ
 CA9IGF1dGhlbnRpY2F0aW9uU2VydmljZS5hdXRoZW50aWNhdGUoZm91bmRfdXNlcl9uYW1lKQ0K
 ICAgICAgICAgICAgICAgIGlmICh1c2VyX2F1dGhlbnRpY2F0ZWQgPT0gRmFsc2UpOg0KICAgICA
 gICAgICAgICAgICAgICBwcmludCAiU2FtbC4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIEZhaW
 xlZCB0byBhdXRoZW50aWNhdGUgdXNlciINCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhb
 HNlDQoNCiAgICAgICAgICAgICAgICBwcmludCAiU2FtbC4gQXV0aGVudGljYXRlIGZvciBzdGVw
 IDEuIFNldHRpbmcgY291bnQgc3RlcHMgdG8gMSINCiAgICAgICAgICAgICAgICBjb250ZXh0LnN
 ldCgic2FtbF9jb3VudF9sb2dpbl9zdGVwcyIsIDEpDQoNCiAgICAgICAgICAgICAgICBwb3N0X2
 xvZ2luX3Jlc3VsdCA9IHNlbGYuc2FtbEV4dGVuc2lvblBvc3RMb2dpbihjb25maWd1cmF0aW9uQ
 XR0cmlidXRlcywgZmluZF91c2VyX2J5X3VpZCkNCiAgICAgICAgICAgICAgICBwcmludCAiU2Ft
 bC4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIHBvc3RfbG9naW5fcmVzdWx0OiIsIHBvc3RfbG9
 naW5fcmVzdWx0DQoNCiAgICAgICAgICAgICAgICByZXR1cm4gcG9zdF9sb2dpbl9yZXN1bHQNCi
 AgICAgICAgICAgIGVsaWYgKHNhbWxfZW5yb2xsX2FsbF91c2VyX2F0dHIpOg0KICAgICAgICAgI
 CAgICAgIHByaW50ICJTYW1sLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gQXR0ZW1wdGluZyB0
 byBmaW5kIHVzZXIgYnkgb3hFeHRlcm5hbFVpZDogc2FtbDoiICsgc2FtbF91c2VyX3VpZA0KDQo
 gICAgICAgICAgICAgICAgIyBDaGVjayBpZiB0aGUgaXMgdXNlciB3aXRoIHNwZWNpZmllZCBzYW
 1sX3VzZXJfdWlkDQogICAgICAgICAgICAgICAgZmluZF91c2VyX2J5X3VpZCA9IHVzZXJTZXJ2a
 WNlLmdldFVzZXJCeUF0dHJpYnV0ZSgib3hFeHRlcm5hbFVpZCIsICJzYW1sOiIgKyBzYW1sX3Vz
 ZXJfdWlkKQ0KDQogICAgICAgICAgICAgICAgaWYgKGZpbmRfdXNlcl9ieV91aWQgPT0gTm9uZSk
 6DQogICAgICAgICAgICAgICAgICAgIHByaW50ICJTYW1sLiBBdXRoZW50aWNhdGUgZm9yIHN0ZX
 AgMS4gRmFpbGVkIHRvIGZpbmQgdXNlciINCg0KICAgICAgICAgICAgICAgICAgICB1c2VyID0gV
 XNlcigpDQogICAgICAgICAgICAgICAgICAgIGN1c3RvbUF0dHJpYnV0ZXMgPSBBcnJheUxpc3Qo
 KQ0KICAgICAgICAgICAgICAgICAgICBmb3Iga2V5IGluIGF0dHJpYnV0ZXMua2V5U2V0KCk6DQo
 gICAgICAgICAgICAgICAgICAgICAgICBsZGFwQXR0cmlidXRlcyA9IGF0dHJpYnV0ZVNlcnZpY2
 UuZ2V0QWxsQXR0cmlidXRlcygpDQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgbGRhcEF0d
 HJpYnV0ZSBpbiBsZGFwQXR0cmlidXRlczoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBz
 YW1sMlVyaSA9IGxkYXBBdHRyaWJ1dGUuZ2V0U2FtbDJVcmkoKQ0KICAgICAgICAgICAgICAgICA
 gICAgICAgICAgIGlmKHNhbWwyVXJpID09IE5vbmUpOg0KICAgICAgICAgICAgICAgICAgICAgIC
 AgICAgICAgICBzYW1sMlVyaSA9IGF0dHJpYnV0ZVNlcnZpY2UuZ2V0RGVmYXVsdFNhbWwyVXJpK
 GxkYXBBdHRyaWJ1dGUuZ2V0TmFtZSgpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlm
 KHNhbWwyVXJpID09IGtleSk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJ
 pYnV0ZSA9IEN1c3RvbUF0dHJpYnV0ZShsZGFwQXR0cmlidXRlLmdldE5hbWUoKSkNCiAgICAgIC
 AgICAgICAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlLnNldFZhbHVlcyhhdHRyaWJ1dGVzL
 mdldChrZXkpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXN0b21BdHRyaWJ1
 dGVzLmFkZChhdHRyaWJ1dGUpDQoNCiAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlID0gQ3V
 zdG9tQXR0cmlidXRlKCJveEV4dGVybmFsVWlkIikNCiAgICAgICAgICAgICAgICAgICAgYXR0cm
 lidXRlLnNldFZhbHVlKCJzYW1sOiIgKyBzYW1sX3VzZXJfdWlkKQ0KICAgICAgICAgICAgICAgI
 CAgICBjdXN0b21BdHRyaWJ1dGVzLmFkZChhdHRyaWJ1dGUpDQogICAgICAgICAgICAgICAgICAg
 IHVzZXIuc2V0Q3VzdG9tQXR0cmlidXRlcyhjdXN0b21BdHRyaWJ1dGVzKQ0KDQogICAgICAgICA
 gICAgICAgICAgIGlmKHVzZXIuZ2V0QXR0cmlidXRlKCJzbiIpID09IE5vbmUpOg0KICAgICAgIC
 AgICAgICAgICAgICAgICAgYXR0cmlidXRlID0gQ3VzdG9tQXR0cmlidXRlKCJzbiIpDQogICAgI
 CAgICAgICAgICAgICAgICAgICBhdHRyaWJ1dGUuc2V0VmFsdWUoc2FtbF91c2VyX3VpZCkNCiAg
 ICAgICAgICAgICAgICAgICAgICAgIGN1c3RvbUF0dHJpYnV0ZXMuYWRkKGF0dHJpYnV0ZSkNCg0
 KICAgICAgICAgICAgICAgICAgICBpZih1c2VyLmdldEF0dHJpYnV0ZSgiY24iKSA9PSBOb25lKT
 oNCiAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZSA9IEN1c3RvbUF0dHJpYnV0ZSgiY
 24iKQ0KICAgICAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlLnNldFZhbHVlKHNhbWxfdXNl
 cl91aWQpDQogICAgICAgICAgICAgICAgICAgICAgICBjdXN0b21BdHRyaWJ1dGVzLmFkZChhdHR
 yaWJ1dGUpDQoNCiAgICAgICAgICAgICAgICAgICAgZmluZF91c2VyX2J5X3VpZCA9IHVzZXJTZX
 J2aWNlLmFkZFVzZXIodXNlciwgVHJ1ZSkNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgIlNhb
 WwuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBBZGRlZCBuZXcgdXNlciB3aXRoIFVJRCIsIGZp
 bmRfdXNlcl9ieV91aWQuZ2V0VXNlcklkKCkNCg0KICAgICAgICAgICAgICAgIGZvdW5kX3VzZXJ
 fbmFtZSA9IGZpbmRfdXNlcl9ieV91aWQuZ2V0VXNlcklkKCkNCiAgICAgICAgICAgICAgICBwcm
 ludCAiU2FtbC4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIGZvdW5kX3VzZXJfbmFtZToiLCBmb
 3VuZF91c2VyX25hbWUNCg0KICAgICAgICAgICAgICAgIHVzZXJfYXV0aGVudGljYXRlZCA9IGF1
 dGhlbnRpY2F0aW9uU2VydmljZS5hdXRoZW50aWNhdGUoZm91bmRfdXNlcl9uYW1lKQ0KICAgICA
 gICAgICAgICAgIGlmICh1c2VyX2F1dGhlbnRpY2F0ZWQgPT0gRmFsc2UpOg0KICAgICAgICAgIC
 AgICAgICAgICBwcmludCAiU2FtbC4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIEZhaWxlZCB0b
 yBhdXRoZW50aWNhdGUgdXNlciINCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoN
 CiAgICAgICAgICAgICAgICBwcmludCAiU2FtbC4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIFN
 ldHRpbmcgY291bnQgc3RlcHMgdG8gMSINCiAgICAgICAgICAgICAgICBjb250ZXh0LnNldCgic2
 FtbF9jb3VudF9sb2dpbl9zdGVwcyIsIDEpDQoNCiAgICAgICAgICAgICAgICBwb3N0X2xvZ2luX
 3Jlc3VsdCA9IHNlbGYuc2FtbEV4dGVuc2lvblBvc3RMb2dpbihjb25maWd1cmF0aW9uQXR0cmli
 dXRlcywgZmluZF91c2VyX2J5X3VpZCkNCiAgICAgICAgICAgICAgICBwcmludCAiU2FtbC4gQXV
 0aGVudGljYXRlIGZvciBzdGVwIDEuIHBvc3RfbG9naW5fcmVzdWx0OiIsIHBvc3RfbG9naW5fcm
 VzdWx0DQoNCiAgICAgICAgICAgICAgICByZXR1cm4gcG9zdF9sb2dpbl9yZXN1bHQNCiAgICAgI
 CAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgIyBDaGVjayBpZiB0aGUgaXMgdXNlciB3aXRo
 IHNwZWNpZmllZCBzYW1sX3VzZXJfdWlkDQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF
 1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBBdHRlbXB0aW5nIHRvIGZpbmQgdXNlciBieSB1aWQ6Ii
 wgc2FtbF91c2VyX3VpZA0KDQogICAgICAgICAgICAgICAgZmluZF91c2VyX2J5X3VpZCA9IHVzZ
 XJTZXJ2aWNlLmdldFVzZXIoc2FtbF91c2VyX3VpZCkNCiAgICAgICAgICAgICAgICBpZiAoZmlu
 ZF91c2VyX2J5X3VpZCA9PSBOb25lKToNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgIlNhbWw
 uIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBGYWlsZWQgdG8gZmluZCB1c2VyIg0KICAgICAgIC
 AgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICAgICAgIGZvdW5kX3VzZXJfb
 mFtZSA9IGZpbmRfdXNlcl9ieV91aWQuZ2V0VXNlcklkKCkNCiAgICAgICAgICAgICAgICBwcmlu
 dCAiU2FtbC4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIGZvdW5kX3VzZXJfbmFtZToiLCBmb3V
 uZF91c2VyX25hbWUNCg0KICAgICAgICAgICAgICAgIHVzZXJfYXV0aGVudGljYXRlZCA9IGF1dG
 hlbnRpY2F0aW9uU2VydmljZS5hdXRoZW50aWNhdGUoZm91bmRfdXNlcl9uYW1lKQ0KICAgICAgI
 CAgICAgICAgIGlmICh1c2VyX2F1dGhlbnRpY2F0ZWQgPT0gRmFsc2UpOg0KICAgICAgICAgICAg
 ICAgICAgICBwcmludCAiU2FtbC4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIEZhaWxlZCB0byB
 hdXRoZW50aWNhdGUgdXNlciINCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCi
 AgICAgICAgICAgICAgICBwcmludCAiU2FtbC4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIFNld
 HRpbmcgY291bnQgc3RlcHMgdG8gMSINCiAgICAgICAgICAgICAgICBjb250ZXh0LnNldCgic2Ft
 bF9jb3VudF9sb2dpbl9zdGVwcyIsIDEpDQoNCiAgICAgICAgICAgICAgICBwb3N0X2xvZ2luX3J
 lc3VsdCA9IHNlbGYuc2FtbEV4dGVuc2lvblBvc3RMb2dpbihjb25maWd1cmF0aW9uQXR0cmlidX
 RlcywgZmluZF91c2VyX2J5X3VpZCkNCiAgICAgICAgICAgICAgICBwcmludCAiU2FtbC4gQXV0a
 GVudGljYXRlIGZvciBzdGVwIDEuIHBvc3RfbG9naW5fcmVzdWx0OiIsIHBvc3RfbG9naW5fcmVz
 dWx0DQoNCiAgICAgICAgICAgICAgICByZXR1cm4gcG9zdF9sb2dpbl9yZXN1bHQNCiAgICAgICA
 gZWxpZiAoc3RlcCA9PSAyKToNCiAgICAgICAgICAgIHByaW50ICJTYW1sLiBBdXRoZW50aWNhdG
 UgZm9yIHN0ZXAgMiINCg0KICAgICAgICAgICAgc2Vzc2lvbkF0dHJpYnV0ZXMgPSBjb250ZXh0L
 mdldCgic2Vzc2lvbkF0dHJpYnV0ZXMiKQ0KICAgICAgICAgICAgaWYgKHNlc3Npb25BdHRyaWJ1
 dGVzID09IE5vbmUpIG9yIG5vdCBzZXNzaW9uQXR0cmlidXRlcy5jb250YWluc0tleSgic2FtbF9
 1c2VyX3VpZCIpOg0KICAgICAgICAgICAgICAgIHByaW50ICJTYW1sLiBBdXRoZW50aWNhdGUgZm
 9yIHN0ZXAgMi4gc2FtbF91c2VyX3VpZCBpcyBlbXB0eSINCiAgICAgICAgICAgICAgICByZXR1c
 m4gRmFsc2UNCg0KICAgICAgICAgICAgc2FtbF91c2VyX3VpZCA9IHNlc3Npb25BdHRyaWJ1dGVz
 LmdldCgic2FtbF91c2VyX3VpZCIpDQogICAgICAgICAgICBwYXNzZWRfc3RlcDEgPSBTdHJpbmd
 IZWxwZXIuaXNOb3RFbXB0eVN0cmluZyhzYW1sX3VzZXJfdWlkKQ0KICAgICAgICAgICAgaWYgKG
 5vdCBwYXNzZWRfc3RlcDEpOg0KICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgI
 CAgICAgICBjcmVkZW50aWFscyA9IElkZW50aXR5Lmluc3RhbmNlKCkuZ2V0Q3JlZGVudGlhbHMo
 KQ0KICAgICAgICAgICAgdXNlcl9uYW1lID0gY3JlZGVudGlhbHMuZ2V0VXNlcm5hbWUoKQ0KICA
 gICAgICAgICAgdXNlcl9wYXNzd29yZCA9IGNyZWRlbnRpYWxzLmdldFBhc3N3b3JkKCkNCg0KIC
 AgICAgICAgICAgbG9nZ2VkX2luID0gRmFsc2UNCiAgICAgICAgICAgIGlmIChTdHJpbmdIZWxwZ
 XIuaXNOb3RFbXB0eVN0cmluZyh1c2VyX25hbWUpIGFuZCBTdHJpbmdIZWxwZXIuaXNOb3RFbXB0
 eVN0cmluZyh1c2VyX3Bhc3N3b3JkKSk6DQogICAgICAgICAgICAgICAgbG9nZ2VkX2luID0gdXN
 lclNlcnZpY2UuYXV0aGVudGljYXRlKHVzZXJfbmFtZSwgdXNlcl9wYXNzd29yZCkNCg0KICAgIC
 AgICAgICAgaWYgKG5vdCBsb2dnZWRfaW4pOg0KICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZ
 Q0KDQogICAgICAgICAgICAjIENoZWNrIGlmIHRoZXJlIGlzIHVzZXIgd2hpY2ggaGFzIHNhbWxf
 dXNlcl91aWQNCiAgICAgICAgICAgICMgQXZvaWQgbWFwcGluZyBTYW1sIGFjY291bnQgdG8gbW9
 yZSB0aGFuIG9uZSBJRFAgYWNjb3VudA0KICAgICAgICAgICAgZmluZF91c2VyX2J5X3VpZCA9IH
 VzZXJTZXJ2aWNlLmdldFVzZXJCeUF0dHJpYnV0ZSgib3hFeHRlcm5hbFVpZCIsICJzYW1sOiIgK
 yBzYW1sX3VzZXJfdWlkKQ0KDQogICAgICAgICAgICBpZiAoZmluZF91c2VyX2J5X3VpZCA9PSBO
 b25lKToNCiAgICAgICAgICAgICAgICAjIEFkZCBzYW1sX3VzZXJfdWlkIHRvIHVzZXIgb25lIGl
 kIFVJRHMNCiAgICAgICAgICAgICAgICBmaW5kX3VzZXJfYnlfdWlkID0gdXNlclNlcnZpY2UuYW
 RkVXNlckF0dHJpYnV0ZSh1c2VyX25hbWUsICJveEV4dGVybmFsVWlkIiwgInNhbWw6IiArIHNhb
 WxfdXNlcl91aWQpDQogICAgICAgICAgICAgICAgaWYgKGZpbmRfdXNlcl9ieV91aWQgPT0gTm9u
 ZSk6DQogICAgICAgICAgICAgICAgICAgIHByaW50ICJTYW1sLiBBdXRoZW50aWNhdGUgZm9yIHN
 0ZXAgMi4gRmFpbGVkIHRvIHVwZGF0ZSBjdXJyZW50IHVzZXIiDQogICAgICAgICAgICAgICAgIC
 AgIHJldHVybiBGYWxzZQ0KDQogICAgICAgICAgICAgICAgcG9zdF9sb2dpbl9yZXN1bHQgPSBzZ
 WxmLnNhbWxFeHRlbnNpb25Qb3N0TG9naW4oY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIGZpbmRf
 dXNlcl9ieV91aWQpDQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhlbnRpY2F0ZSB
 mb3Igc3RlcCAyLiBwb3N0X2xvZ2luX3Jlc3VsdDoiLCBwb3N0X2xvZ2luX3Jlc3VsdA0KDQogIC
 AgICAgICAgICAgICAgcmV0dXJuIHBvc3RfbG9naW5fcmVzdWx0DQogICAgICAgICAgICBlbHNlO
 g0KICAgICAgICAgICAgICAgIGZvdW5kX3VzZXJfbmFtZSA9IGZpbmRfdXNlcl9ieV91aWQuZ2V0
 VXNlcklkKCkNCiAgICAgICAgICAgICAgICBwcmludCAiU2FtbC4gQXV0aGVudGljYXRlIGZvciB
 zdGVwIDIuIGZvdW5kX3VzZXJfbmFtZToiLCBmb3VuZF91c2VyX25hbWUNCiAgICANCiAgICAgIC
 AgICAgICAgICBpZiBTdHJpbmdIZWxwZXIuZXF1YWxzKHVzZXJfbmFtZSwgZm91bmRfdXNlcl9uY
 W1lKToNCiAgICAgICAgICAgICAgICAgICAgcG9zdF9sb2dpbl9yZXN1bHQgPSBzZWxmLnNhbWxF
 eHRlbnNpb25Qb3N0TG9naW4oY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIGZpbmRfdXNlcl9ieV9
 1aWQpDQogICAgICAgICAgICAgICAgICAgIHByaW50ICJTYW1sLiBBdXRoZW50aWNhdGUgZm9yIH
 N0ZXAgMi4gcG9zdF9sb2dpbl9yZXN1bHQ6IiwgcG9zdF9sb2dpbl9yZXN1bHQNCiAgICANCiAgI
 CAgICAgICAgICAgICAgICAgcmV0dXJuIHBvc3RfbG9naW5fcmVzdWx0DQogICAgICAgIA0KICAg
 ICAgICAgICAgcmV0dXJuIEZhbHNlDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4
 gRmFsc2UNCg0KICAgIGRlZiBwcmVwYXJlRm9yU3RlcChzZWxmLCBjb25maWd1cmF0aW9uQXR0cm
 lidXRlcywgcmVxdWVzdFBhcmFtZXRlcnMsIHN0ZXApOg0KICAgICAgICBjb250ZXh0ID0gQ29ud
 GV4dHMuZ2V0RXZlbnRDb250ZXh0KCkNCiAgICAgICAgYXV0aGVudGljYXRpb25TZXJ2aWNlID0g
 QXV0aGVudGljYXRpb25TZXJ2aWNlLmluc3RhbmNlKCkNCg0KICAgICAgICBpZiAoc3RlcCA9PSA
 xKToNCiAgICAgICAgICAgIHByaW50ICJTYW1sLiBQcmVwYXJlIGZvciBzdGVwIDEiDQogICAgIC
 AgICAgICANCiAgICAgICAgICAgIGh0dHBTZXJ2aWNlID0gSHR0cFNlcnZpY2UuaW5zdGFuY2UoK
 TsNCiAgICAgICAgICAgIHJlcXVlc3QgPSBGYWNlc0NvbnRleHQuZ2V0Q3VycmVudEluc3RhbmNl
 KCkuZ2V0RXh0ZXJuYWxDb250ZXh0KCkuZ2V0UmVxdWVzdCgpDQogICAgICAgICAgICBhc3NlcnR
 pb25Db25zdW1lclNlcnZpY2VVcmwgPSBodHRwU2VydmljZS5jb25zdHJ1Y3RTZXJ2ZXJVcmwocm
 VxdWVzdCkgKyAiL3Bvc3Rsb2dpbiINCiAgICAgICAgICAgIHByaW50ICJTYW1sLiBQcmVwYXJlI
 GZvciBzdGVwIDEuIFByZXBhcmVkIGFzc2VydGlvbkNvbnN1bWVyU2VydmljZVVybDoiLCBhc3Nl
 cnRpb25Db25zdW1lclNlcnZpY2VVcmwNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgY3VycmV
 udFNhbWxDb25maWd1cmF0aW9uID0gc2VsZi5nZXRDdXJyZW50U2FtbENvbmZpZ3VyYXRpb24oc2
 VsZi5zYW1sQ29uZmlndXJhdGlvbiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJlcXVlc3RQY
 XJhbWV0ZXJzKQ0KICAgICAgICAgICAgaWYgKGN1cnJlbnRTYW1sQ29uZmlndXJhdGlvbiA9PSBO
 b25lKToNCiAgICAgICAgICAgICAgICBwcmludCAiU2FtbC4gUHJlcGFyZSBmb3Igc3RlcCAxLiB
 DbGllbnQgc2FtbCBjb25maWd1cmF0aW9uIGlzIGludmFsaWQiDQogICAgICAgICAgICAgICAgcm
 V0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgICMgR2VuZXJhdGUgYW4gQXV0aFJlcXVlc3QgYW5kI
 HNlbmQgaXQgdG8gdGhlIGlkZW50aXR5IHByb3ZpZGVyDQogICAgICAgICAgICBzYW1sQXV0aFJl
 cXVlc3QgPSBBdXRoUmVxdWVzdChjdXJyZW50U2FtbENvbmZpZ3VyYXRpb24pDQogICAgICAgICA
 gICBleHRlcm5hbF9hdXRoX3JlcXVlc3RfdXJpID0gY3VycmVudFNhbWxDb25maWd1cmF0aW9uLm
 dldElkcFNzb1RhcmdldFVybCgpICsgIj9TQU1MUmVxdWVzdD0iICsgc2FtbEF1dGhSZXF1ZXN0L
 mdldFJlcXVlc3QoVHJ1ZSwgYXNzZXJ0aW9uQ29uc3VtZXJTZXJ2aWNlVXJsKQ0KDQogICAgICAg
 ICAgICBwcmludCAiU2FtbC4gUHJlcGFyZSBmb3Igc3RlcCAxLiBleHRlcm5hbF9hdXRoX3JlcXV
 lc3RfdXJpOiIsIGV4dGVybmFsX2F1dGhfcmVxdWVzdF91cmkNCiAgICAgICAgICAgIA0KICAgIC
 AgICAgICAgY29udGV4dC5zZXQoImV4dGVybmFsX2F1dGhfcmVxdWVzdF91cmkiLCBleHRlcm5hb
 F9hdXRoX3JlcXVlc3RfdXJpKQ0KDQogICAgICAgICAgICByZXR1cm4gVHJ1ZQ0KICAgICAgICBl
 bGlmIChzdGVwID09IDIpOg0KICAgICAgICAgICAgcHJpbnQgIlNhbWwuIFByZXBhcmUgZm9yIHN
 0ZXAgMiINCg0KICAgICAgICAgICAgcmV0dXJuIFRydWUNCiAgICAgICAgZWxzZToNCiAgICAgIC
 AgICAgIHJldHVybiBGYWxzZQ0KDQogICAgZGVmIGdldEV4dHJhUGFyYW1ldGVyc0ZvclN0ZXAoc
 2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHN0ZXApOg0KICAgICAgICBpZiAoc3RlcCA9
 PSAyKToNCiAgICAgICAgICAgIHJldHVybiBBcnJheXMuYXNMaXN0KCJzYW1sX3VzZXJfdWlkIik
 NCg0KICAgICAgICByZXR1cm4gTm9uZQ0KDQogICAgZGVmIGdldENvdW50QXV0aGVudGljYXRpb2
 5TdGVwcyhzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIGNvbnRleHQgP
 SBDb250ZXh0cy5nZXRFdmVudENvbnRleHQoKQ0KICAgICAgICBpZiAoY29udGV4dC5pc1NldCgi
 c2FtbF9jb3VudF9sb2dpbl9zdGVwcyIpKToNCiAgICAgICAgICAgIHJldHVybiBjb250ZXh0Lmd
 ldCgic2FtbF9jb3VudF9sb2dpbl9zdGVwcyIpDQogICAgICAgIA0KICAgICAgICByZXR1cm4gMg
 0KDQogICAgZGVmIGdldFBhZ2VGb3JTdGVwKHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzL
 CBzdGVwKToNCiAgICAgICAgaWYgKHN0ZXAgPT0gMSk6DQogICAgICAgICAgICBzYW1sX2FsbG93
 X2Jhc2ljX2xvZ2luID0gRmFsc2UNCiAgICAgICAgICAgIGlmIChjb25maWd1cmF0aW9uQXR0cml
 idXRlcy5jb250YWluc0tleSgic2FtbF9hbGxvd19iYXNpY19sb2dpbiIpKToNCiAgICAgICAgIC
 AgICAgICBzYW1sX2FsbG93X2Jhc2ljX2xvZ2luID0gU3RyaW5nSGVscGVyLnRvQm9vbGVhbihjb
 25maWd1cmF0aW9uQXR0cmlidXRlcy5nZXQoInNhbWxfYWxsb3dfYmFzaWNfbG9naW4iKS5nZXRW
 YWx1ZTIoKSwgRmFsc2UpDQoNCiAgICAgICAgICAgIGlmIChzYW1sX2FsbG93X2Jhc2ljX2xvZ2l
 uKToNCiAgICAgICAgICAgICAgICByZXR1cm4gIi9sb2dpbi54aHRtbCINCiAgICAgICAgICAgIG
 Vsc2U6DQogICAgICAgICAgICAgICAgcmV0dXJuICIvYXV0aC9zYW1sL3NhbWxsb2dpbi54aHRtb
 CINCg0KICAgICAgICByZXR1cm4gIi9hdXRoL3NhbWwvc2FtbHBvc3Rsb2dpbi54aHRtbCINCg0K
 ICAgIGRlZiBsb2dvdXQoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJlcXVlc3RQYXJ
 hbWV0ZXJzKToNCiAgICAgICAgcmV0dXJuIFRydWUNCg0KICAgIGRlZiBpc1Bhc3NlZFN0ZXAxKC
 k6DQogICAgICAgIGNyZWRlbnRpYWxzID0gSWRlbnRpdHkuaW5zdGFuY2UoKS5nZXRDcmVkZW50a
 WFscygpDQogICAgICAgIHVzZXJfbmFtZSA9IGNyZWRlbnRpYWxzLmdldFVzZXJuYW1lKCkNCiAg
 ICAgICAgcGFzc2VkX3N0ZXAxID0gU3RyaW5nSGVscGVyLmlzTm90RW1wdHlTdHJpbmcodXNlcl9
 uYW1lKQ0KDQogICAgICAgIHJldHVybiBwYXNzZWRfc3RlcDENCg0KICAgIGRlZiBsb2FkQ2VyaX
 RpZmljYXRlKHNlbGYsIHNhbWxfY2VydGlmaWNhdGVfZmlsZSk6DQogICAgICAgIHNhbWxfY2Vyd
 GlmaWNhdGUgPSBOb25lDQoNCiAgICAgICAgIyBMb2FkIGNlcnRpZmljYXRlIGZyb20gZmlsZQ0K
 ICAgICAgICBmID0gb3BlbihzYW1sX2NlcnRpZmljYXRlX2ZpbGUsICdyJykNCiAgICAgICAgdHJ
 5Og0KICAgICAgICAgICAgc2FtbF9jZXJ0aWZpY2F0ZSA9IGYucmVhZCgpDQogICAgICAgIGV4Y2
 VwdDoNCiAgICAgICAgICAgIHByaW50ICJGYWlsZWQgdG8gbG9hZCBjZXJ0aWZpY2F0ZSBmcm9tI
 GZpbGU6Iiwgc2FtbF9jZXJ0aWZpY2F0ZV9maWxlDQogICAgICAgICAgICByZXR1cm4gTm9uZQ0K
 ICAgICAgICBmaW5hbGx5Og0KICAgICAgICAgICAgZi5jbG9zZSgpDQogICAgICAgIA0KICAgICA
 gICByZXR1cm4gc2FtbF9jZXJ0aWZpY2F0ZQ0KDQogICAgZGVmIGdldENsaWVudENvbmZpZ3VyYX
 Rpb24oc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJlcXVlc3RQYXJhbWV0ZXJzKToNC
 iAgICAgICAgIyBHZXQgY2xpZW50IGNvbmZpZ3VyYXRpb24NCiAgICAgICAgaWYgKGNvbmZpZ3Vy
 YXRpb25BdHRyaWJ1dGVzLmNvbnRhaW5zS2V5KCJzYW1sX2NsaWVudF9jb25maWd1cmF0aW9uX2F
 0dHJpYnV0ZSIpKToNCiAgICAgICAgICAgIHNhbWxfY2xpZW50X2NvbmZpZ3VyYXRpb25fYXR0cm
 lidXRlID0gY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuZ2V0KCJzYW1sX2NsaWVudF9jb25maWd1c
 mF0aW9uX2F0dHJpYnV0ZSIpLmdldFZhbHVlMigpDQogICAgICAgICAgICBwcmludCAiU2FtbC4g
 R2V0Q2xpZW50Q29uZmlndXJhdGlvbi4gVXNpbmcgY2xpZW50IGF0dHJpYnV0ZToiLCBzYW1sX2N
 saWVudF9jb25maWd1cmF0aW9uX2F0dHJpYnV0ZQ0KDQogICAgICAgICAgICBpZiAocmVxdWVzdF
 BhcmFtZXRlcnMgPT0gTm9uZSk6DQogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgI
 CAgICAgICAgY2xpZW50X2lkID0gTm9uZQ0KICAgICAgICAgICAgY2xpZW50X2lkX2FycmF5ID0g
 cmVxdWVzdFBhcmFtZXRlcnMuZ2V0KCJjbGllbnRfaWQiKQ0KICAgICAgICAgICAgaWYgKEFycmF
 5SGVscGVyLmlzTm90RW1wdHkoY2xpZW50X2lkX2FycmF5KSBhbmQgU3RyaW5nSGVscGVyLmlzTm
 90RW1wdHlTdHJpbmcoY2xpZW50X2lkX2FycmF5WzBdKSk6DQogICAgICAgICAgICAgICAgY2xpZ
 W50X2lkID0gY2xpZW50X2lkX2FycmF5WzBdDQoNCiAgICAgICAgICAgIGlmIChjbGllbnRfaWQg
 PT0gTm9uZSk6DQogICAgICAgICAgICAgICAgZXZlbnRDb250ZXh0ID0gQ29udGV4dHMuZ2V0RXZ
 lbnRDb250ZXh0KCkNCiAgICAgICAgICAgICAgICBpZiAoZXZlbnRDb250ZXh0LmlzU2V0KCJzdG
 9yZWRfcmVxdWVzdF9wYXJhbWV0ZXJzIikpOg0KICAgICAgICAgICAgICAgICAgICBjbGllbnRfa
 WQgPSBldmVudENvbnRleHQuZ2V0KCJzdG9yZWRfcmVxdWVzdF9wYXJhbWV0ZXJzIikuZ2V0KCJj
 bGllbnRfaWQiKQ0KDQogICAgICAgICAgICBpZiAoY2xpZW50X2lkID09IE5vbmUpOg0KICAgICA
 gICAgICAgICAgIHByaW50ICJTYW1sLiBHZXRDbGllbnRDb25maWd1cmF0aW9uLiBjbGllbnRfaW
 QgaXMgZW1wdHkiDQogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgICAgICAgICAgY
 2xpZW50U2VydmljZSA9IENsaWVudFNlcnZpY2UuaW5zdGFuY2UoKQ0KICAgICAgICAgICAgY2xp
 ZW50ID0gY2xpZW50U2VydmljZS5nZXRDbGllbnQoY2xpZW50X2lkKQ0KICAgICAgICAgICAgaWY
 gKGNsaWVudCA9PSBOb25lKToNCiAgICAgICAgICAgICAgICBwcmludCAiU2FtbC4gR2V0Q2xpZW
 50Q29uZmlndXJhdGlvbi4gRmFpbGVkIHRvIGZpbmQgY2xpZW50IiwgY2xpZW50X2lkLCAiIGluI
 GxvY2FsIExEQVAiDQogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgICAgICAgICAg
 c2FtbF9jbGllbnRfY29uZmlndXJhdGlvbiA9IGNsaWVudFNlcnZpY2UuZ2V0Q3VzdG9tQXR0cml
 idXRlKGNsaWVudCwgc2FtbF9jbGllbnRfY29uZmlndXJhdGlvbl9hdHRyaWJ1dGUpDQogICAgIC
 AgICAgICBpZiAoKHNhbWxfY2xpZW50X2NvbmZpZ3VyYXRpb24gPT0gTm9uZSkgb3IgU3RyaW5nS
 GVscGVyLmlzRW1wdHkoc2FtbF9jbGllbnRfY29uZmlndXJhdGlvbi5nZXRWYWx1ZSgpKSk6DQog
 ICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEdldENsaWVudENvbmZpZ3VyYXRpb24uIENsaWV
 udCIsIGNsaWVudF9pZCwgIiBhdHRyaWJ1dGUiLCBzYW1sX2NsaWVudF9jb25maWd1cmF0aW9uX2
 F0dHJpYnV0ZSwgIiBpcyBlbXB0eSINCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgI
 CAgcHJpbnQgIlNhbWwuIEdldENsaWVudENvbmZpZ3VyYXRpb24uIENsaWVudCIsIGNsaWVudF9p
 ZCwgIiBhdHRyaWJ1dGUiLCBzYW1sX2NsaWVudF9jb25maWd1cmF0aW9uX2F0dHJpYnV0ZSwgIiB
 pcyIsIHNhbWxfY2xpZW50X2NvbmZpZ3VyYXRpb24NCiAgICAgICAgICAgICAgICByZXR1cm4gc2
 FtbF9jbGllbnRfY29uZmlndXJhdGlvbg0KDQogICAgICAgIHJldHVybiBOb25lDQoNCiAgICBkZ
 WYgZ2V0Q3VycmVudFNhbWxDb25maWd1cmF0aW9uKHNlbGYsIGN1cnJlbnRTYW1sQ29uZmlndXJh
 dGlvbiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJlcXVlc3RQYXJhbWV0ZXJzKToNCiAgICA
 gICAgc2FtbF9jbGllbnRfY29uZmlndXJhdGlvbiA9IHNlbGYuZ2V0Q2xpZW50Q29uZmlndXJhdG
 lvbihjb25maWd1cmF0aW9uQXR0cmlidXRlcywgcmVxdWVzdFBhcmFtZXRlcnMpDQogICAgICAgI
 GlmIChzYW1sX2NsaWVudF9jb25maWd1cmF0aW9uID09IE5vbmUpOg0KICAgICAgICAgICAgcmV0
 dXJuIGN1cnJlbnRTYW1sQ29uZmlndXJhdGlvbg0KICAgICAgICANCiAgICAgICAgc2FtbF9jbGl
 lbnRfY29uZmlndXJhdGlvbl92YWx1ZSA9IGpzb24ubG9hZHMoc2FtbF9jbGllbnRfY29uZmlndX
 JhdGlvbi5nZXRWYWx1ZSgpKQ0KDQogICAgICAgIGNsaWVudF9zYW1sX2NlcnRpZmljYXRlID0gT
 m9uZSAgICAgIA0KICAgICAgICBjbGllbnRfc2FtbF9jZXJ0aWZpY2F0ZV9maWxlID0gc2FtbF9j
 bGllbnRfY29uZmlndXJhdGlvbl92YWx1ZVsic2FtbF9jZXJ0aWZpY2F0ZV9maWxlIl0NCiAgICA
 gICAgaWYgKFN0cmluZ0hlbHBlci5pc05vdEVtcHR5KGNsaWVudF9zYW1sX2NlcnRpZmljYXRlX2
 ZpbGUpKToNCiAgICAgICAgICAgIGNsaWVudF9zYW1sX2NlcnRpZmljYXRlID0gc2VsZi5sb2FkQ
 2VyaXRpZmljYXRlKGNsaWVudF9zYW1sX2NlcnRpZmljYXRlX2ZpbGUpDQogICAgICAgICAgICBp
 ZiAoU3RyaW5nSGVscGVyLmlzRW1wdHkoY2xpZW50X3NhbWxfY2VydGlmaWNhdGUpKToNCiAgICA
 gICAgICAgICAgICBwcmludCAiU2FtbC4gQnVpbGRDbGllbnRTYW1sQ29uZmlndXJhdGlvbi4gRm
 lsZSB3aXRoIHg1MDkgY2VydGlmaWNhdGUgc2hvdWxkIGJlIG5vdCBlbXB0eS4gVXNpbmcgZGVmY
 XVsdCBjb25maWd1cmF0aW9uIg0KICAgICAgICAgICAgICAgIHJldHVybiBjdXJyZW50U2FtbENv
 bmZpZ3VyYXRpb24NCg0KICAgICAgICBjbGllbnRTYW1sQ29uZmlndXJhdGlvbiA9IGN1cnJlbnR
 TYW1sQ29uZmlndXJhdGlvbi5jbG9uZSgpDQogICAgICAgIA0KICAgICAgICBpZiAoY2xpZW50X3
 NhbWxfY2VydGlmaWNhdGUgIT0gTm9uZSk6DQogICAgICAgICAgICBjbGllbnRTYW1sQ29uZmlnd
 XJhdGlvbi5sb2FkQ2VydGlmaWNhdGVGcm9tU3RyaW5nKGNsaWVudF9zYW1sX2NlcnRpZmljYXRl
 KQ0KDQogICAgICAgIGNsaWVudF9zYW1sX2lzc3VlciA9IHNhbWxfY2xpZW50X2NvbmZpZ3VyYXR
 pb25fdmFsdWVbInNhbWxfaXNzdWVyIl0NCiAgICAgICAgY2xpZW50U2FtbENvbmZpZ3VyYXRpb2
 4uc2V0SXNzdWVyKGNsaWVudF9zYW1sX2lzc3VlcikNCiAgICAgICAgDQogICAgICAgIHNhbWxfd
 XNlX2F1dGhuX2NvbnRleHQgPSBzYW1sX2NsaWVudF9jb25maWd1cmF0aW9uX3ZhbHVlWyJzYW1s
 X3VzZV9hdXRobl9jb250ZXh0Il0NCiAgICAgICAgY2xpZW50X3VzZV9zYW1sX3VzZV9hdXRobl9
 jb250ZXh0ID0gU3RyaW5nSGVscGVyLnRvQm9vbGVhbihzYW1sX3VzZV9hdXRobl9jb250ZXh0LC
 BUcnVlKQ0KICAgICAgICBjbGllbnRTYW1sQ29uZmlndXJhdGlvbi5zZXRVc2VSZXF1ZXN0ZWRBd
 XRobkNvbnRleHQoY2xpZW50X3VzZV9zYW1sX3VzZV9hdXRobl9jb250ZXh0KQ0KDQogICAgICAg
 IHJldHVybiBjbGllbnRTYW1sQ29uZmlndXJhdGlvbg0KDQogICAgZGVmIHByZXBhcmVBdHRyaWJ
 1dGVzTWFwcGluZyhzZWxmLCBzYW1sX2lkcF9hdHRyaWJ1dGVzX2xpc3QsIHNhbWxfbG9jYWxfYX
 R0cmlidXRlc19saXN0KToNCiAgICAgICAgc2FtbF9pZHBfYXR0cmlidXRlc19saXN0X2FycmF5I
 D0gU3RyaW5nSGVscGVyLnNwbGl0KHNhbWxfaWRwX2F0dHJpYnV0ZXNfbGlzdCwgIiwiKQ0KICAg
 ICAgICBpZiAoQXJyYXlIZWxwZXIuaXNFbXB0eShzYW1sX2lkcF9hdHRyaWJ1dGVzX2xpc3RfYXJ
 yYXkpKToNCiAgICAgICAgICAgIHByaW50ICJTYW1sLiBQcmVwYXJlQXR0cmlidXRlc01hcHBpbm
 cuIFRoZXJlIGlzIG5vIGF0dHJpYnV0ZXMgc3BlY2lmaWVkIGluIHNhbWxfaWRwX2F0dHJpYnV0Z
 XNfbGlzdCBwcm9wZXJ0eSINCiAgICAgICAgICAgIHJldHVybiBOb25lDQogICAgICAgIA0KICAg
 ICAgICBzYW1sX2xvY2FsX2F0dHJpYnV0ZXNfbGlzdF9hcnJheSA9IFN0cmluZ0hlbHBlci5zcGx
 pdChzYW1sX2xvY2FsX2F0dHJpYnV0ZXNfbGlzdCwgIiwiKQ0KICAgICAgICBpZiAoQXJyYXlIZW
 xwZXIuaXNFbXB0eShzYW1sX2xvY2FsX2F0dHJpYnV0ZXNfbGlzdF9hcnJheSkpOg0KICAgICAgI
 CAgICAgcHJpbnQgIlNhbWwuIFByZXBhcmVBdHRyaWJ1dGVzTWFwcGluZy4gVGhlcmUgaXMgbm8g
 YXR0cmlidXRlcyBzcGVjaWZpZWQgaW4gc2FtbF9sb2NhbF9hdHRyaWJ1dGVzX2xpc3QgcHJvcGV
 ydHkiDQogICAgICAgICAgICByZXR1cm4gTm9uZQ0KDQogICAgICAgIGlmIChsZW4oc2FtbF9pZH
 BfYXR0cmlidXRlc19saXN0X2FycmF5KSAhPSBsZW4oc2FtbF9sb2NhbF9hdHRyaWJ1dGVzX2xpc
 3RfYXJyYXkpKToNCiAgICAgICAgICAgIHByaW50ICJTYW1sLiBQcmVwYXJlQXR0cmlidXRlc01h
 cHBpbmcuIFRoZSBudW1iZXIgb2YgYXR0cmlidXRlcyBpbiBzYW1sX2lkcF9hdHRyaWJ1dGVzX2x
 pc3QgYW5kIHNhbWxfbG9jYWxfYXR0cmlidXRlc19saXN0IGlzbid0IGVxdWFsIg0KICAgICAgIC
 AgICAgcmV0dXJuIE5vbmUNCiAgICAgICAgDQogICAgICAgIGF0dHJpYnV0ZU1hcHBpbmcgPSBJZ
 GVudGl0eUhhc2hNYXAoKQ0KICAgICAgICBjb250YWluc1VpZCA9IEZhbHNlDQogICAgICAgIGkg
 PSAwDQogICAgICAgIGNvdW50ID0gbGVuKHNhbWxfaWRwX2F0dHJpYnV0ZXNfbGlzdF9hcnJheSk
 NCiAgICAgICAgd2hpbGUgKGkgPCBjb3VudCk6DQogICAgICAgICAgICBpZHBBdHRyaWJ1dGUgPS
 BTdHJpbmdIZWxwZXIudG9Mb3dlckNhc2Uoc2FtbF9pZHBfYXR0cmlidXRlc19saXN0X2FycmF5W
 2ldKQ0KICAgICAgICAgICAgbG9jYWxBdHRyaWJ1dGUgPSBTdHJpbmdIZWxwZXIudG9Mb3dlckNh
 c2Uoc2FtbF9sb2NhbF9hdHRyaWJ1dGVzX2xpc3RfYXJyYXlbaV0pDQogICAgICAgICAgICBhdHR
 yaWJ1dGVNYXBwaW5nLnB1dChpZHBBdHRyaWJ1dGUsIGxvY2FsQXR0cmlidXRlKQ0KDQogICAgIC
 AgICAgICBpZiAoU3RyaW5nSGVscGVyLmVxdWFsc0lnbm9yZUNhc2UobG9jYWxBdHRyaWJ1dGUsI
 CJ1aWQiKSk6DQogICAgICAgICAgICAgICAgY29udGFpbnNVaWQgPSBUcnVlDQoNCiAgICAgICAg
 ICAgIGkgPSBpICsgMQ0KDQogICAgICAgIGlmIChub3QgY29udGFpbnNVaWQpOg0KICAgICAgICA
 gICAgcHJpbnQgIlNhbWwuIFByZXBhcmVBdHRyaWJ1dGVzTWFwcGluZy4gVGhlcmUgaXMgbm8gbW
 FwcGluZyB0byBtYW5kYXRvcnkgJ3VpZCcgYXR0cmlidXRlIg0KICAgICAgICAgICAgcmV0dXJuI
 E5vbmUNCiAgICAgICAgDQogICAgICAgIHJldHVybiBhdHRyaWJ1dGVNYXBwaW5nDQoNCiAgICBk
 ZWYgcHJlcGFyZUN1cnJlbnRBdHRyaWJ1dGVzTWFwcGluZyhzZWxmLCBjdXJyZW50QXR0cmlidXR
 lc01hcHBpbmcsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCByZXF1ZXN0UGFyYW1ldGVycyk6DQ
 ogICAgICAgIHNhbWxfY2xpZW50X2NvbmZpZ3VyYXRpb24gPSBzZWxmLmdldENsaWVudENvbmZpZ
 3VyYXRpb24oY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJlcXVlc3RQYXJhbWV0ZXJzKQ0KICAg
 ICAgICBpZiAoc2FtbF9jbGllbnRfY29uZmlndXJhdGlvbiA9PSBOb25lKToNCiAgICAgICAgICA
 gIHJldHVybiBjdXJyZW50QXR0cmlidXRlc01hcHBpbmcNCg0KICAgICAgICBzYW1sX2NsaWVudF
 9jb25maWd1cmF0aW9uX3ZhbHVlID0ganNvbi5sb2FkcyhzYW1sX2NsaWVudF9jb25maWd1cmF0a
 W9uLmdldFZhbHVlKCkpDQoNCiAgICAgICAgY2xpZW50QXR0cmlidXRlc01hcHBpbmcgPSBzZWxm
 LnByZXBhcmVBdHRyaWJ1dGVzTWFwcGluZyhzYW1sX2NsaWVudF9jb25maWd1cmF0aW9uX3ZhbHV
 lWyJzYW1sX2lkcF9hdHRyaWJ1dGVzX2xpc3QiXSwgc2FtbF9jbGllbnRfY29uZmlndXJhdGlvbl
 92YWx1ZVsic2FtbF9sb2NhbF9hdHRyaWJ1dGVzX2xpc3QiXSkNCiAgICAgICAgaWYgKGNsaWVud
 EF0dHJpYnV0ZXNNYXBwaW5nID09IE5vbmUpOg0KICAgICAgICAgICAgcHJpbnQgIlNhbWwuIFBy
 ZXBhcmVDdXJyZW50QXR0cmlidXRlc01hcHBpbmcuIENsaWVudCBhdHRyaWJ1dGVzIG1hcHBpbmc
 gaXMgaW52YWxpZC4gVXNpbmcgZGVmYXVsdCBvbmUiDQogICAgICAgICAgICByZXR1cm4gY3Vycm
 VudEF0dHJpYnV0ZXNNYXBwaW5nDQoNCiAgICAgICAgcmV0dXJuIGNsaWVudEF0dHJpYnV0ZXNNY
 XBwaW5nDQoNCiAgICBkZWYgc2FtbEV4dGVuc2lvblBvc3RMb2dpbihzZWxmLCBjb25maWd1cmF0
 aW9uQXR0cmlidXRlcywgdXNlcik6DQogICAgICAgIGlmIChzZWxmLnNhbWxFeHRlbnNpb25Nb2R
 1bGUgIT0gTm9uZSk6DQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgcG9zdF9sb2
 dpbl9yZXN1bHQgPSBzZWxmLnNhbWxFeHRlbnNpb25Nb2R1bGUucG9zdExvZ2luKGNvbmZpZ3VyY
 XRpb25BdHRyaWJ1dGVzLCB1c2VyKQ0KICAgICAgICAgICAgICAgIHByaW50ICJTYW1sLiBFeHRl
 bnNpb25Qb3N0bG9naW4gcmVzdWx0OiIsIHBvc3RfbG9naW5fcmVzdWx0DQoNCiAgICAgICAgICA
 gICAgICByZXR1cm4gcG9zdF9sb2dpbl9yZXN1bHQNCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcH
 Rpb24sIGV4Og0KICAgICAgICAgICAgICAgIHByaW50ICJTYW1sLiBFeHRlbnNpb25Qb3N0bG9na
 W4uIEZhaWxlZCB0byBleGVjdXRlIHBvc3RMb2dpbiBtZXRob2QiDQogICAgICAgICAgICAgICAg
 cHJpbnQgIlNhbWwuIEV4dGVuc2lvblBvc3Rsb2dpbi4gVW5leHBlY3RlZCBlcnJvcjoiLCBleA0
 KICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KICAgICAgICAgICAgZXhjZXB0IGphdmEubG
 FuZy5UaHJvd2FibGUsIGV4Og0KICAgICAgICAgICAgICAgIHByaW50ICJTYW1sLiBFeHRlbnNpb
 25Qb3N0bG9naW4uIEZhaWxlZCB0byBleGVjdXRlIHBvc3RMb2dpbiBtZXRob2QiDQogICAgICAg
 ICAgICAgICAgZXgucHJpbnRTdGFja1RyYWNlKCkgDQogICAgICAgICAgICAgICAgcmV0dXJuIEZ
 hbHNlDQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICByZXR1cm4gVHJ1ZQ0K
oxScriptType: person_authentication
programmingLanguage: python

dn: inum=%(inumOrg)s!DAA9.B788,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Sample Client Registration script
displayName: client_registration
gluuStatus: false
inum: %(inumOrg)s!DAA9.B788
oxLevel: 100
oxRevision: 1
oxScript:: ZnJvbSBvcmcueGRpLm1vZGVsLmN1c3RvbS5zY3JpcHQudHlwZS5jbGllbnQgaW1wb
 3J0IENsaWVudFJlZ2lzdHJhdGlvblR5cGUNCmZyb20gb3JnLnhkaS51dGlsIGltcG9ydCBTdHJp
 bmdIZWxwZXIsIEFycmF5SGVscGVyDQpmcm9tIG9yZy54ZGkub3hhdXRoLnNlcnZpY2UgaW1wb3J
 0IFNjb3BlU2VydmljZQ0KZnJvbSBqYXZhLnV0aWwgaW1wb3J0IEFycmF5cywgQXJyYXlMaXN0DQ
 oNCmltcG9ydCBqYXZhDQoNCmNsYXNzIENsaWVudFJlZ2lzdHJhdGlvbihDbGllbnRSZWdpc3RyY
 XRpb25UeXBlKToNCiAgICBkZWYgX19pbml0X18oc2VsZiwgY3VycmVudFRpbWVNaWxsaXMpOg0K
 ICAgICAgICBzZWxmLmN1cnJlbnRUaW1lTWlsbGlzID0gY3VycmVudFRpbWVNaWxsaXMNCg0KICA
 gIGRlZiBpbml0KHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcHJpbn
 QgIkNsaWVudCByZWdpc3RyYXRpb24uIEluaXRpYWxpemF0aW9uIg0KDQogICAgICAgIHNlbGYuc
 2NvcGVTZXJ2aWNlID0gU2NvcGVTZXJ2aWNlLmluc3RhbmNlKCkNCg0KICAgICAgICBwcmludCAi
 Q2xpZW50IHJlZ2lzdHJhdGlvbi4gSW5pdGlhbGl6ZWQgc3VjY2Vzc2Z1bGx5Ig0KDQogICAgICA
 gIHJldHVybiBUcnVlICAgDQoNCiAgICBkZWYgZGVzdHJveShzZWxmLCBjb25maWd1cmF0aW9uQX
 R0cmlidXRlcyk6DQogICAgICAgIHByaW50ICJDbGllbnQgcmVnaXN0cmF0aW9uLiBEZXN0cm95I
 g0KICAgICAgICBwcmludCAiQ2xpZW50IHJlZ2lzdHJhdGlvbi4gRGVzdHJveWVkIHN1Y2Nlc3Nm
 dWxseSINCiAgICAgICAgcmV0dXJuIFRydWUgICANCg0KICAgICMgVXBkYXRlIGNsaWVudCBlbnR
 yeSBiZWZvcmUgcGVyc2lzdGVudCBpdA0KICAgICMgICByZWdpc3RlclJlcXVlc3QgaXMgb3JnLn
 hkaS5veGF1dGguY2xpZW50LlJlZ2lzdGVyUmVxdWVzdA0KICAgICMgICBjbGllbnQgaXMgb3JnL
 nhkaS5veGF1dGgubW9kZWwucmVnaXN0cmF0aW9uLkNsaWVudA0KICAgICMgICBjb25maWd1cmF0
 aW9uQXR0cmlidXRlcyBpcyBqYXZhLnV0aWwuTWFwPFN0cmluZywgU2ltcGxlQ3VzdG9tUHJvcGV
 ydHk+DQogICAgZGVmIHVwZGF0ZUNsaWVudChzZWxmLCByZWdpc3RlclJlcXVlc3QsIGNsaWVudC
 wgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICBwcmludCAiQ2xpZW50IHJlZ2lzd
 HJhdGlvbi4gVXBkYXRlQ2xpZW50IG1ldGhvZCINCg0KICAgICAgICByZWRpcmVjdFVyaXMgPSBj
 bGllbnQuZ2V0UmVkaXJlY3RVcmlzKCkNCiAgICAgICAgcHJpbnQgIkNsaWVudCByZWdpc3RyYXR
 pb24uIFJlZGlyZWN0IFVyaXM6IiwgcmVkaXJlY3RVcmlzDQoNCiAgICAgICAgYWRkQWRkcmVzc1
 Njb3BlID0gRmFsc2UNCiAgICAgICAgZm9yIHJlZGlyZWN0VXJpIGluIHJlZGlyZWN0VXJpczoNC
 iAgICAgICAgICAgIGlmIChTdHJpbmdIZWxwZXIuZXF1YWxzSWdub3JlQ2FzZShyZWRpcmVjdFVy
 aSwgImh0dHBzOi8vY2xpZW50LmV4YW1wbGUuY29tL2V4YW1wbGUxIikpOg0KICAgICAgICAgICA
 gICAgIGFkZEFkZHJlc3NTY29wZSA9IFRydWUNCiAgICAgICAgICAgICAgICBicmVhaw0KICAgIC
 AgICANCiAgICAgICAgcHJpbnQgIkNsaWVudCByZWdpc3RyYXRpb24uIElzIGFkZCBhZGRyZXNzI
 HNjb3BlOiIsIGFkZEFkZHJlc3NTY29wZQ0KDQogICAgICAgIGlmIChhZGRBZGRyZXNzU2NvcGUp
 Og0KICAgICAgICAgICAgY3VycmVudFNjb3BlcyA9IGNsaWVudC5nZXRTY29wZXMoKQ0KICAgICA
 gICAgICAgcHJpbnQgIkNsaWVudCByZWdpc3RyYXRpb24uIEN1cnJlbnQgc2NvcGVzOiIsIGN1cn
 JlbnRTY29wZXMNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgYWRkcmVzc1Njb3BlID0gc2VsZ
 i5zY29wZVNlcnZpY2UuZ2V0U2NvcGVCeURpc3BsYXlOYW1lKCJhZGRyZXNzIikNCiAgICAgICAg
 ICAgIG5ld1Njb3BlcyA9IEFycmF5SGVscGVyLmFkZEl0ZW1Ub1N0cmluZ0FycmF5KGN1cnJlbnR
 TY29wZXMsIGFkZHJlc3NTY29wZS5nZXREbigpKQ0KICAgIA0KICAgICAgICAgICAgcHJpbnQgIk
 NsaWVudCByZWdpc3RyYXRpb24uIFJlc3VsdCBzY29wZXM6IiwgbmV3U2NvcGVzDQogICAgICAgI
 CAgICBjbGllbnQuc2V0U2NvcGVzKG5ld1Njb3BlcykNCg0KICAgICAgICByZXR1cm4gVHJ1ZQ0K
 DQogICAgZGVmIGxvZ291dChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywgcmVxdWVzdFB
 hcmFtZXRlcnMpOg0KICAgICAgICByZXR1cm4gVHJ1ZQ0KDQogICAgZGVmIGdldEFwaVZlcnNpb2
 4oc2VsZik6DQogICAgICAgIHJldHVybiAxDQo=
oxScriptType: client_registration
programmingLanguage: python

dn: inum=%(inumOrg)s!DAA9.B789,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Sample Application Session script
displayName: application_session
gluuStatus: false
inum: %(inumOrg)s!DAA9.B789
oxLevel: 100
oxRevision: 1
oxScript:: ZnJvbSBvcmcueGRpLm1vZGVsLmN1c3RvbS5zY3JpcHQudHlwZS5zZXNzaW9uIGltc
 G9ydCBBcHBsaWNhdGlvblNlc3Npb25UeXBlDQpmcm9tIG9yZy54ZGkudXRpbCBpbXBvcnQgU3Ry
 aW5nSGVscGVyLCBBcnJheUhlbHBlcg0KZnJvbSBqYXZhLnV0aWwgaW1wb3J0IEFycmF5cywgQXJ
 yYXlMaXN0DQoNCmltcG9ydCBqYXZhDQoNCmNsYXNzIEFwcGxpY2F0aW9uU2Vzc2lvbihBcHBsaW
 NhdGlvblNlc3Npb25UeXBlKToNCiAgICBkZWYgX19pbml0X18oc2VsZiwgY3VycmVudFRpbWVNa
 WxsaXMpOg0KICAgICAgICBzZWxmLmN1cnJlbnRUaW1lTWlsbGlzID0gY3VycmVudFRpbWVNaWxs
 aXMNCg0KICAgIGRlZiBpbml0KHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICA
 gICAgcHJpbnQgIkFwcGxpY2F0aW9uIHNlc3Npb24uIEluaXRpYWxpemF0aW9uIg0KICAgICAgIC
 BwcmludCAiQXBwbGljYXRpb24gc2Vzc2lvbi4gSW5pdGlhbGl6ZWQgc3VjY2Vzc2Z1bGx5Ig0KD
 QogICAgICAgIHJldHVybiBUcnVlICAgDQoNCiAgICBkZWYgZGVzdHJveShzZWxmLCBjb25maWd1
 cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHByaW50ICJBcHBsaWNhdGlvbiBzZXNzaW9uLiB
 EZXN0cm95Ig0KICAgICAgICBwcmludCAiQXBwbGljYXRpb24gc2Vzc2lvbi4gRGVzdHJveWVkIH
 N1Y2Nlc3NmdWxseSINCiAgICAgICAgcmV0dXJuIFRydWUgICANCg0KICAgIGRlZiBnZXRBcGlWZ
 XJzaW9uKHNlbGYpOg0KICAgICAgICByZXR1cm4gMQ0KDQogICAgIyBBcHBsaWNhdGlvbiBjYWxs
 cyBpdCBhdCBlbmQgc2Vzc2lvbiByZXF1ZXN0IHRvIGFsbG93IG5vdGlmeSAzcmQgcGFydCBzeXN
 0ZW1zDQogICAgIyAgIGh0dHBSZXF1ZXN0IGlzIGphdmF4LnNlcnZsZXQuaHR0cC5IdHRwU2Vydm
 xldFJlcXVlc3QNCiAgICAjICAgYXV0aG9yaXphdGlvbkdyYW50IGlzIG9yZy54ZGkub3hhdXRoL
 m1vZGVsLmNvbW1vbi5BdXRob3JpemF0aW9uR3JhbnQNCiAgICAjICAgY29uZmlndXJhdGlvbkF0
 dHJpYnV0ZXMgaXMgamF2YS51dGlsLk1hcDxTdHJpbmcsIFNpbXBsZUN1c3RvbVByb3BlcnR5Pg0
 KICAgIGRlZiBlbmRTZXNzaW9uKHNlbGYsIGh0dHBSZXF1ZXN0LCBhdXRob3JpemF0aW9uR3Jhbn
 QsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcHJpbnQgIkFwcGxpY2F0aW9uI
 HNlc3Npb24uIFN0YXJ0aW5nIGV4dGVybmFsIHNlc3Npb24gZW5kIg0KDQogICAgICAgIHByaW50
 ICJBcHBsaWNhdGlvbiBzZXNzaW9uLiBFeHRlcm5hbCBzZXNzaW9uIGVuZGVkIHN1Y2Nlc3NmdWx
 seSINCiAgICAgICAgcmV0dXJuIFRydWUNCg==
oxScriptType: application_session
programmingLanguage: python

dn: inum=%(inumOrg)s!031C.5621,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Sample Dynamic Scope script
displayName: dynamic_scope
gluuStatus: true
inum: %(inumOrg)s!031C.5621
oxLevel: 100
oxRevision: 1
oxScript:: ZnJvbSBvcmcueGRpLm1vZGVsLmN1c3RvbS5zY3JpcHQudHlwZS5zY29wZSBpbXBvcnQgRHluYW1pY1Njb3BlVHlwZQ0KZnJvbSBvcmcueGRpLnV0aWwgaW1wb3J0IFN0cmluZ0hlbHBlciwgQXJyYXlIZWxwZXINCmZyb
 20gamF2YS51dGlsIGltcG9ydCBBcnJheXMsIEFycmF5TGlzdA0KDQppbXBvcnQgamF2YQ0KDQpjbGFzcyBEeW5hbWljU2NvcGUoRHluYW1pY1Njb3BlVHlwZSk6DQogICAgZGVmIF9faW5pdF9fKHNlbGYsIGN1cnJlbnRUaW1lTWls
 bGlzKToNCiAgICAgICAgc2VsZi5jdXJyZW50VGltZU1pbGxpcyA9IGN1cnJlbnRUaW1lTWlsbGlzDQoNCiAgICBkZWYgaW5pdChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHByaW50ICJEeW5hbWljIHN
 jb3BlLiBJbml0aWFsaXphdGlvbiINCg0KICAgICAgICBwcmludCAiRHluYW1pYyBzY29wZS4gSW5pdGlhbGl6ZWQgc3VjY2Vzc2Z1bGx5Ig0KDQogICAgICAgIHJldHVybiBUcnVlICAgDQoNCiAgICBkZWYgZGVzdHJveShzZWxmLC
 Bjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHByaW50ICJEeW5hbWljIHNjb3BlLiBEZXN0cm95Ig0KICAgICAgICBwcmludCAiRHluYW1pYyBzY29wZS4gRGVzdHJveWVkIHN1Y2Nlc3NmdWxseSINCiAgICAgICAgc
 mV0dXJuIFRydWUgICANCg0KICAgICMgVXBkYXRlIEpzb24gV2ViIHRva2VuIGJlZm9yZSBzaWduaW5nL2VuY3J5cHJpbmcgaXQNCiAgICAjICAgZHluYW1pY1Njb3BlQ29udGV4dCBpcyBvcmcueGRpLm94YXV0aC5zZXJ2aWNlLmV4
 dGVybmFsLmNvbnRleHQuRHluYW1pY1Njb3BlRXh0ZXJuYWxDb250ZXh0DQogICAgIyAgIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzIGlzIGphdmEudXRpbC5NYXA8U3RyaW5nLCBTaW1wbGVDdXN0b21Qcm9wZXJ0eT4NCiAgICBkZWY
 gdXBkYXRlKHNlbGYsIGR5bmFtaWNTY29wZUNvbnRleHQsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcHJpbnQgIkR5bmFtaWMgc2NvcGUuIFVwZGF0ZSBtZXRob2QiDQoNCiAgICAgICAgZHluYW1pY1Njb3Blcy
 A9IGR5bmFtaWNTY29wZUNvbnRleHQuZ2V0RHluYW1pY1Njb3BlcygpDQogICAgICAgIHVzZXIgPSBkeW5hbWljU2NvcGVDb250ZXh0LmdldFVzZXIoKQ0KICAgICAgICBqc29uV2ViUmVzcG9uc2UgPSBkeW5hbWljU2NvcGVDb250Z
 Xh0LmdldEpzb25XZWJSZXNwb25zZSgpDQogICAgICAgIGNsYWltcyA9IGpzb25XZWJSZXNwb25zZS5nZXRDbGFpbXMoKQ0KDQogICAgICAgICMgSXRlcmF0ZSB0aHJvdWdoIGxpc3Qgb2YgZHluYW1pYyBzY29wZXMgaW4gb3JkZXIg
 dG8gYWRkIGN1c3RvbSBzY29wZXMgaWYgbmVlZGVkDQogICAgICAgIHByaW50ICJEeW5hbWljIHNjb3BlLiBEeW5hbWljIHNjb3BlczoiLCBkeW5hbWljU2NvcGVzDQogICAgICAgIGZvciBkeW5hbWljU2NvcGUgaW4gZHluYW1pY1N
 jb3BlczoNCiAgICAgICAgICAgICMgQWRkIG9yZ2FuaXphdGlvbiBuYW1lIGlmIHRoZXJlIGlzIHNjb3BlID0gb3JnX25hbWUNCiAgICAgICAgICAgIGlmIChTdHJpbmdIZWxwZXIuZXF1YWxzSWdub3JlQ2FzZShkeW5hbWljU2NvcG
 UsICJvcmdfbmFtZSIpKToNCiAgICAgICAgICAgICAgICBjbGFpbXMuc2V0Q2xhaW0oIm9yZ19uYW1lIiwgIkdsdXUsIEluYy4iKQ0KICAgICAgICAgICAgICAgIGNvbnRpbnVlDQoNCiAgICAgICAgICAgICMgQWRkIHdvcmsgcGhvb
 mUgaWYgdGhlcmUgaXMgc2NvcGUgPSB3b3JrX3Bob25lDQogICAgICAgICAgICBpZiAoU3RyaW5nSGVscGVyLmVxdWFsc0lnbm9yZUNhc2UoZHluYW1pY1Njb3BlLCAid29ya19waG9uZSIpKToNCiAgICAgICAgICAgICAgICB3b3Jr
 UGhvbmUgPSB1c2VyLmdldEF0dHJpYnV0ZSgidGVsZXBob25lTnVtYmVyIik7DQogICAgICAgICAgICAgICAgaWYgKFN0cmluZ0hlbHBlci5pc05vdEVtcHR5KHdvcmtQaG9uZSkpOg0KICAgICAgICAgICAgICAgICAgICBjbGFpbXM
 uc2V0Q2xhaW0oIndvcmtfcGhvbmUiLCB3b3JrUGhvbmUpDQogICAgICAgICAgICAgICAgY29udGludWUNCg0KICAgICAgICByZXR1cm4gVHJ1ZQ0KDQogICAgZGVmIGxvZ291dChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcy
 wgcmVxdWVzdFBhcmFtZXRlcnMpOg0KICAgICAgICByZXR1cm4gVHJ1ZQ0KDQogICAgZGVmIGdldEFwaVZlcnNpb24oc2VsZik6DQogICAgICAgIHJldHVybiAxDQo=
oxScriptType: dynamic_scope
programmingLanguage: python
